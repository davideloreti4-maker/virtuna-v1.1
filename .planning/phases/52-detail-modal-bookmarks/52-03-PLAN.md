---
phase: 52-detail-modal-bookmarks
plan: 03
type: execute
wave: 2
depends_on: ["52-01"]
files_modified:
  - src/components/trending/video-card.tsx
  - src/components/trending/video-grid.tsx
  - src/app/(app)/trending/trending-client.tsx
  - src/types/trending.ts
autonomous: true

must_haves:
  truths:
    - "Bookmarked videos show filled bookmark icon in thumbnail corner"
    - "Saved tab appears after category tabs and filters to bookmarked videos"
    - "Empty saved state shows friendly message when no bookmarks"
    - "Clicking VideoCard opens the detail modal"
  artifacts:
    - path: "src/components/trending/video-card.tsx"
      provides: "VideoCard with bookmark overlay"
      contains: "BookmarkSimple"
    - path: "src/app/(app)/trending/trending-client.tsx"
      provides: "TrendingClient with Saved tab and modal state"
      contains: "selectedVideo"
  key_links:
    - from: "src/components/trending/video-card.tsx"
      to: "src/stores/bookmark-store.ts"
      via: "useBookmarkStore for isBookmarked check"
      pattern: "useBookmarkStore"
    - from: "src/app/(app)/trending/trending-client.tsx"
      to: "src/components/trending/video-detail-modal.tsx"
      via: "VideoDetailModal rendered with selectedVideo state"
      pattern: "VideoDetailModal"
---

<objective>
Wire the bookmark overlay to VideoCard, add the Saved tab to TrendingClient, and integrate the detail modal with the page.

Purpose: Complete the bookmark UX and modal integration for the trending page.
Output: Functional bookmark icons on cards, Saved tab filtering, modal opens on card click.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/52-detail-modal-bookmarks/52-CONTEXT.md
@.planning/phases/52-detail-modal-bookmarks/52-01-SUMMARY.md
@.planning/phases/52-detail-modal-bookmarks/52-02-SUMMARY.md

# Files to modify
@src/components/trending/video-card.tsx
@src/components/trending/video-grid.tsx
@src/app/(app)/trending/trending-client.tsx
@src/types/trending.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add bookmark overlay to VideoCard</name>
  <files>src/components/trending/video-card.tsx</files>
  <action>
Add a filled bookmark icon overlay in the thumbnail corner for bookmarked videos.

**Implementation:**
1. Import useBookmarkStore from @/stores/bookmark-store
2. Import BookmarkSimple from @phosphor-icons/react
3. Check if video is bookmarked: `const isBookmarked = useBookmarkStore((s) => s.bookmarkedIds.has(video.id))`
4. Add conditional overlay inside the thumbnail div (after the gradient overlay):

```tsx
{/* Bookmark indicator */}
{isBookmarked && (
  <div className="absolute top-2 right-2 z-10 rounded-full bg-black/50 p-1">
    <BookmarkSimple weight="fill" className="h-4 w-4 text-accent" />
  </div>
)}
```

**Styling per CONTEXT.md:**
- Small filled bookmark icon
- Corner of thumbnail (top-right)
- Semi-transparent background for visibility against any thumbnail

**Hydration note:**
The store handles hydration internally. The selector `(s) => s.bookmarkedIds.has(video.id)` will return false until hydrated, which is the correct neutral state.
  </action>
  <verify>
TypeScript compiles: `pnpm exec tsc --noEmit`
  </verify>
  <done>
VideoCard shows filled bookmark icon overlay when video is bookmarked.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add Saved tab and modal integration to TrendingClient</name>
  <files>src/app/(app)/trending/trending-client.tsx, src/types/trending.ts, src/components/trending/video-grid.tsx</files>
  <action>
Add the "Saved" filter tab and integrate the detail modal.

**Part A: Update types (src/types/trending.ts)**

Add a FilterTab type that includes "saved":
```typescript
// Existing
export type TrendingCategory = "breaking-out" | "trending-now" | "rising-again";

// Add new type for tabs that can include saved
export type FilterTab = TrendingCategory | "saved";

// Update VALID_TABS or create FILTER_TABS
export const FILTER_TABS = [...VALID_TABS, "saved"] as const;
```

**Part B: Update VideoGrid (src/components/trending/video-grid.tsx)**

1. Change prop type: `category: TrendingCategory` -> `filterTab: FilterTab`
2. Import useBookmarkStore for saved filtering
3. Import mock data directly for saved filtering:
   ```typescript
   import { getVideosByCategory, getAllVideos } from "@/lib/trending-mock-data";
   ```
4. Add filtering logic:
   ```typescript
   const bookmarkedIds = useBookmarkStore((s) => s.bookmarkedIds);

   const videos = filterTab === "saved"
     ? getAllVideos().filter((v) => bookmarkedIds.has(v.id))
     : /* existing useInfiniteVideos logic */;
   ```
5. For saved tab, don't use infinite scroll (show all bookmarks at once)
6. Update EmptyState to handle "saved" case with custom message per CONTEXT.md:
   "No saved videos yet. Click the bookmark icon to save."

**Part C: Update TrendingClient (src/app/(app)/trending/trending-client.tsx)**

1. Change activeTab state type to FilterTab
2. Add "Saved" to categories array:
   ```typescript
   {
     value: "saved",
     label: "Saved",
     icon: <BookmarkSimple weight="fill" className="h-3.5 w-3.5" />,
     // No count per CONTEXT.md
   }
   ```
3. Import BookmarkSimple from @phosphor-icons/react

4. Add modal state:
   ```typescript
   const [selectedVideo, setSelectedVideo] = useState<TrendingVideo | null>(null);
   const isModalOpen = selectedVideo !== null;
   ```

5. Create navigation handlers for modal:
   ```typescript
   const currentVideos = /* get videos for current tab */;
   const currentIndex = selectedVideo
     ? currentVideos.findIndex((v) => v.id === selectedVideo.id)
     : -1;

   const handleNavigate = (direction: "prev" | "next") => {
     if (direction === "prev" && currentIndex > 0) {
       setSelectedVideo(currentVideos[currentIndex - 1]);
     } else if (direction === "next" && currentIndex < currentVideos.length - 1) {
       setSelectedVideo(currentVideos[currentIndex + 1]);
     }
   };
   ```

6. Pass onClick to VideoGrid to open modal:
   ```tsx
   <VideoGrid
     filterTab={activeTab}
     onVideoClick={(video) => setSelectedVideo(video)}
   />
   ```

7. Update VideoGrid interface to accept onVideoClick prop:
   ```typescript
   interface VideoGridProps {
     filterTab: FilterTab;
     onVideoClick?: (video: TrendingVideo) => void;
   }
   ```

8. Render VideoDetailModal at bottom of component:
   ```tsx
   <VideoDetailModal
     video={selectedVideo}
     open={isModalOpen}
     onOpenChange={(open) => {
       if (!open) setSelectedVideo(null);
     }}
     onNavigate={handleNavigate}
     hasPrevious={currentIndex > 0}
     hasNext={currentIndex < currentVideos.length - 1}
   />
   ```

9. Call bookmark store _hydrate on mount:
   ```typescript
   useEffect(() => {
     useBookmarkStore.getState()._hydrate();
   }, []);
   ```

**Update VideoGrid onClick wiring:**
Pass onVideoClick through to VideoCard in the map.
  </action>
  <verify>
TypeScript compiles: `pnpm exec tsc --noEmit`
  </verify>
  <done>
Saved tab appears in category bar, filters to bookmarked videos, empty state shows when no bookmarks. VideoCard click opens modal.
  </done>
</task>

</tasks>

<verification>
1. `pnpm exec tsc --noEmit` passes without errors
2. VideoCard shows bookmark overlay for bookmarked videos
3. TrendingClient has 4 tabs: Breaking Out, Trending Now, Resurging, Saved
4. Saved tab filters to bookmarked videos only
5. Empty Saved state shows friendly message
6. VideoCard click opens VideoDetailModal
7. Modal navigation works with arrow keys
</verification>

<success_criteria>
- Bookmark icon visible on cards for bookmarked videos
- Saved tab filters grid to show only bookmarked videos
- Empty saved state has friendly copy with hint
- Clicking any VideoCard opens the detail modal
- Modal can be navigated with arrow keys (prev/next in current filter)
- Modal closes on overlay click or escape
</success_criteria>

<output>
After completion, create `.planning/phases/52-detail-modal-bookmarks/52-03-SUMMARY.md`
</output>
