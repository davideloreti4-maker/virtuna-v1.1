---
phase: 52-detail-modal-bookmarks
plan: 02
type: execute
wave: 2
depends_on: ["52-01"]
files_modified:
  - src/components/trending/video-detail-modal.tsx
  - src/components/trending/tiktok-embed.tsx
  - src/components/trending/index.ts
autonomous: true

must_haves:
  truths:
    - "Modal displays TikTok embed iframe when opened"
    - "Modal shows full video metadata (creator, views, likes, shares, date, hashtags)"
    - "Analyze button navigates to /viral-predictor with video URL prefill"
    - "Bookmark button toggles between filled and unfilled icon"
    - "Remix button is disabled with Coming Soon badge"
    - "Modal closes via overlay click or escape key (no X button)"
  artifacts:
    - path: "src/components/trending/video-detail-modal.tsx"
      provides: "VideoDetailModal component using Dialog"
      exports: ["VideoDetailModal"]
    - path: "src/components/trending/tiktok-embed.tsx"
      provides: "TikTok embed component with script reloading"
      exports: ["TikTokEmbed"]
  key_links:
    - from: "src/components/trending/video-detail-modal.tsx"
      to: "src/stores/bookmark-store.ts"
      via: "useBookmarkStore hook"
      pattern: "useBookmarkStore"
    - from: "src/components/trending/video-detail-modal.tsx"
      to: "/viral-predictor"
      via: "router.push with query params"
      pattern: "router\\.push.*viral-predictor"
---

<objective>
Build the video detail modal with TikTok embed, metadata display, and action buttons using the design system Dialog component.

Purpose: Create the main modal experience for viewing video details and taking actions.
Output: VideoDetailModal and TikTokEmbed components integrated with design system.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/52-detail-modal-bookmarks/52-CONTEXT.md
@.planning/phases/52-detail-modal-bookmarks/52-RESEARCH.md
@.planning/phases/52-detail-modal-bookmarks/52-01-SUMMARY.md

# Design system components
@src/components/ui/dialog.tsx
@src/components/primitives/glass-pill.tsx
@src/components/ui/button.tsx
@src/components/ui/badge.tsx

# Types
@src/types/trending.ts

# Bookmark store
@src/stores/bookmark-store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create TikTokEmbed component</name>
  <files>src/components/trending/tiktok-embed.tsx</files>
  <action>
Create a TikTok embed component that handles script reloading for each video.

**Props interface:**
```typescript
interface TikTokEmbedProps {
  videoUrl: string;  // Full TikTok URL
  videoId: string;   // TikTok video ID for cache busting
}
```

**Implementation:**
- Use blockquote structure (NOT dangerouslySetInnerHTML)
- Script injection pattern with cache-busting timestamp
- Re-inject script when videoId changes (dependency array)
- Clean up script on unmount
- Container div with ref for potential future use
- Style blockquote with maxWidth 325px (TikTok standard)

**Script injection pattern:**
```typescript
useEffect(() => {
  const script = document.createElement("script");
  script.src = `https://www.tiktok.com/embed.js?t=${Date.now()}`;
  script.async = true;
  document.body.appendChild(script);

  return () => {
    // Remove script on unmount/video change
    if (script.parentNode) {
      script.parentNode.removeChild(script);
    }
  };
}, [videoId]); // Re-run when video changes
```

**Blockquote structure:**
```tsx
<blockquote
  className="tiktok-embed"
  cite={videoUrl}
  data-video-id={extractVideoId(videoUrl)}
  style={{ maxWidth: "325px" }}
>
  <section />
</blockquote>
```

Add a loading state placeholder (skeleton) while embed initializes.
  </action>
  <verify>
TypeScript compiles: `pnpm exec tsc --noEmit`
  </verify>
  <done>
TikTokEmbed component renders blockquote with script injection, re-initializes on video change.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create VideoDetailModal component</name>
  <files>src/components/trending/video-detail-modal.tsx, src/components/trending/index.ts</files>
  <action>
Build the main modal component using Dialog from design system.

**Props interface:**
```typescript
interface VideoDetailModalProps {
  video: TrendingVideo | null;
  open: boolean;
  onOpenChange: (open: boolean) => void;
  onNavigate: (direction: "prev" | "next") => void;
  hasPrevious: boolean;
  hasNext: boolean;
}
```

**Layout (Claude's discretion from CONTEXT.md):**
Use side-by-side layout on desktop (TikTok embed left, metadata right), stacked on mobile.
Modal size: Use size="full" with className="max-w-4xl" for enough space.

**Structure:**
```
Dialog (controlled: open, onOpenChange)
└── DialogContent (size="full" className="max-w-4xl p-0")
    └── div (flex: row on lg, column on mobile)
        ├── TikTokEmbed section (w-[325px] or full on mobile)
        └── Metadata section (flex-1)
            ├── Creator info (avatar, name, handle)
            ├── Title
            ├── Stats row (views, likes, shares, date)
            ├── Hashtags (GlassPill tags)
            └── Action buttons row
```

**Metadata formatting:**
- Views/likes/shares: Use formatCompactNumber helper (copy from video-card.tsx)
- Date: Use formatRelativeDate helper (copy from video-card.tsx)
- Hashtags: Map to GlassPill color="blue" size="sm"

**Action buttons:**
1. **Analyze** - Button variant="primary", onClick navigates to `/viral-predictor?url=${encodeURIComponent(video.tiktokUrl)}`
   - Use next/navigation useRouter
2. **Bookmark** - Button variant="secondary", onClick calls toggleBookmark from store
   - Icon: BookmarkSimple from @phosphor-icons/react
   - Use weight="fill" if isBookmarked, weight="regular" if not
3. **Remix** - Button variant="secondary" disabled
   - Add Badge next to it with "Coming Soon" text

**No explicit close button** per CONTEXT.md - Radix handles overlay click and escape.

**Integrate keyboard navigation:**
- Import useModalKeyboardNav from 52-01
- Call with { isOpen: open, onPrevious, onNext, hasPrevious, hasNext }
- onPrevious/onNext call the onNavigate prop

**Hydration safety:**
- Use useEffect to call _hydrate from bookmark store on mount
- Check _isHydrated before reading bookmark state (show neutral icon until hydrated)

**Export from index.ts:**
Add VideoDetailModal and TikTokEmbed to barrel export.
  </action>
  <verify>
TypeScript compiles: `pnpm exec tsc --noEmit`
  </verify>
  <done>
VideoDetailModal renders Dialog with TikTok embed, metadata, action buttons, keyboard navigation wired.
  </done>
</task>

</tasks>

<verification>
1. `pnpm exec tsc --noEmit` passes without errors
2. TikTokEmbed exists at src/components/trending/tiktok-embed.tsx
3. VideoDetailModal exists at src/components/trending/video-detail-modal.tsx
4. Both exported from src/components/trending/index.ts
5. Modal uses Dialog component from design system
6. Bookmark toggle uses useBookmarkStore
7. Keyboard navigation uses useModalKeyboardNav
</verification>

<success_criteria>
- Modal opens with TikTok embed placeholder (actual embed requires runtime)
- Metadata displays all fields (creator, views, likes, shares, date, hashtags)
- Analyze button wired to router.push with video URL
- Bookmark button toggles icon state via store
- Remix button disabled with Coming Soon badge
- Modal closes via overlay/escape (Radix built-in)
- Arrow keys call onNavigate when modal open
</success_criteria>

<output>
After completion, create `.planning/phases/52-detail-modal-bookmarks/52-02-SUMMARY.md`
</output>
