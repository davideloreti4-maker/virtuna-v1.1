---
phase: 01-infrastructure-setup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/layout.tsx
  - src/app/page.tsx
  - src/app/globals.css
  - src/lib/supabase/client.ts
  - src/lib/supabase/server.ts
  - src/lib/supabase/middleware.ts
  - src/middleware.ts
autonomous: true

must_haves:
  truths:
    - "App has a root layout with HTML structure"
    - "App has a homepage that renders"
    - "Supabase client can be instantiated"
    - "Tailwind CSS styles are applied"
  artifacts:
    - path: "src/app/layout.tsx"
      provides: "Root layout with metadata and font setup"
      exports: ["metadata", "default"]
    - path: "src/app/page.tsx"
      provides: "Homepage component"
      exports: ["default"]
    - path: "src/app/globals.css"
      provides: "Tailwind directives and base styles"
      contains: "@import"
    - path: "src/lib/supabase/client.ts"
      provides: "Browser Supabase client"
      exports: ["createClient"]
    - path: "src/lib/supabase/server.ts"
      provides: "Server Supabase client"
      exports: ["createClient"]
  key_links:
    - from: "src/app/layout.tsx"
      to: "src/app/globals.css"
      via: "CSS import"
      pattern: "import.*globals.css"
    - from: "src/lib/supabase/client.ts"
      to: "@supabase/ssr"
      via: "createBrowserClient"
      pattern: "createBrowserClient"
---

<objective>
Create the Next.js App Router directory structure with Supabase client utilities.

Purpose: Restore the deleted src/ directory with working Next.js App Router files so the app can build and run.

Output:
- Working app/layout.tsx and app/page.tsx
- Tailwind CSS globals.css
- Supabase client utilities (browser + server)
- Middleware for Supabase auth
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md

Key context:
- Next.js 16.1.5 with React 19
- Tailwind CSS v4 (uses @import "tailwindcss" not @tailwind directives)
- @supabase/ssr ^0.8.0 + @supabase/supabase-js ^2.93.1
- Path alias: @/* â†’ ./src/*
- TypeScript strict mode enabled
- Supabase URL: https://qyxvxleheckijapurisj.supabase.co
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create App Router layout and page</name>
  <files>src/app/layout.tsx, src/app/page.tsx, src/app/globals.css</files>
  <action>
Create the following files:

**src/app/globals.css:**
```css
@import "tailwindcss";
```

**src/app/layout.tsx:**
- Import globals.css
- Export metadata with title "Virtuna" and description
- Use Inter font from next/font/google
- Create RootLayout component with html (lang="en") and body with font class
- Apply antialiased class to body
- Use proper TypeScript types (Readonly<{ children: React.ReactNode }>)

**src/app/page.tsx:**
- Create simple homepage with centered content
- Display "Virtuna v1.1" heading and "Building..." text
- Use Tailwind classes for styling (min-h-screen, flex, items-center, justify-center)
- Export as default function component
  </action>
  <verify>
Run: `npm run build` should not error on missing files
Files exist: src/app/layout.tsx, src/app/page.tsx, src/app/globals.css
  </verify>
  <done>
Root layout renders with proper HTML structure, homepage displays content, Tailwind styles apply
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Supabase client utilities</name>
  <files>src/lib/supabase/client.ts, src/lib/supabase/server.ts, src/lib/supabase/middleware.ts, src/middleware.ts</files>
  <action>
Create Supabase utilities following the @supabase/ssr pattern:

**src/lib/supabase/client.ts:**
```typescript
import { createBrowserClient } from "@supabase/ssr";

export function createClient() {
  return createBrowserClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!
  );
}
```

**src/lib/supabase/server.ts:**
```typescript
import { createServerClient } from "@supabase/ssr";
import { cookies } from "next/headers";

export async function createClient() {
  const cookieStore = await cookies();

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return cookieStore.getAll();
        },
        setAll(cookiesToSet) {
          try {
            cookiesToSet.forEach(({ name, value, options }) =>
              cookieStore.set(name, value, options)
            );
          } catch {
            // Server Component - ignore
          }
        },
      },
    }
  );
}
```

**src/lib/supabase/middleware.ts:**
```typescript
import { createServerClient } from "@supabase/ssr";
import { NextResponse, type NextRequest } from "next/server";

export async function updateSession(request: NextRequest) {
  let supabaseResponse = NextResponse.next({
    request,
  });

  const supabase = createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        getAll() {
          return request.cookies.getAll();
        },
        setAll(cookiesToSet) {
          cookiesToSet.forEach(({ name, value }) =>
            request.cookies.set(name, value)
          );
          supabaseResponse = NextResponse.next({
            request,
          });
          cookiesToSet.forEach(({ name, value, options }) =>
            supabaseResponse.cookies.set(name, value, options)
          );
        },
      },
    }
  );

  await supabase.auth.getUser();

  return supabaseResponse;
}
```

**src/middleware.ts:**
```typescript
import { type NextRequest } from "next/server";
import { updateSession } from "@/lib/supabase/middleware";

export async function middleware(request: NextRequest) {
  return await updateSession(request);
}

export const config = {
  matcher: [
    "/((?!_next/static|_next/image|favicon.ico|.*\\.(?:svg|png|jpg|jpeg|gif|webp)$).*)",
  ],
};
```
  </action>
  <verify>
Run: `npx tsc --noEmit` should pass without type errors
Files exist: src/lib/supabase/client.ts, src/lib/supabase/server.ts, src/lib/supabase/middleware.ts, src/middleware.ts
  </verify>
  <done>
Supabase client utilities created with proper TypeScript types, middleware handles auth session refresh
  </done>
</task>

</tasks>

<verification>
1. All files created in src/ directory
2. TypeScript compiles without errors: `npx tsc --noEmit`
3. Build starts successfully: `npm run build`
</verification>

<success_criteria>
- src/app/layout.tsx exports RootLayout and metadata
- src/app/page.tsx renders homepage content
- src/app/globals.css imports Tailwind
- Supabase utilities export createClient functions
- Middleware configured for auth session
- TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/01-infrastructure-setup/01-01-SUMMARY.md`
</output>
