---
phase: 05-society-management
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/stores/society-store.ts
  - src/types/society.ts
  - src/lib/mock-societies.ts
autonomous: true

must_haves:
  truths:
    - "Zustand store persists society data to localStorage"
    - "Store actions for select, add, update, delete work correctly"
    - "Type definitions distinguish Personal and Target societies"
  artifacts:
    - path: "src/stores/society-store.ts"
      provides: "Zustand store with persist middleware"
      exports: ["useSocietyStore"]
    - path: "src/types/society.ts"
      provides: "Society type definitions"
      exports: ["Society", "PersonalSociety", "TargetSociety"]
    - path: "src/lib/mock-societies.ts"
      provides: "Initial mock data for societies"
      exports: ["INITIAL_SOCIETIES"]
  key_links:
    - from: "src/stores/society-store.ts"
      to: "src/types/society.ts"
      via: "import types"
      pattern: "import.*Society.*from.*types/society"
    - from: "src/stores/society-store.ts"
      to: "src/lib/mock-societies.ts"
      via: "import initial data"
      pattern: "import.*INITIAL_SOCIETIES.*from.*mock-societies"
---

<objective>
Create Zustand state store with localStorage persistence for society management

Purpose: Establish global state foundation that Phase 4's SocietySelector will use, enabling society selection to persist across the app and browser sessions.

Output: Zustand store with CRUD operations, TypeScript type definitions, extracted mock data
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-society-management/05-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create society type definitions</name>
  <files>src/types/society.ts</files>
  <action>
Create TypeScript type definitions for societies:

```typescript
// src/types/society.ts
export interface PersonalSociety {
  id: string;
  name: string;
  description: string;
  type: 'personal';
  platform: 'linkedin' | 'x';
  needsSetup: boolean;
}

export interface TargetSociety {
  id: string;
  name: string;
  description: string;
  type: 'target';
  societyType: 'custom' | 'example';
  icon: 'briefcase' | 'coins' | 'users';
  members: number;
  createdAt: string;
}

export type Society = PersonalSociety | TargetSociety;

// Type guard functions
export function isPersonalSociety(society: Society): society is PersonalSociety {
  return society.type === 'personal';
}

export function isTargetSociety(society: Society): society is TargetSociety {
  return society.type === 'target';
}
```

This extends the mock data structure from Phase 4 (04-03) with proper discriminated union types.
  </action>
  <verify>TypeScript compilation succeeds: `npm run build 2>&1 | head -20`</verify>
  <done>Types file exists with PersonalSociety, TargetSociety, Society union, and type guards exported</done>
</task>

<task type="auto">
  <name>Task 2: Extract mock data to lib module</name>
  <files>src/lib/mock-societies.ts</files>
  <action>
Extract mock data from society-selector.tsx to a dedicated module:

```typescript
// src/lib/mock-societies.ts
import type { PersonalSociety, TargetSociety, Society } from '@/types/society';

export const INITIAL_PERSONAL_SOCIETIES: PersonalSociety[] = [
  {
    id: 'linkedin',
    name: 'LinkedIn',
    description: 'Your personal LinkedIn network built around your connections.',
    type: 'personal',
    platform: 'linkedin',
    needsSetup: true,
  },
  {
    id: 'x',
    name: 'X (formerly Twitter)',
    description: 'Your X network built around your followers.',
    type: 'personal',
    platform: 'x',
    needsSetup: true,
  },
];

export const INITIAL_TARGET_SOCIETIES: TargetSociety[] = [
  {
    id: 'zurich-founders',
    name: 'Zurich Founders',
    description: 'Entrepreneurs and startup founders in Zurich.',
    type: 'target',
    societyType: 'custom',
    icon: 'briefcase',
    members: 156,
    createdAt: new Date().toISOString(),
  },
  {
    id: 'startup-investors',
    name: 'Startup Investors',
    description: 'Individuals investing in early-stage companies.',
    type: 'target',
    societyType: 'example',
    icon: 'coins',
    members: 342,
    createdAt: new Date().toISOString(),
  },
];

export const INITIAL_SOCIETIES: Society[] = [
  ...INITIAL_PERSONAL_SOCIETIES,
  ...INITIAL_TARGET_SOCIETIES,
];
```

Key points:
- Personal societies have platform and needsSetup
- Target societies have societyType, icon, members, createdAt
- All societies have the type discriminator field
  </action>
  <verify>TypeScript compilation succeeds: `npm run build 2>&1 | head -20`</verify>
  <done>Mock data module exists with typed arrays matching Phase 4 data structure</done>
</task>

<task type="auto">
  <name>Task 3: Create Zustand store with persist middleware</name>
  <files>src/stores/society-store.ts</files>
  <action>
First install Zustand:
```bash
npm install zustand
```

Create the society store:

```typescript
// src/stores/society-store.ts
import { create } from 'zustand';
import { persist } from 'zustand/middleware';
import type { Society, PersonalSociety, TargetSociety } from '@/types/society';
import { INITIAL_SOCIETIES, INITIAL_PERSONAL_SOCIETIES, INITIAL_TARGET_SOCIETIES } from '@/lib/mock-societies';

interface SocietyState {
  societies: Society[];
  selectedSocietyId: string | null;

  // Selectors (derived)
  getPersonalSocieties: () => PersonalSociety[];
  getTargetSocieties: () => TargetSociety[];
  getSelectedSociety: () => Society | undefined;

  // Actions
  selectSociety: (id: string) => void;
  addSociety: (society: Society) => void;
  updateSociety: (id: string, updates: Partial<Society>) => void;
  deleteSociety: (id: string) => void;
  resetSocieties: () => void;
}

export const useSocietyStore = create<SocietyState>()(
  persist(
    (set, get) => ({
      societies: INITIAL_SOCIETIES,
      selectedSocietyId: INITIAL_TARGET_SOCIETIES[0]?.id ?? null,

      // Selectors
      getPersonalSocieties: () =>
        get().societies.filter((s): s is PersonalSociety => s.type === 'personal'),

      getTargetSocieties: () =>
        get().societies.filter((s): s is TargetSociety => s.type === 'target'),

      getSelectedSociety: () =>
        get().societies.find((s) => s.id === get().selectedSocietyId),

      // Actions
      selectSociety: (id) => set({ selectedSocietyId: id }),

      addSociety: (society) => set((state) => ({
        societies: [...state.societies, society],
        selectedSocietyId: society.id, // Auto-select new society
      })),

      updateSociety: (id, updates) => set((state) => ({
        societies: state.societies.map((s) =>
          s.id === id ? { ...s, ...updates } as Society : s
        ),
      })),

      deleteSociety: (id) => set((state) => {
        const filteredSocieties = state.societies.filter((s) => s.id !== id);
        return {
          societies: filteredSocieties,
          selectedSocietyId: state.selectedSocietyId === id
            ? filteredSocieties[0]?.id ?? null
            : state.selectedSocietyId,
        };
      }),

      resetSocieties: () => set({
        societies: INITIAL_SOCIETIES,
        selectedSocietyId: INITIAL_TARGET_SOCIETIES[0]?.id ?? null,
      }),
    }),
    {
      name: 'virtuna-societies', // localStorage key
    }
  )
);
```

Key points:
- Uses persist middleware for localStorage
- Auto-selects first target society by default
- Auto-selects newly created societies
- Falls back to first remaining society on delete
- Includes reset action for testing/dev
  </action>
  <verify>
1. TypeScript compilation: `npm run build 2>&1 | head -20`
2. Check localStorage key pattern in store file
  </verify>
  <done>Store created with persist middleware, all CRUD actions, and selector methods</done>
</task>

</tasks>

<verification>
After all tasks:
1. `npm run build` passes without errors
2. Files exist:
   - src/stores/society-store.ts
   - src/types/society.ts
   - src/lib/mock-societies.ts
3. Zustand is in package.json dependencies
</verification>

<success_criteria>
- Zustand store with persist middleware created
- Type-safe society definitions with discriminated union
- Mock data extracted to dedicated module
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-society-management/05-01-SUMMARY.md`
</output>
