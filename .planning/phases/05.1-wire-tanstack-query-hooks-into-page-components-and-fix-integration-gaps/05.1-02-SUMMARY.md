---
phase: 05.1-wire-tanstack-query-hooks-into-page-components-and-fix-integration-gaps
plan: 02
subsystem: ui
tags: [tanstack-query, infinite-scroll, cursor-pagination, react, trending]

# Dependency graph
requires:
  - phase: 05.1-01
    provides: "mapScrapedVideoToTrendingVideo mapper and hooks/queries barrel export"
provides:
  - "Trending page wired to real API data via TanStack Query hooks"
  - "VideoGrid with cursor-paginated infinite scroll from /api/trending"
  - "StatsBar with real category stats from /api/trending/stats"
affects: [05.1-03, 05.1-04]

# Tech tracking
tech-stack:
  added: []
  patterns:
    - "API stats adapter: transform API response shape to UI type inline"
    - "Skeleton loading: component-level loading state via TanStack Query isLoading"
    - "Infinite scroll: useInView + fetchNextPage pattern with TanStack Query"

key-files:
  created: []
  modified:
    - src/components/trending/video-grid.tsx
    - src/app/(app)/trending/trending-client.tsx

key-decisions:
  - "Saved tab keeps mock getAllVideos() temporarily until bookmark API exists"
  - "Modal prev/next navigation disabled temporarily -- single video viewing still works"
  - "Stats adapter done inline in component (not separate mapper) since it's a one-off transform"
  - "VideoGrid handles its own loading skeleton, parent no longer wraps in SkeletonGrid"

patterns-established:
  - "API-to-UI adapter: inline useMemo transform for one-off shape mismatches"
  - "Component-owned loading: each component shows its own skeleton via TanStack Query isLoading"

# Metrics
duration: 2min
completed: 2026-02-13
---

# Phase 5.1 Plan 02: Trending Page Wiring Summary

**Trending page wired to TanStack Query hooks with cursor-paginated infinite scroll and real API stats**

## Performance

- **Duration:** 2 min
- **Started:** 2026-02-13T12:24:35Z
- **Completed:** 2026-02-13T12:26:59Z
- **Tasks:** 2
- **Files modified:** 2

## Accomplishments
- VideoGrid fetches videos from /api/trending via useTrendingVideos() with cursor pagination
- DB rows mapped to TrendingVideo UI type via mapScrapedVideoToTrendingVideo
- Stats bar shows real category stats from /api/trending/stats via useTrendingStats()
- All fake setTimeout loading delays removed -- real loading states from TanStack Query
- Initial loading skeleton rendered by VideoGrid itself (component-owned loading)

## Task Commits

Each task was committed atomically:

1. **Task 1: Wire VideoGrid to useTrendingVideos with mapper and real infinite scroll** - `daa3cc4` (feat)
2. **Task 2: Wire TrendingClient stats to useTrendingStats and remove mock loading** - `edb88b1` (feat)

## Files Created/Modified
- `src/components/trending/video-grid.tsx` - Replaced useInfiniteVideos with useTrendingVideos, added mapper, cursor-based infinite scroll
- `src/app/(app)/trending/trending-client.tsx` - Replaced getTrendingStats/getAllVideos with useTrendingStats, removed fake loading, added StatsBarSkeleton

## Decisions Made
- **Saved tab fallback:** Kept `getAllVideos()` mock import for saved tab only -- bookmarks reference video IDs that may span categories, and there's no bookmark API yet. Added TODO comment.
- **Modal navigation disabled:** Removed parent-level currentVideos/handleNavigate since VideoGrid now owns the data. Modal still opens for single video viewing. Added TODO for re-implementation.
- **Inline stats adapter:** API stats shape (`{ categories: [...], total_videos }`) differs from UI type (`{ byCategory: Record, totalVideos, totalViews }`). Used inline useMemo transform rather than a separate mapper since it's a one-off conversion specific to this component.
- **Component-owned loading:** VideoGrid shows its own skeleton grid when `isLoading`, so TrendingClient no longer wraps it in a SkeletonGrid ternary. Cleaner separation of concerns.

## Deviations from Plan

None - plan executed exactly as written.

## Issues Encountered
None

## User Setup Required
None - no external service configuration required.

## Next Phase Readiness
- Trending page fully wired to API data
- Ready for 05.1-03 (deals page wiring) and 05.1-04 (remaining integration gaps)
- Saved tab and modal navigation marked as TODOs for future bookmark API

## Self-Check: PASSED

- [x] src/components/trending/video-grid.tsx exists
- [x] src/app/(app)/trending/trending-client.tsx exists
- [x] SUMMARY.md exists
- [x] Commit daa3cc4 exists
- [x] Commit edb88b1 exists

---
*Phase: 05.1-wire-tanstack-query-hooks-into-page-components-and-fix-integration-gaps*
*Completed: 2026-02-13*
