---
phase: 47-results-topbar-loading
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/simulation/impact-score.tsx
  - src/components/app/simulation/attention-breakdown.tsx
  - src/components/app/simulation/variants-section.tsx
  - src/components/app/simulation/insights-section.tsx
  - src/components/app/simulation/themes-section.tsx
autonomous: true

must_haves:
  truths:
    - "ImpactScore renders inside a GlassCard with coral accent score and Typography text"
    - "AttentionBreakdown renders 3 individual GlassProgress bars (coral, blue, purple) instead of a segmented bar"
    - "VariantsSection renders variant rows inside a GlassCard with Badge for AI-generated indicator"
    - "InsightsSection renders inside a GlassCard with Accordion expand/collapse for each insight"
    - "ThemesSection renders inside a GlassCard with Accordion expand/collapse replacing manual useState toggle"
  artifacts:
    - path: "src/components/app/simulation/impact-score.tsx"
      provides: "GlassCard-wrapped impact score with coral accent"
      contains: "GlassCard"
    - path: "src/components/app/simulation/attention-breakdown.tsx"
      provides: "GlassProgress bars for attention metrics"
      contains: "GlassProgress"
    - path: "src/components/app/simulation/variants-section.tsx"
      provides: "GlassCard variant rows with Badge and Button"
      contains: "GlassCard"
    - path: "src/components/app/simulation/insights-section.tsx"
      provides: "GlassCard with Accordion expandable insights"
      contains: "AccordionRoot"
    - path: "src/components/app/simulation/themes-section.tsx"
      provides: "GlassCard with Accordion expandable themes"
      contains: "AccordionRoot"
  key_links:
    - from: "src/components/app/simulation/impact-score.tsx"
      to: "@/components/primitives"
      via: "GlassCard import"
      pattern: "import.*GlassCard.*from.*primitives"
    - from: "src/components/app/simulation/attention-breakdown.tsx"
      to: "@/components/primitives"
      via: "GlassProgress import"
      pattern: "import.*GlassProgress.*from.*primitives"
    - from: "src/components/app/simulation/themes-section.tsx"
      to: "@/components/ui/accordion"
      via: "AccordionRoot import"
      pattern: "import.*AccordionRoot.*from.*accordion"
---

<objective>
Migrate all 5 results section components (ImpactScore, AttentionBreakdown, VariantsSection, InsightsSection, ThemesSection) from hardcoded zinc/emerald/amber classes to design system primitives.

Purpose: Each section becomes a self-contained GlassCard with Typography, GlassProgress, Badge, and Accordion -- eliminating all legacy color classes and establishing the visual pattern for the assembled results panel.

Output: 5 migrated section components using design system primitives exclusively, zero hardcoded zinc/emerald/amber classes.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/47-results-topbar-loading/47-RESEARCH.md

Source files to migrate:
@src/components/app/simulation/impact-score.tsx
@src/components/app/simulation/attention-breakdown.tsx
@src/components/app/simulation/variants-section.tsx
@src/components/app/simulation/insights-section.tsx
@src/components/app/simulation/themes-section.tsx

Design system components to use:
@src/components/primitives/GlassCard.tsx
@src/components/primitives/GlassProgress.tsx
@src/components/ui/typography.tsx
@src/components/ui/badge.tsx
@src/components/ui/button.tsx
@src/components/ui/accordion.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate ImpactScore and AttentionBreakdown to design system</name>
  <files>
    src/components/app/simulation/impact-score.tsx
    src/components/app/simulation/attention-breakdown.tsx
  </files>
  <action>
**ImpactScore migration (`impact-score.tsx`):**

1. Replace the outer `<div className="space-y-2">` with `<GlassCard padding="md" hover="lift">`.
2. Replace `<h3 className="text-sm font-medium text-zinc-400">` with `<Text size="sm" muted>Impact Score</Text>`.
3. Replace `<Info className="h-4 w-4 text-zinc-500" />` with `<Info className="h-4 w-4 text-foreground-muted" />`.
4. Replace the `LABEL_COLORS` mapping (emerald/blue/amber/red) with a single coral accent. Per CONTEXT.md: "the score number uses coral accent color for emphasis." Use `text-accent` for the label and score.
5. Replace `<span className="text-xl text-zinc-500">` with `<Text as="span" size="lg" muted>/100</Text>`.
6. Keep the same props interface `{ score, label }` and the `ImpactLabel` type import.

**AttentionBreakdown migration (`attention-breakdown.tsx`):**

1. Replace the outer `<div className="space-y-3">` with `<GlassCard padding="md" hover="lift">`.
2. Replace the section header: `<Text size="sm" muted>Attention</Text>` + `<Info className="h-4 w-4 text-foreground-muted" />`.
3. Remove the stacked bar div entirely (the `<div className="flex h-3 w-full ...">` with 3 colored segments).
4. Replace with 3 individual `GlassProgress` bars per CONTEXT.md decision: "GlassProgress horizontal bars for each attention metric (not a segmented bar)":
   - Full Attention: `<GlassProgress value={attention.full} color="coral" size="md" />`
   - Partial: `<GlassProgress value={attention.partial} color="blue" size="md" />`
   - Ignored: `<GlassProgress value={attention.ignore} color="purple" size="md" />`
5. Each bar has a label row above it: `<Text size="sm">` for the label, `<Text size="sm" className="font-medium">` for the percentage.
6. Remove the old legend div entirely -- the label rows above each bar replace it.
7. Keep the same props interface `{ attention: { full, partial, ignore } }`.

**Token replacements for both files:**
- `text-zinc-400` -> `text-foreground-secondary` (or use `<Text muted>`)
- `text-zinc-500` -> `text-foreground-muted` (or use `<Caption>`)
- `text-white` -> `text-foreground` (or use `<Text>`)
- `bg-zinc-*` -> removed (GlassCard handles it)
- `border-zinc-*` -> removed (GlassCard handles it)
- `bg-red-500`, `bg-amber-400`, `bg-zinc-600` -> removed (GlassProgress handles it)
- `text-emerald-400` -> `text-accent`

Import `GlassCard` from `@/components/primitives`, `GlassProgress` from `@/components/primitives`, and `Text`, `Caption` from `@/components/ui/typography`.
  </action>
  <verify>
Run `npx tsc --noEmit` from the project root -- no type errors in the modified files.
Run `grep -rn "zinc\|emerald\|amber\|red-500" src/components/app/simulation/impact-score.tsx src/components/app/simulation/attention-breakdown.tsx` -- should return no matches.
  </verify>
  <done>
ImpactScore renders in a GlassCard with coral accent score and Typography text. AttentionBreakdown renders 3 GlassProgress bars (coral, blue, purple) with labeled percentages. Zero hardcoded color classes remain in either file.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate VariantsSection, InsightsSection, and ThemesSection to design system</name>
  <files>
    src/components/app/simulation/variants-section.tsx
    src/components/app/simulation/insights-section.tsx
    src/components/app/simulation/themes-section.tsx
  </files>
  <action>
**VariantsSection migration (`variants-section.tsx`):**

1. Wrap the entire section in `<GlassCard padding="md" hover="lift">`.
2. Replace section header with `<Text size="sm" muted>Variants</Text>` + `<Info className="h-4 w-4 text-foreground-muted" />`.
3. Each variant row: replace `border-zinc-700 bg-zinc-800/50` / `border-zinc-700 bg-zinc-900` with design tokens: `rounded-xl border border-border bg-surface-elevated/50 p-3` for original, `rounded-xl border border-border bg-surface p-3` for AI-generated.
4. Replace `text-white` with `text-foreground`, `text-zinc-500` with `text-foreground-muted`, `text-purple-400` with `text-accent`.
5. The Sparkles icon color: `text-purple-400` -> `text-accent` (coral).
6. Replace `text-2xl font-bold text-white` for the score with `<Text size="xl" className="font-bold">`.
7. "Generate New Variants" button: replace raw `<button>` with `<Button variant="ghost" size="md">` with dashed border via className override: `className="w-full border-dashed"`. Keep the Sparkles icon.
8. Keep stacked rows layout (per RESEARCH.md recommendation for variable-length array).

**InsightsSection migration (`insights-section.tsx`):**

1. Wrap in `<GlassCard padding="md" hover="lift">`.
2. Replace header with `<Text size="sm" muted>Insights</Text>` + info icon with `text-foreground-muted`.
3. Per CONTEXT.md: "Insights and Themes sections have expandable items: each insight/theme is a row that expands to show longer detail on click."
4. The current insights is `string[]`. For expandable behavior, show the first sentence/line as the trigger and full text on expand.
5. Wrap insights in `<AccordionRoot type="single" collapsible>`. Each insight becomes an `<AccordionItem>`:
   - `<AccordionTrigger>`: First sentence (split on `. ` or first 80 chars + `...`)
   - `<AccordionContent>`: Full insight text via `<Text size="sm" muted>`
6. If insight is short (< 100 chars), render as plain `<Text>` without accordion (no expand needed).
7. Replace `text-zinc-300` with `text-foreground-secondary`.

**ThemesSection migration (`themes-section.tsx`):**

1. Wrap in `<GlassCard padding="md" hover="lift">`.
2. Replace header with `<Text size="sm" muted>Conversation</Text>` + info icon with `text-foreground-muted`.
3. Remove the manual `useState(expandedTheme)` toggle pattern.
4. Replace with Radix `Accordion` from `@/components/ui/accordion`:
   ```tsx
   <AccordionRoot type="single" collapsible defaultValue={themes[0]?.id}>
     {themes.map((theme) => (
       <AccordionItem key={theme.id} value={theme.id}>
         <AccordionTrigger>
           <div className="flex items-center gap-3">
             <MessageSquare className="h-4 w-4 text-foreground-muted" />
             <Text size="sm" className="font-medium">{theme.title}</Text>
             <Caption>~{theme.percentage}%</Caption>
           </div>
         </AccordionTrigger>
         <AccordionContent>
           <Text size="sm" muted>{theme.description}</Text>
           {theme.quotes.map((quote, i) => (
             <blockquote key={i} className="mt-2 border-l-2 border-border pl-3">
               <Text size="sm" muted className="italic">&ldquo;{quote}&rdquo;</Text>
             </blockquote>
           ))}
         </AccordionContent>
       </AccordionItem>
     ))}
   </AccordionRoot>
   ```
5. Remove manual expand/collapse chevron icons (Accordion handles the caret).
6. Replace all `text-zinc-*`, `border-zinc-*`, `bg-zinc-*` with design tokens.

**Token replacements for all 3 files:**
- Same mapping as Task 1
- `border-zinc-700` -> `border-border`
- `bg-zinc-800/50` -> `bg-surface-elevated/50`

Import `AccordionRoot`, `AccordionItem`, `AccordionTrigger`, `AccordionContent` from `@/components/ui/accordion`.
  </action>
  <verify>
Run `npx tsc --noEmit` from project root -- no type errors.
Run `grep -rn "zinc\|emerald\|amber" src/components/app/simulation/variants-section.tsx src/components/app/simulation/insights-section.tsx src/components/app/simulation/themes-section.tsx` -- should return no matches.
  </verify>
  <done>
VariantsSection shows variant rows in a GlassCard with design tokens and a ghost Button for generate. InsightsSection uses Accordion for expandable insight items. ThemesSection uses Accordion replacing manual useState toggle. Zero hardcoded zinc/emerald/amber classes remain in any of the 3 files.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors in the 5 modified files.
2. No hardcoded zinc/emerald/amber/red-500 color classes remain in any of the 5 files.
3. Each file imports from design system (`@/components/primitives`, `@/components/ui/typography`, `@/components/ui/accordion`, `@/components/ui/badge`, `@/components/ui/button`).
4. All 5 components preserve their existing prop interfaces unchanged.
</verification>

<success_criteria>
All 5 results section components (ImpactScore, AttentionBreakdown, VariantsSection, InsightsSection, ThemesSection) render using GlassCard, GlassProgress, Typography, Badge, Button, and Accordion with zero legacy styled elements remaining.
</success_criteria>

<output>
After completion, create `.planning/phases/47-results-topbar-loading/47-01-SUMMARY.md`
</output>
