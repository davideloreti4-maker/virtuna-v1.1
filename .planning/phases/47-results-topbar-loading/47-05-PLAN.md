---
phase: 47-results-topbar-loading
plan: 05
type: execute
wave: 3
depends_on: ["47-01", "47-02", "47-03", "47-04"]
files_modified:
  - src/app/(app)/dashboard/dashboard-client.tsx
autonomous: false

must_haves:
  truths:
    - "Dashboard top bar renders ContextBar + FilterPillGroup + LegendPills using migrated GlassPill components"
    - "Simulation loading state renders skeleton shimmer placeholders with staggered entry"
    - "Results panel renders 5 GlassCard sections (impact, attention, variants, insights, themes) with design tokens"
    - "Share button shows a toast notification on clipboard copy"
    - "Cancel button during loading returns to filling-form state"
    - "No hardcoded zinc/emerald/amber/orange color classes remain in any simulation, top bar, or loading component"
    - "Mobile viewport has no more than 2 backdrop-filter elements active"
  artifacts:
    - path: "src/app/(app)/dashboard/dashboard-client.tsx"
      provides: "Dashboard page wiring all migrated components"
  key_links:
    - from: "src/app/(app)/dashboard/dashboard-client.tsx"
      to: "All migrated components"
      via: "imports from @/components/app barrel"
      pattern: "import.*from.*@/components/app"
---

<objective>
Wire the dashboard orchestrator to use all migrated components and perform visual verification of the complete Phase 47 migration.

Purpose: Ensure all migrated components integrate correctly in the dashboard page, confirm no legacy styled elements remain, and verify mobile backdrop-filter budget compliance.

Output: Dashboard page fully wired with design system components. Visual verification confirms Raycast-quality appearance.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/47-results-topbar-loading/47-RESEARCH.md

Prior plan outputs:
@.planning/phases/47-results-topbar-loading/47-01-SUMMARY.md
@.planning/phases/47-results-topbar-loading/47-02-SUMMARY.md
@.planning/phases/47-results-topbar-loading/47-03-SUMMARY.md
@.planning/phases/47-results-topbar-loading/47-04-SUMMARY.md

Dashboard orchestrator:
@src/app/(app)/dashboard/dashboard-client.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire dashboard and run full build verification</name>
  <files>
    src/app/(app)/dashboard/dashboard-client.tsx
  </files>
  <action>
1. Read `dashboard-client.tsx` and verify all imports from `@/components/app` barrel resolve to the migrated versions. The barrel re-exports should already point to the updated files -- no changes needed if Plans 01-04 edited in place.

2. Check if any hardcoded zinc/emerald/amber/orange classes exist in `dashboard-client.tsx` itself. Currently the file has:
   - `bg-background` -- already a design token, OK
   - `px-6 py-4` -- layout spacing, OK
   - No hardcoded color classes in the current version

3. Verify the top bar section renders correctly:
   - `<ContextBar location="Switzerland" />` -- now renders GlassPill
   - `<LegendPills className="hidden md:flex" />` -- now renders GlassPill items
   - `<FilterPillGroup />` -- now renders GlassPill items
   - `<Button variant="primary">` -- already migrated in Phase 46

4. No changes should be needed to `dashboard-client.tsx` if all Plans 01-04 preserved existing component interfaces.

5. Run full build verification:
   ```bash
   npx tsc --noEmit
   pnpm build
   ```

6. Run a comprehensive grep to confirm zero legacy color classes across ALL migrated files:
   ```bash
   grep -rn "bg-zinc\|text-zinc\|border-zinc\|bg-emerald\|text-emerald\|bg-amber\|bg-red-500\|bg-orange-500\|text-orange" \
     src/components/app/simulation/ \
     src/components/app/context-bar.tsx \
     src/components/app/filter-pills.tsx \
     src/components/app/legend-pills.tsx
   ```
   Expected: zero matches.

7. Mobile backdrop-filter budget check: Count `GlassCard` usage in the results panel. Each GlassCard has backdrop-filter. With 5 section cards + sidebar = 6 glass layers. Per MOBL-03, max 2 glass elements on mobile.

   If GlassCard applies backdrop-filter unconditionally, add a responsive override. Check GlassCard implementation for a `blur` prop or similar. If GlassCard wraps GlassPanel which has a `blur` prop, pass `blur="none"` for result section cards on mobile:
   - Option A: Add `className="md:[backdrop-filter:blur(5px)] [backdrop-filter:none]"` -- but Lightning CSS strips this.
   - Option B: Use GlassCard's `blur` prop if available, set to `"none"` on mobile via a media query approach.
   - Option C: Since GlassPanel applies blur via inline styles and reads the `blur` prop, the simplest fix is to NOT use backdrop-filter on result cards at all -- set `blur="none"` on the GlassCard. The cards still get the glass border/bg appearance without the expensive blur. This is acceptable per RESEARCH.md: "The visual difference is minimal on dark backgrounds."

   Apply the fix if needed: result section GlassCards should use `blur="none"` or equivalent to skip backdrop-filter. The glass border and semi-transparent background still provide the visual effect.
  </action>
  <verify>
Run `npx tsc --noEmit` and `pnpm build` -- both pass with no errors.
Run the comprehensive grep -- zero matches for legacy color classes.
  </verify>
  <done>
Dashboard page compiles and builds successfully with all migrated components. Zero legacy color classes remain in the migration scope. Mobile backdrop-filter budget addressed.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Phase 47 migration: Results panel (5 section cards as GlassCards with GlassProgress, Accordion, Badge, Typography), top bar (ContextBar + FilterPills + LegendPills as GlassPill), loading state (skeleton shimmer with staggered reveal + cancel button), ShareButton with toast notification, and ToastProvider in app layout.
  </what-built>
  <how-to-verify>
1. Start the dev server: `pnpm dev`
2. Navigate to the dashboard page
3. **Top bar verification:**
   - ContextBar shows "Switzerland" in a GlassPill with green dot
   - Filter pills show country names with colored dots, toggle active/inactive on click
   - Legend pills show role levels with colored dots
   - All pills have glass styling (subtle border, no hardcoded zinc backgrounds)
4. **Create a test to trigger loading and results:**
   - Click "Create a new test" button
   - Select a test type
   - Fill the form and submit
5. **Loading state verification:**
   - Skeleton shimmer cards appear matching the results layout shape
   - Skeletons appear in staggered sequence (not all at once)
   - Cancel button is visible below the skeletons
   - Shimmer animation is smooth (not jarring)
6. **Results panel verification (after simulation completes):**
   - ImpactScore shows in a GlassCard with coral accent score
   - Attention breakdown shows 3 GlassProgress bars (coral, blue, purple) with labels
   - Variants show in stacked rows inside a GlassCard
   - Insights show in expandable accordion rows
   - Themes show in expandable accordion rows with quotes
   - Share button shows toast notification on click (not inline "Copied!" text)
   - "Run another test" button has primary Button styling
   - Sticky header/footer work correctly during scroll
7. **Mobile verification (resize to < 768px):**
   - Top bar pills wrap or scroll (not clipped)
   - Results panel is usable and scrollable
   - No jank or lag from too many backdrop-filter elements
8. **Overall Raycast quality:**
   - Clean, dark, minimal aesthetic
   - Glass cards have subtle borders and hover lift effects
   - Typography uses consistent design tokens
   - No visible zinc/emerald/amber hardcoded colors
  </how-to-verify>
  <resume-signal>Type "approved" or describe any visual issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. Full build (`pnpm build`) passes.
2. TypeScript compilation (`npx tsc --noEmit`) passes.
3. Zero legacy color classes in migration scope.
4. Visual verification confirms Raycast-quality design system appearance.
5. Toast notification works for share action.
6. Loading skeleton shimmer displays correctly.
7. Accordion expand/collapse works for insights and themes.
8. Mobile viewport has acceptable performance (no jank from excessive blur).
</verification>

<success_criteria>
The complete dashboard -- top bar, loading state, results panel -- renders exclusively through design system components. Visual verification confirms Raycast-quality appearance with no legacy styled elements. This marks the completion of Wave 1 (dashboard design system migration).
</success_criteria>

<output>
After completion, create `.planning/phases/47-results-topbar-loading/47-05-SUMMARY.md`
</output>
