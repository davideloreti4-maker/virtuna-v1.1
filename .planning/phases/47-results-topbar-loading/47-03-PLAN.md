---
phase: 47-results-topbar-loading
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/context-bar.tsx
  - src/components/app/filter-pills.tsx
  - src/components/app/legend-pills.tsx
autonomous: true

must_haves:
  truths:
    - "ContextBar renders as a GlassPill with neutral color and a colored dot child -- not a raw styled div"
    - "FilterPill uses GlassPill with color='neutral', variant='outline', active prop, and a colored dot child"
    - "LegendPills uses GlassPill with color='neutral', active/inactive states, and colored dot children"
    - "All three components use zero hardcoded zinc/emerald color classes"
  artifacts:
    - path: "src/components/app/context-bar.tsx"
      provides: "GlassPill-based context bar"
      contains: "GlassPill"
    - path: "src/components/app/filter-pills.tsx"
      provides: "GlassPill-based filter pills with toggle"
      contains: "GlassPill"
    - path: "src/components/app/legend-pills.tsx"
      provides: "GlassPill-based legend pills"
      contains: "GlassPill"
  key_links:
    - from: "src/components/app/filter-pills.tsx"
      to: "@/components/primitives"
      via: "GlassPill import"
      pattern: "import.*GlassPill.*from.*primitives"
---

<objective>
Migrate the top bar components (ContextBar, FilterPillGroup, LegendPills) from hardcoded styled buttons to GlassPill design system components with neutral color and colored dot indicators.

Purpose: Top bar shows context and filter/legend pills using consistent GlassPill styling with toggleable active states, completing the top bar design system migration.

Output: 3 migrated top bar components using GlassPill primitives exclusively.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/47-results-topbar-loading/47-RESEARCH.md

Source files to migrate:
@src/components/app/context-bar.tsx
@src/components/app/filter-pills.tsx
@src/components/app/legend-pills.tsx

Design system component to use:
@src/components/primitives/GlassPill.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate ContextBar to GlassPill</name>
  <files>
    src/components/app/context-bar.tsx
  </files>
  <action>
**ContextBar migration:**

The ContextBar is a display-only pill showing a location name with a colored dot. Per CONTEXT.md: "ContextBar display style: Claude's Discretion" and RESEARCH.md recommendation: "Keep as a GlassPill with colored dot -- matches the filter pill visual language."

1. Import `GlassPill` from `@/components/primitives`.
2. Replace the entire inner div (the `rounded-full border border-zinc-800 bg-zinc-900/90 px-3 py-1.5` element) with:
   ```tsx
   <GlassPill color="neutral" size="md" variant="outline">
     <span
       className="h-2 w-2 rounded-full bg-success shrink-0"
       aria-hidden="true"
     />
     {location}
   </GlassPill>
   ```
3. The outer wrapper `<div className={cn("flex items-center", className)}>` stays for layout positioning.
4. Replace `bg-emerald-500` dot color with `bg-success` design token (maps to the same green).
5. Remove `text-zinc-300` -- GlassPill handles text color internally.
6. Keep same props interface `{ location, className }`.
  </action>
  <verify>
Run `npx tsc --noEmit` -- no type errors.
Run `grep -rn "zinc\|emerald" src/components/app/context-bar.tsx` -- no matches.
  </verify>
  <done>
ContextBar renders as a GlassPill with neutral styling and a green dot indicator. Zero hardcoded zinc/emerald classes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate FilterPillGroup and LegendPills to GlassPill</name>
  <files>
    src/components/app/filter-pills.tsx
    src/components/app/legend-pills.tsx
  </files>
  <action>
**FilterPill and FilterPillGroup migration (`filter-pills.tsx`):**

1. Import `GlassPill` from `@/components/primitives` and `cn` from `@/lib/utils`.
2. Replace the `FilterPill` component body. The raw `<button>` becomes `<GlassPill>`:
   ```tsx
   export function FilterPill({ label, color, active = true, onClick }: FilterPillProps) {
     return (
       <GlassPill
         color="neutral"
         size="md"
         variant="outline"
         active={active}
         onClick={onClick}
       >
         <span
           className={cn("h-2 w-2 rounded-full shrink-0", !active && "opacity-40")}
           style={{ backgroundColor: color }}
           aria-hidden="true"
         />
         {label}
       </GlassPill>
     );
   }
   ```
3. Per CONTEXT.md: "neutral glass style (GlassPill) with a small colored dot -- not tinted backgrounds" and "Active pills visually distinct from inactive."
4. `GlassPill`'s `active` prop handles the visual distinction (brighter bg, ring). The dot has `opacity-40` when inactive.
5. `FilterPillGroup` stays unchanged -- it manages toggle state via `useState` and renders `FilterPill` children. Just remove any lingering hardcoded class overrides.
6. Remove all `border-zinc-*`, `bg-zinc-*`, `text-zinc-*`, `text-white` classes. GlassPill handles all styling.

**LegendPills migration (`legend-pills.tsx`):**

1. Import `GlassPill` from `@/components/primitives` and `cn` from `@/lib/utils`.
2. Replace each legend pill `<button>` with `<GlassPill>`:
   ```tsx
   <GlassPill
     key={level.id}
     color="neutral"
     size="sm"
     variant="outline"
     active={isActive(level.id)}
     onClick={onToggle ? () => onToggle(level.id) : undefined}
   >
     <span
       className={cn(
         "h-2 w-2 rounded-full shrink-0",
         !isActive(level.id) && "opacity-40"
       )}
       style={{ backgroundColor: ROLE_LEVEL_COLORS[level.id] }}
       aria-hidden="true"
     />
     {level.label}
   </GlassPill>
   ```
3. The `ROLE_LEVELS` array currently uses Tailwind class names for colors (`bg-indigo-500`, `bg-emerald-500`, etc.). Since GlassPill dots use inline `style={{ backgroundColor }}`, convert these to hex values. Create a `ROLE_LEVEL_COLORS` mapping:
   ```tsx
   const ROLE_LEVEL_COLORS: Record<string, string> = {
     executive: "#6366F1", // indigo
     senior: "#10B981",    // emerald
     mid: "#EC4899",       // pink
     entry: "#F97316",     // orange
   };
   ```
4. Keep the `ROLE_LEVELS` export (other components may use it) but the color field is no longer a Tailwind class -- update it to store hex values, or keep the class field and add the hex mapping separately. The safer option is to add a separate hex map and keep `ROLE_LEVELS` backward-compatible.
5. Remove all `bg-zinc-*`, `text-zinc-*`, `rounded-full`, `px-3 py-1.5` manual classes -- GlassPill provides all of these.
6. The `disabled={!onToggle}` and `cursor-default` pattern: when `onClick` is undefined on GlassPill, it renders as a non-interactive element. This replaces the disabled button pattern.
  </action>
  <verify>
Run `npx tsc --noEmit` -- no type errors.
Run `grep -rn "zinc\|bg-indigo\|bg-emerald\|bg-pink\|bg-orange" src/components/app/filter-pills.tsx src/components/app/legend-pills.tsx` -- no matches for legacy color classes.
  </verify>
  <done>
FilterPill and FilterPillGroup render toggleable GlassPill components with neutral color + colored dots. LegendPills render as GlassPill with hex-based dot colors. Zero hardcoded zinc/indigo/emerald/pink/orange Tailwind classes remain.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes.
2. No hardcoded zinc/emerald/indigo/pink color classes in any of the 3 files.
3. All 3 components import and use `GlassPill` from `@/components/primitives`.
4. FilterPill `active` prop visually distinguishes active/inactive pills.
5. Existing prop interfaces preserved for backward compatibility.
</verification>

<success_criteria>
ContextBar, FilterPillGroup, and LegendPills all render using GlassPill primitives with neutral color and colored dot indicators. Active/inactive toggle states work correctly. Zero legacy styled elements remain.
</success_criteria>

<output>
After completion, create `.planning/phases/47-results-topbar-loading/47-03-SUMMARY.md`
</output>
