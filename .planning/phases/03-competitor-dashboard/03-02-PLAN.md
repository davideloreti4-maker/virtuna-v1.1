---
phase: 03-competitor-dashboard
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - src/components/competitors/competitor-table.tsx
  - src/components/competitors/competitor-empty-state.tsx
  - src/components/competitors/competitor-card-skeleton.tsx
  - src/components/competitors/competitor-table-skeleton.tsx
  - src/app/(app)/competitors/competitors-client.tsx
  - src/components/app/sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "User can toggle between card grid view and table/leaderboard view"
    - "Empty state with clear CTA appears when user has no tracked competitors"
    - "Loading skeleton states display while data is being fetched for cards and table"
    - "Competitors page is accessible via sidebar navigation"
  artifacts:
    - path: "src/components/competitors/competitor-table.tsx"
      provides: "Table/leaderboard view of competitors"
      exports: ["CompetitorTable"]
    - path: "src/components/competitors/competitor-empty-state.tsx"
      provides: "Empty state with CTA to add first competitor"
      exports: ["CompetitorEmptyState"]
    - path: "src/components/competitors/competitor-card-skeleton.tsx"
      provides: "Skeleton loading card placeholder"
      exports: ["CompetitorCardSkeleton"]
    - path: "src/components/competitors/competitor-table-skeleton.tsx"
      provides: "Skeleton loading table placeholder"
      exports: ["CompetitorTableSkeleton"]
    - path: "src/components/app/sidebar.tsx"
      provides: "Sidebar with Competitors nav entry"
      contains: "Competitors"
  key_links:
    - from: "src/app/(app)/competitors/competitors-client.tsx"
      to: "src/components/competitors/competitor-table.tsx"
      via: "Import and conditional render based on viewMode"
      pattern: "CompetitorTable"
    - from: "src/app/(app)/competitors/competitors-client.tsx"
      to: "src/stores/competitors-store.ts"
      via: "Zustand view toggle to switch grid/table"
      pattern: "useCompetitorsStore"
    - from: "src/app/(app)/competitors/competitors-client.tsx"
      to: "src/components/competitors/competitor-empty-state.tsx"
      via: "Rendered when competitors array is empty"
      pattern: "CompetitorEmptyState"
    - from: "src/components/app/sidebar.tsx"
      to: "/competitors"
      via: "Nav item href"
      pattern: "href.*competitors"
---

<objective>
Add table/leaderboard view, empty state, skeleton loading states, and sidebar navigation entry to complete the competitor dashboard.

Purpose: Completes all Phase 3 success criteria -- view toggle, empty state UX, loading states, and navigation discoverability.

Output: Full competitor dashboard with grid/table toggle, polished empty state, skeleton loading, and sidebar nav entry.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-competitor-dashboard/03-01-SUMMARY.md
@src/components/ui/skeleton.tsx
@src/components/ui/tabs.tsx
@src/components/ui/button.tsx
@src/components/app/sidebar.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create table view, empty state, and skeleton loading components</name>
  <files>
    src/components/competitors/competitor-table.tsx
    src/components/competitors/competitor-empty-state.tsx
    src/components/competitors/competitor-card-skeleton.tsx
    src/components/competitors/competitor-table-skeleton.tsx
  </files>
  <action>
    **1. Create `src/components/competitors/competitor-table.tsx`:**

    "use client" component. Props: same `CompetitorCardData[]` type from competitor-card.tsx (import the type).

    Render an HTML `<table>` with Raycast dark theme styling:
    - Table: `w-full text-sm`
    - Header row: `border-b border-white/[0.06]`, header cells `py-3 px-4 text-left font-medium text-foreground-muted text-xs`
    - Columns: Creator (avatar + handle), Followers, Likes, Videos, Eng. Rate, Growth, Trend (sparkline)
    - Body rows: `border-b border-white/[0.04] transition-colors hover:bg-white/[0.02]`, cells `py-3 px-4`
    - Creator cell: flex row with `<Avatar>` (size="sm") + handle text + display_name (muted, truncate)
    - Numeric cells: right-aligned (`text-right`), use `formatCount()` from competitors-utils
    - Eng. Rate cell: show computed engagement rate formatted to 1 decimal + "%" or "--"
    - Growth cell: `<GrowthDelta>` component (from competitor-card plan), or "--" if no data
    - Trend cell: `<CompetitorSparkline>` (width 64, height 24 for table compact size), or empty if < 2 snapshots
    - Add `cursor-pointer` to rows for future click navigation

    **2. Create `src/components/competitors/competitor-empty-state.tsx`:**

    Props: none (self-contained).

    Centered layout matching project empty state conventions:
    - Outer: `flex flex-col items-center justify-center py-20 px-4`
    - Icon container: `flex h-16 w-16 items-center justify-center rounded-2xl bg-white/[0.04] mb-4`
    - Icon: `UsersThree` from `@phosphor-icons/react` (size 32, weight "thin", className "text-foreground-muted")
    - Title: `text-lg font-medium text-foreground mb-1` -- "No competitors tracked yet"
    - Description: `text-sm text-foreground-muted mb-6 text-center max-w-sm` -- "Add your first TikTok competitor to start tracking their growth, engagement, and content strategy."
    - CTA button: `<Button variant="primary">Add Competitor</Button>` -- for now just a visual button (actual add-competitor flow is wired separately via the existing server action)

    **3. Create `src/components/competitors/competitor-card-skeleton.tsx`:**

    Skeleton card matching CompetitorCard layout. Use existing `<Card>`, `<CardContent>`, and `<Skeleton>` components:
    - Avatar placeholder: `<Skeleton className="h-10 w-10 rounded-full" />`
    - Handle text: `<Skeleton className="h-4 w-24 mb-1" />`
    - Display name: `<Skeleton className="h-3 w-16" />`
    - Stats grid (3 cols): 3x `<Skeleton className="h-8 rounded" />`
    - Bottom row: `<Skeleton className="h-5 w-16 rounded-full" />` (delta) + `<Skeleton className="h-8 w-20 rounded" />` (sparkline area)

    Export a `CompetitorCardSkeletonGrid` component that renders 6 skeleton cards in the same grid layout as the real cards (`grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4`).

    **4. Create `src/components/competitors/competitor-table-skeleton.tsx`:**

    Skeleton table matching CompetitorTable layout. Use `<Skeleton>`:
    - Same table header as real table (static text, not skeleton)
    - 5 skeleton rows, each with: avatar circle skeleton + text skeleton, then 5 metric cell skeletons (varying widths: w-16, w-14, w-12, w-12, w-16), then sparkline skeleton (w-16 h-6)
    - Wrap in the same table element styling as the real table
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify all files type-check. Verify imports from competitor-card.tsx (CompetitorCardData type) and competitors-utils.ts (formatCount) resolve.
  </verify>
  <done>
    Four new components created and type-checking: CompetitorTable renders tabular leaderboard view, CompetitorEmptyState shows centered empty state with CTA, CompetitorCardSkeleton/Grid and CompetitorTableSkeleton provide loading placeholders.
  </done>
</task>

<task type="auto">
  <name>Task 2: Wire view toggle, empty state, and skeletons into client component + add sidebar nav entry</name>
  <files>
    src/app/(app)/competitors/competitors-client.tsx
    src/components/app/sidebar.tsx
  </files>
  <action>
    **1. Update `src/app/(app)/competitors/competitors-client.tsx`:**

    Add imports for new components: CompetitorTable, CompetitorEmptyState, CompetitorCardSkeletonGrid, CompetitorTableSkeleton, and the Tabs components (Tabs, TabsList, TabsTrigger, TabsContent from `@/components/ui/tabs`).

    Replace the page header placeholder with a proper header row:
    - Left: h1 "Competitors" (`text-2xl font-medium text-foreground`)
    - Right: View toggle using Radix `<Tabs>` component with `value={viewMode}` and `onValueChange={setViewMode}`:
      ```
      <Tabs value={viewMode} onValueChange={(v) => setViewMode(v as ViewMode)}>
        <TabsList>
          <TabsTrigger value="grid" size="sm">Grid</TabsTrigger>
          <TabsTrigger value="table" size="sm">Table</TabsTrigger>
        </TabsList>
      </Tabs>
      ```
      Read viewMode and setViewMode from `useCompetitorsStore()`.

    Conditional rendering:
    - If competitors array is empty: render `<CompetitorEmptyState />`
    - If competitors array has items AND viewMode === "grid": render the card grid (already built in 03-01)
    - If competitors array has items AND viewMode === "table": render `<CompetitorTable competitors={flattenedCompetitors} />`

    Note: The Suspense/loading skeleton states are for the page-level loading. Create a `loading.tsx` file at `src/app/(app)/competitors/loading.tsx` that exports a default component rendering `<CompetitorCardSkeletonGrid />`. This leverages Next.js App Router's built-in loading.tsx convention for streaming/Suspense boundaries. The loading.tsx should render a page shell matching the competitors-client layout: same header ("Competitors" h1 + disabled tab toggle) + skeleton grid.

    Actually, create `src/app/(app)/competitors/loading.tsx` as an additional file:
    - Import CompetitorCardSkeletonGrid, Skeleton
    - Render: page header with "Competitors" h1 + a skeleton pill for the tabs area (`<Skeleton className="h-8 w-32 rounded-full" />`)
    - Below: `<CompetitorCardSkeletonGrid />` for the default grid skeleton

    **2. Update `src/components/app/sidebar.tsx`:**

    Add the Competitors nav item. Import `UsersThree` from `@phosphor-icons/react`.

    Add to the `navItems` array (after Trending, before the TikTok account selector section):
    ```typescript
    { label: "Competitors", icon: UsersThree, id: "competitors", href: "/competitors" }
    ```

    Update the `isActive` logic for the new item in the nav rendering: `pathname.startsWith("/competitors")`.

    The navItems array is `as const`, so it must be updated directly. Add the new entry as the third item in the array.
  </action>
  <verify>
    Run `npx tsc --noEmit` to verify all files type-check. Navigate to /competitors in the browser:
    1. Verify the page shows loading skeleton briefly on initial load
    2. Verify the sidebar shows "Competitors" nav item with UsersThree icon
    3. Verify clicking sidebar "Competitors" navigates to /competitors
    4. Verify the view toggle switches between grid and table views
    5. Verify empty state shows when no competitors are tracked
    6. Verify the view mode persists across page navigation (localStorage)
  </verify>
  <done>
    Competitors dashboard fully complete: card grid + table toggle via Radix Tabs, empty state with CTA, loading skeleton via Next.js loading.tsx, and sidebar "Competitors" nav entry. View mode persists in localStorage via Zustand.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. Sidebar shows "Competitors" item between "Trending" and the TikTok account selector
3. Clicking "Competitors" in sidebar navigates to /competitors
4. /competitors with no data shows empty state with "No competitors tracked yet" and CTA button
5. /competitors with data shows card grid by default
6. Clicking "Table" tab switches to table/leaderboard view
7. View mode persists across page navigation (reload page, same view selected)
8. Loading skeleton renders during page load (Next.js loading.tsx)
9. Table view shows all stats in columns: Creator, Followers, Likes, Videos, Eng. Rate, Growth, Trend
</verification>

<success_criteria>
- View toggle (grid/table) works via Radix Tabs and Zustand persist store
- Table view renders all competitor data in a sortable-ready leaderboard format
- Empty state renders centered with icon, title, description, and CTA button
- Skeleton loading states match the layout of both card grid and table views
- Next.js loading.tsx provides instant loading skeleton on navigation
- Sidebar "Competitors" entry appears and highlights when active
- All Phase 3 success criteria from ROADMAP.md are met
</success_criteria>

<output>
After completion, create `.planning/phases/03-competitor-dashboard/03-02-SUMMARY.md`
</output>
