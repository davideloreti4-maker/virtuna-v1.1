---
phase: 51-video-feed-cards
plan: 03
type: execute
wave: 2
depends_on: ["51-01", "51-02"]
files_modified:
  - src/components/trending/video-grid.tsx
  - src/app/(app)/trending/trending-client.tsx
autonomous: true

must_haves:
  truths:
    - "Responsive grid renders 3 columns on desktop, 2 on tablet, 1 on mobile"
    - "Grid is populated from mock data matching the active category tab"
    - "Scrolling to the bottom loads more cards with skeleton placeholders"
    - "Switching tabs resets the grid and shows skeleton loading flash"
    - "Empty state displays when no videos match the active filter"
    - "VideoCard click fires onClick handler (wired to console.log for now, modal in Phase 52)"
  artifacts:
    - path: "src/components/trending/video-grid.tsx"
      provides: "VideoGrid component with infinite scroll"
      exports: ["VideoGrid"]
    - path: "src/app/(app)/trending/trending-client.tsx"
      provides: "Updated TrendingClient using VideoGrid instead of VideoPlaceholder"
  key_links:
    - from: "src/components/trending/video-grid.tsx"
      to: "src/hooks/use-infinite-videos.ts"
      via: "useInfiniteVideos import"
      pattern: "useInfiniteVideos"
    - from: "src/components/trending/video-grid.tsx"
      to: "src/components/trending/video-card.tsx"
      via: "VideoCard import"
      pattern: "import.*VideoCard"
    - from: "src/components/trending/video-grid.tsx"
      to: "react-intersection-observer"
      via: "useInView for infinite scroll sentinel"
      pattern: "useInView"
    - from: "src/app/(app)/trending/trending-client.tsx"
      to: "src/components/trending/video-grid.tsx"
      via: "VideoGrid replaces VideoPlaceholder"
      pattern: "import.*VideoGrid|<VideoGrid"
---

<objective>
Build the VideoGrid component with infinite scroll and wire everything into the trending page.

Purpose: This plan connects all the pieces -- the useInfiniteVideos hook (Plan 01), the VideoCard components (Plan 02), and the existing TrendingClient shell (Phase 50) -- into a working responsive video grid with infinite scroll.
Output: VideoGrid component with StaggerReveal animation + useInView sentinel, and an updated trending-client.tsx that renders real video cards instead of the placeholder stub.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/51-video-feed-cards/51-01-SUMMARY.md
@.planning/phases/51-video-feed-cards/51-02-SUMMARY.md
@src/app/(app)/trending/trending-client.tsx
@src/hooks/use-infinite-videos.ts
@src/components/trending/video-card.tsx
@src/components/trending/video-card-skeleton.tsx
@src/components/trending/empty-state.tsx
@src/components/motion/stagger-reveal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VideoGrid with infinite scroll</name>
  <files>src/components/trending/video-grid.tsx</files>
  <action>
Create `src/components/trending/video-grid.tsx` -- the responsive grid component that:
1. Uses `useInfiniteVideos` to get paginated videos for the active category
2. Renders VideoCard components in a StaggerReveal grid
3. Uses `useInView` from `react-intersection-observer` for the infinite scroll sentinel
4. Shows VideoCardSkeleton placeholders when loading more
5. Shows EmptyState when no videos match

Component structure:

```tsx
"use client";

import { useEffect } from "react";
import { useInView } from "react-intersection-observer";
import { StaggerReveal } from "@/components/motion";
import { useInfiniteVideos } from "@/hooks/use-infinite-videos";
import { VideoCard } from "./video-card";
import { VideoCardSkeleton } from "./video-card-skeleton";
import { EmptyState } from "./empty-state";
import type { TrendingCategory } from "@/types/trending";

interface VideoGridProps {
  category: TrendingCategory;
}

export function VideoGrid({ category }: VideoGridProps) {
  const { videos, hasMore, loadMore, isLoadingMore, total } = useInfiniteVideos(category);
  const { ref: sentinelRef, inView } = useInView({
    threshold: 0,
    rootMargin: "200px",  // Trigger 200px before sentinel enters viewport
  });

  // Trigger loadMore when sentinel is visible
  useEffect(() => {
    if (inView && hasMore && !isLoadingMore) {
      loadMore();
    }
  }, [inView, hasMore, isLoadingMore, loadMore]);

  // Empty state
  if (videos.length === 0) {
    return <EmptyState category={category} />;
  }

  return (
    <div>
      {/* Responsive grid with stagger animation */}
      <StaggerReveal className="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3">
        {videos.map((video) => (
          <StaggerReveal.Item key={video.id}>
            <VideoCard
              video={video}
              onClick={() => {
                // Phase 52 will wire this to the detail modal
                console.log("[VideoCard] clicked:", video.id, video.title);
              }}
            />
          </StaggerReveal.Item>
        ))}
      </StaggerReveal>

      {/* Infinite scroll sentinel + skeleton loading */}
      {hasMore && (
        <div ref={sentinelRef} className="mt-5">
          {isLoadingMore && (
            <div className="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3">
              {Array.from({ length: 3 }).map((_, i) => (
                <VideoCardSkeleton key={`skeleton-${i}`} />
              ))}
            </div>
          )}
        </div>
      )}
    </div>
  );
}
```

Key decisions:
- `rootMargin: "200px"` triggers loading 200px before the sentinel enters viewport (smooth UX)
- Sentinel div always renders when `hasMore`, but skeletons only show during `isLoadingMore`
- 3 skeleton placeholders match one desktop row (visual consistency)
- `StaggerReveal.Item` wraps each card for sequential entrance animation
- `onClick` wired to console.log (Phase 52 will replace with modal open)
- Grid uses same classes as existing SkeletonGrid: `grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-5`

**Important:** Check whether `StaggerReveal.Item` is accessed as `StaggerReveal.Item` (compound component) or imported as `StaggerRevealItem`. Check the barrel export in `@/components/motion/index.ts`:
- If it exports `StaggerRevealItem` separately, import it directly
- If StaggerReveal has a `.Item` property, use compound syntax

The barrel exports `StaggerRevealItem` as a named export. Check stagger-reveal.tsx to see if StaggerReveal also has a `.Item` compound property. Use whichever pattern the codebase establishes.
  </action>
  <verify>
- File exists at src/components/trending/video-grid.tsx
- `pnpm tsc --noEmit` passes
- VideoGrid imports useInfiniteVideos, VideoCard, VideoCardSkeleton, EmptyState, StaggerReveal, useInView
- Grid uses responsive Tailwind classes (grid-cols-1 sm:grid-cols-2 lg:grid-cols-3)
  </verify>
  <done>VideoGrid component created with responsive grid, StaggerReveal animation, infinite scroll via useInView sentinel, skeleton loading states, and empty state</done>
</task>

<task type="auto">
  <name>Task 2: Wire VideoGrid into TrendingClient (replace VideoPlaceholder)</name>
  <files>src/app/(app)/trending/trending-client.tsx</files>
  <action>
Update `src/app/(app)/trending/trending-client.tsx` to replace the stub `VideoPlaceholder` component with the real `VideoGrid`.

Changes:

1. **Add import** at top of file:
   ```tsx
   import { VideoGrid } from "@/components/trending/video-grid";
   ```

2. **Remove the VideoPlaceholder component** (lines ~96-116) -- it's the stub that says "Video cards coming in Phase 51".

3. **Remove the EmptyState component** (lines ~81-93) -- it's been extracted to `src/components/trending/empty-state.tsx`. The VideoGrid handles empty state internally.

4. **Remove the Inbox import** from lucide-react (was only used by the old EmptyState). Keep TrendingUp, Flame, RotateCcw.

5. **Update the tab content area** (currently around line 218-223):

   Replace:
   ```tsx
   {isLoading ? (
     <SkeletonGrid />
   ) : (
     <VideoPlaceholder category={activeTab} />
   )}
   ```

   With:
   ```tsx
   {isLoading ? (
     <SkeletonGrid />
   ) : (
     <VideoGrid category={activeTab} />
   )}
   ```

6. **Keep SkeletonGrid** as-is for the tab-switching loading flash. It still serves its purpose for the 250ms skeleton during tab transitions. The VideoGrid has its OWN skeleton loading at the bottom for infinite scroll -- they serve different purposes.

7. **Keep all other existing code** (formatCompactNumber, StatsBar, CategoryTabs, URL sync, popstate handler). No other changes needed.

The result: switching tabs shows SkeletonGrid briefly (250ms flash), then VideoGrid renders with real VideoCard components. Scrolling down triggers infinite scroll with more cards.
  </action>
  <verify>
- `pnpm tsc --noEmit` passes
- VideoPlaceholder component is removed from trending-client.tsx
- Old EmptyState component is removed from trending-client.tsx
- VideoGrid is imported and used in place of VideoPlaceholder
- SkeletonGrid is still present for tab-switching loading flash
- No unused imports (Inbox removed if not used elsewhere)
- `pnpm dev` starts without errors and `/trending` page renders
  </verify>
  <done>TrendingClient renders real VideoGrid with VideoCard components instead of the Phase 50 placeholder. Tab switching, URL sync, stats bar all preserved.</done>
</task>

</tasks>

<verification>
- `pnpm tsc --noEmit` passes
- `pnpm dev` starts and `/trending` page loads without errors
- VideoGrid renders in responsive 3/2/1 column layout
- VideoCards show thumbnail images from picsum.photos
- Scrolling down loads more cards with skeleton placeholders
- Tab switching shows skeleton flash then new category's videos
- Empty state shown if any tab has no videos (unlikely with 42 mock videos, but the code path exists)
- VideoCard click logs to console (placeholder for Phase 52 modal)
</verification>

<success_criteria>
The trending page shows a responsive grid of real video cards that respond to category tab changes, load progressively via infinite scroll, and display all required metadata (thumbnail, creator, views, date, category pill, velocity indicator).
</success_criteria>

<output>
After completion, create `.planning/phases/51-video-feed-cards/51-03-SUMMARY.md`
</output>
