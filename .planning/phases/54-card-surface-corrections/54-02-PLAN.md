---
phase: 54-card-surface-corrections
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/input.tsx
  - src/components/ui/textarea.tsx
  - src/components/ui/index.ts
autonomous: true

must_haves:
  truths:
    - "Base Input renders with rgba(255,255,255,0.05) background, 5% border, 42px height, and 8px border-radius"
    - "Input supports leftIcon, rightIcon, showClear, onClear, loading, size variants, and string error messages -- all features from GlassInput"
    - "Textarea renders with same Raycast styling (white/5 bg, 5% border, 8px radius) and supports autoResize with minRows/maxRows"
    - "ui/index.ts exports Textarea and TextareaProps"
  artifacts:
    - path: "src/components/ui/input.tsx"
      provides: "Unified Input with all GlassInput features + Raycast styling"
      contains: "h-[42px]"
    - path: "src/components/ui/textarea.tsx"
      provides: "Textarea with Raycast styling + auto-resize from GlassTextarea"
      contains: "autoResize"
    - path: "src/components/ui/index.ts"
      provides: "Barrel export for Textarea"
      contains: "Textarea"
  key_links:
    - from: "src/components/ui/input.tsx"
      to: "Raycast pattern"
      via: "inline style backgroundColor rgba(255,255,255,0.05)"
      pattern: "rgba.*255.*255.*255.*0\\.05"
    - from: "src/components/ui/textarea.tsx"
      to: "GlassTextarea"
      via: "Preserves autoResize/minRows/maxRows logic"
      pattern: "autoResize"
---

<objective>
Consolidate Input and Textarea components to Raycast-exact styling, merging all GlassInput/GlassTextarea features into the base UI components.

Purpose: After this plan, there's a single source of truth for input styling (ui/input.tsx) and textarea styling (ui/textarea.tsx), both matching Raycast exactly. GlassInput and GlassTextarea become thin re-export wrappers (Plan 03).

Output: Updated input.tsx with GlassInput features, new textarea.tsx with GlassTextarea features, updated ui/index.ts.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/54-card-surface-corrections/54-RESEARCH.md

Current Input (ui/input.tsx):
- h-11 (44px) -- needs to be h-[42px]
- bg-white/5 -- correct value but border uses `border-border` (6%) instead of white/5 (5%)
- rounded-md -- needs to be rounded-[8px] explicitly
- Only has error as boolean
- No icons, no clear button, no loading, no size variants

GlassInput (primitives/GlassInput.tsx) has these ADDITIONAL features to merge:
- size variants: sm (h-8), md (h-[42px]), lg (h-12)
- leftIcon: ReactNode with positioning
- rightIcon: ReactNode with positioning
- showClear + onClear: clear button when value exists
- loading: spinner state with Loader2 icon
- error as boolean | string (string shows error message)
- wrapperClassName for the outer div
- Inline bg: rgba(255,255,255,0.05), backdrop-filter blur(8px)

GlassTextarea (primitives/GlassTextarea.tsx) has:
- size variants: sm, md, lg
- autoResize with minRows/maxRows
- ResizeObserver for dynamic content
- error as boolean
- Inline bg: rgba(255,255,255,0.05), backdrop-filter blur(8px)

Raycast input reference:
- background-color: rgba(255,255,255,0.05)
- border: 1px solid rgba(255,255,255,0.05)  <-- 5% border, NOT 6%
- border-radius: 8px
- height: 42px

IMPORTANT: Input border should be border-white/5 (5%), NOT border-border (6%). Inputs use 5% in Raycast.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Merge GlassInput features into base Input</name>
  <files>src/components/ui/input.tsx</files>
  <action>
Rewrite src/components/ui/input.tsx to merge ALL GlassInput features into the base Input component while maintaining Raycast-exact styling.

**InputProps changes:**
- Add `size?: "sm" | "md" | "lg"` (default "md")
- Change `error` from `boolean` to `boolean | string` (string = error message)
- Add `loading?: boolean`
- Add `leftIcon?: ReactNode`
- Add `rightIcon?: ReactNode`
- Add `showClear?: boolean`
- Add `onClear?: () => void`
- Add `wrapperClassName?: string`
- Import `Loader2, X` from `lucide-react` and `ReactNode` from `react`

**Size styles map** (from GlassInput):
```tsx
const sizeStyles = {
  sm: { input: "h-8 px-2.5 text-[13px]", icon: "w-4 h-4", iconPadding: { left: "pl-8", right: "pr-8" } },
  md: { input: "h-[42px] px-3 text-[14px]", icon: "w-5 h-5", iconPadding: { left: "pl-10", right: "pr-10" } },
  lg: { input: "h-12 px-4 text-[15px]", icon: "w-5 h-5", iconPadding: { left: "pl-11", right: "pr-11" } },
} as const;
```

**Input component rewrite:**
The Input component now renders a wrapper div (when icons/clear/loading are present) or a plain input (when no wrapper needed):

```tsx
const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className, type, error, size = "md", loading = false, leftIcon, rightIcon, showClear = false, onClear, disabled, wrapperClassName, value, style, ...props }, ref) => {
    const hasError = !!error;
    const hasValue = value !== undefined && value !== "";
    const showClearButton = showClear && hasValue && !disabled && !loading;
    const styles = sizeStyles[size];
    const needsWrapper = leftIcon || rightIcon || loading || showClear;

    const paddingLeft = leftIcon ? styles.iconPadding.left : "";
    const paddingRight = (rightIcon || loading || showClearButton) ? styles.iconPadding.right : "";

    const inputElement = (
      <input
        type={type}
        disabled={disabled || loading}
        value={value}
        className={cn(
          "flex w-full rounded-[8px] border border-white/5",
          styles.input,
          needsWrapper ? "" : "w-full",
          paddingLeft,
          paddingRight,
          "text-foreground placeholder:text-foreground-muted",
          "transition-all duration-150",
          !disabled && !hasError && "hover:border-white/10",
          !disabled && !hasError && "focus:outline-none focus:ring-2 focus:ring-accent/50 focus:border-accent",
          disabled && "opacity-50 cursor-not-allowed",
          loading && "cursor-wait",
          hasError ? "border-[var(--color-red)] focus:ring-[var(--color-red-transparent)] focus:border-[var(--color-red)]" : "",
          className
        )}
        style={{
          backgroundColor: "rgba(255, 255, 255, 0.05)",
          ...style,
        }}
        aria-invalid={hasError || undefined}
        aria-describedby={typeof error === "string" && props.id ? `${props.id}-error` : undefined}
        ref={ref}
        {...props}
      />
    );

    // Simple input without wrapper
    if (!needsWrapper) {
      return (
        <>
          {inputElement}
          {typeof error === "string" && props.id && (
            <p id={`${props.id}-error`} className="mt-1.5 text-sm text-error" role="alert">{error}</p>
          )}
        </>
      );
    }

    // Input with icon/clear/loading wrapper
    return (
      <div className={cn("relative w-full", wrapperClassName)}>
        {leftIcon && (
          <div className={cn("absolute left-3 top-1/2 -translate-y-1/2 pointer-events-none text-foreground-muted transition-colors", hasError && "text-error", styles.icon)}>
            {leftIcon}
          </div>
        )}
        {inputElement}
        <div className="absolute right-3 top-1/2 -translate-y-1/2 flex items-center gap-1">
          {loading && <Loader2 className={cn("animate-spin text-foreground-muted", styles.icon)} aria-label="Loading" />}
          {showClearButton && (
            <button type="button" onClick={onClear} className={cn("text-foreground-muted hover:text-foreground transition-colors rounded p-0.5", styles.icon)} aria-label="Clear input" tabIndex={-1}>
              <X className="w-full h-full" />
            </button>
          )}
          {rightIcon && !loading && !showClearButton && (
            <div className={cn("pointer-events-none text-foreground-muted", hasError && "text-error", styles.icon)}>{rightIcon}</div>
          )}
        </div>
        {typeof error === "string" && props.id && (
          <p id={`${props.id}-error`} className="mt-1.5 text-sm text-error" role="alert">{error}</p>
        )}
      </div>
    );
  }
);
```

**InputField changes:**
- Update to pass through new props (size, leftIcon, rightIcon, etc.) -- these should be part of InputFieldProps via the Omit spread
- The error handling already supports string | boolean -- just ensure it passes `error` correctly to Input
- InputFieldProps extends `Omit<InputProps, "error">` and redefines `error?: string | boolean` -- this already works

**Export types:**
- Export `InputSize` type alias: `export type InputSize = "sm" | "md" | "lg";`

CRITICAL: Remove the old `border-border` and `bg-white/5` class from the base styles. The background comes from inline style, and border is now `border-white/5` (5% not 6%).
CRITICAL: Keep "use client" directive at top.
  </action>
  <verify>
Run `grep -n "h-\[42px\]" src/components/ui/input.tsx` -- should match in sizeStyles md.
Run `grep -n "border-white/5" src/components/ui/input.tsx` -- should match (5% border).
Run `grep -n "rounded-\[8px\]" src/components/ui/input.tsx` -- should match.
Run `grep -n "leftIcon" src/components/ui/input.tsx` -- should match (icon support merged).
Run `grep -n "Loader2" src/components/ui/input.tsx` -- should match (loading spinner).
Run `pnpm build` -- should pass without type errors.
  </verify>
  <done>Base Input has all GlassInput features: size variants (sm/md/lg), leftIcon, rightIcon, showClear, onClear, loading spinner, error as string|boolean, wrapperClassName. Renders with rgba(255,255,255,0.05) bg, 5% border, 42px default height, 8px radius. InputField still works with extended error support.</done>
</task>

<task type="auto">
  <name>Task 2: Create Textarea component and update barrel exports</name>
  <files>src/components/ui/textarea.tsx, src/components/ui/index.ts</files>
  <action>
**Create src/components/ui/textarea.tsx:**

Build a new Textarea component that consolidates GlassTextarea features with Raycast-exact styling:

```tsx
"use client";

import * as React from "react";
import { cn } from "@/lib/utils";

export type TextareaSize = "sm" | "md" | "lg";

export interface TextareaProps
  extends Omit<React.TextareaHTMLAttributes<HTMLTextAreaElement>, "size"> {
  /** Size variant affects padding and font size */
  size?: TextareaSize;
  /** Error state with optional message */
  error?: boolean;
  /** Enable auto-resize behavior that grows with content */
  autoResize?: boolean;
  /** Minimum number of rows (default: 3) */
  minRows?: number;
  /** Maximum number of rows when autoResize is enabled */
  maxRows?: number;
}
```

Size map:
```tsx
const sizeMap = {
  sm: "px-3 py-2 text-[13px] min-h-[80px]",
  md: "px-3 py-3 text-[14px] min-h-[120px]",
  lg: "px-4 py-4 text-[15px] min-h-[160px]",
} as const;
```

Component implementation:
- Copy the auto-resize logic from GlassTextarea (useEffect with ResizeObserver + handleChange)
- Use the SAME ref pattern as GlassTextarea (internal ref + forwarded ref)
- Styling: `w-full rounded-[8px] border border-white/5`
- Text: `text-foreground placeholder:text-foreground-muted`
- Transitions: `transition-all duration-150`
- Hover: `hover:border-white/10`
- Focus: `focus:outline-none focus:ring-2 focus:ring-accent/50 focus:border-accent`
- Error: `border-[var(--color-red)] focus:ring-[var(--color-red-transparent)]`
- Disabled: `opacity-50 cursor-not-allowed`
- Resize: `autoResize ? "resize-none overflow-hidden" : "resize-y"`
- Inline style: `backgroundColor: "rgba(255, 255, 255, 0.05)"`
- Do NOT include backdrop-filter on textarea (inputs don't need blur in Raycast)

Export: `export { Textarea }`

**Update src/components/ui/index.ts:**

Add Textarea exports after the Input exports:

```tsx
// Textarea
export { Textarea } from "./textarea";
export type { TextareaProps, TextareaSize } from "./textarea";
```

Also add InputSize export to the existing Input section:
```tsx
export type { InputProps, InputFieldProps, InputSize } from "./input";
```
  </action>
  <verify>
Run `grep -n "autoResize" src/components/ui/textarea.tsx` -- should match (auto-resize preserved).
Run `grep -n "ResizeObserver" src/components/ui/textarea.tsx` -- should match.
Run `grep -n "rounded-\[8px\]" src/components/ui/textarea.tsx` -- should match.
Run `grep -n "Textarea" src/components/ui/index.ts` -- should match export.
Run `pnpm build` -- should pass without type errors.
  </verify>
  <done>New Textarea component exists at ui/textarea.tsx with Raycast-exact styling (white/5 bg, 5% border, 8px radius) and all GlassTextarea features (autoResize, minRows, maxRows, size variants, error state). Exported from ui/index.ts barrel.</done>
</task>

</tasks>

<verification>
After both tasks:
1. `pnpm build` completes without errors
2. `grep -rn "h-11" src/components/ui/input.tsx` returns 0 matches (44px replaced with 42px)
3. `grep -rn "border-border" src/components/ui/input.tsx` returns 0 matches for the input itself (uses white/5 now)
4. src/components/ui/textarea.tsx exists and exports Textarea
5. `grep -n "Textarea" src/components/ui/index.ts` shows barrel export
</verification>

<success_criteria>
- Input renders at 42px height with rgba(255,255,255,0.05) bg, 5% border, 8px radius
- Input supports all GlassInput features: size variants, icons, clear, loading, string errors
- Textarea renders with same Raycast styling + auto-resize from GlassTextarea
- Both components exported from ui/index.ts
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/54-card-surface-corrections/54-02-SUMMARY.md`
</output>
