---
phase: 35-results-card-structure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/viral-results.ts
  - src/components/viral-results/ViralScoreRing.tsx
  - src/components/viral-results/index.ts
autonomous: true

must_haves:
  truths:
    - "Score ring displays /100 with animated circular gauge"
    - "Ring color shifts from red through yellow to green as it fills"
    - "Score number counts up with animation timing"
    - "5+ tier labels render based on score thresholds"
  artifacts:
    - path: "src/types/viral-results.ts"
      provides: "ViralResult, ViralFactor, ViralTier types"
      exports: ["ViralResult", "ViralFactor", "ViralTier", "VIRAL_TIERS"]
    - path: "src/components/viral-results/ViralScoreRing.tsx"
      provides: "Animated circular gauge with gradient fill"
      min_lines: 80
    - path: "src/components/viral-results/index.ts"
      provides: "Barrel export for viral results components"
  key_links:
    - from: "src/components/viral-results/ViralScoreRing.tsx"
      to: "src/types/viral-results.ts"
      via: "imports ViralTier, VIRAL_TIERS"
      pattern: "import.*ViralTier.*viral-results"
---

<objective>
Create the viral score type definitions and animated score ring component - the hero element of the results card.

Purpose: Establish type foundation and build the most visually impressive component first (the "wow moment" centerpiece)
Output: TypeScript types for viral analysis results and an animated circular score gauge with gradient color shift
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-results-card-structure/35-CONTEXT.md
@src/app/globals.css (design tokens: oklch colors, gradient palette)
@src/components/primitives/GlassPanel.tsx (reference for component patterns)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create viral results types and tier system</name>
  <files>src/types/viral-results.ts</files>
  <action>
Create comprehensive TypeScript types for the viral prediction results system:

```typescript
// Tier labels with score thresholds - 5+ tiers as specified
export type ViralTier =
  | "Viral Ready"      // 85-100: Top tier, ready to blow up
  | "High Potential"   // 70-84: Strong viral indicators
  | "Promising"        // 55-69: Good foundation, needs refinement
  | "Moderate"         // 40-54: Average content
  | "Low Potential"    // 25-39: Needs significant work
  | "Unlikely";        // 0-24: Missing key viral elements

// Tier configuration with colors and thresholds
export const VIRAL_TIERS: Record<ViralTier, { min: number; max: number; color: string; ringColor: string }> = {
  "Viral Ready": { min: 85, max: 100, color: "text-emerald-400", ringColor: "#34d399" },
  "High Potential": { min: 70, max: 84, color: "text-green-400", ringColor: "#4ade80" },
  "Promising": { min: 55, max: 69, color: "text-lime-400", ringColor: "#a3e635" },
  "Moderate": { min: 40, max: 54, color: "text-yellow-400", ringColor: "#facc15" },
  "Low Potential": { min: 25, max: 39, color: "text-orange-400", ringColor: "#fb923c" },
  "Unlikely": { min: 0, max: 24, color: "text-red-400", ringColor: "#f87171" },
};

// Individual factor in the breakdown
export interface ViralFactor {
  id: string;
  name: string;           // e.g., "Hook Strength", "Emotional Triggers"
  score: number;          // 1-10 scale
  maxScore: number;       // Usually 10
  description: string;    // Short explanation
  details?: string;       // Expanded content for accordion
  tips?: string[];        // Actionable improvement suggestions
}

// Confidence level for transparency
export type ConfidenceLevel = "High" | "Medium" | "Low";

// Main viral result interface
export interface ViralResult {
  id: string;
  overallScore: number;   // 0-100
  tier: ViralTier;
  confidence: ConfidenceLevel;
  confidenceReason?: string;  // "Based on X data points"
  factors: ViralFactor[];
  generatedAt: Date;
}

// Helper to get tier from score
export function getTierFromScore(score: number): ViralTier {
  const entries = Object.entries(VIRAL_TIERS) as [ViralTier, typeof VIRAL_TIERS[ViralTier]][];
  for (const [tier, config] of entries) {
    if (score >= config.min && score <= config.max) {
      return tier;
    }
  }
  return "Unlikely"; // Fallback
}
```

Export all types and utilities for use across the viral results components.
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit src/types/viral-results.ts`</verify>
  <done>Types file exists with ViralResult, ViralFactor, ViralTier, VIRAL_TIERS exported</done>
</task>

<task type="auto">
  <name>Task 2: Create animated ViralScoreRing component</name>
  <files>src/components/viral-results/ViralScoreRing.tsx</files>
  <action>
Create the hero score ring component with animated gradient fill:

**Props interface:**
```typescript
interface ViralScoreRingProps {
  score: number;          // 0-100
  tier: ViralTier;
  size?: "sm" | "md" | "lg";  // Ring size variants
  animated?: boolean;     // Enable/disable animations
  className?: string;
}
```

**Implementation requirements:**

1. **SVG circular gauge:**
   - Use SVG circle with `stroke-dasharray` and `stroke-dashoffset` for progress
   - Ring sits around centered score number
   - Background track ring (subtle gray/white 10%)
   - Foreground progress ring with gradient

2. **Gradient color shift animation:**
   - SVG linearGradient that shifts colors based on score
   - Low scores: red gradient (0-39)
   - Medium scores: yellow/orange gradient (40-69)
   - High scores: green gradient (70-100)
   - Use the tier's `ringColor` from VIRAL_TIERS for the primary stop

3. **Ring fill animation:**
   - Duration: 1.5-2s (as specified in CONTEXT)
   - Easing: ease-out-cubic (from globals.css)
   - Ring fills from 0 to final score percentage
   - Use CSS transition on `stroke-dashoffset`

4. **Score number count-up:**
   - Animate from 0 to final score
   - Same duration as ring animation (1.5s)
   - Use `useState` + `useEffect` with `requestAnimationFrame` or interval
   - Display as large centered number with "/100" suffix

5. **Tier label display:**
   - Show tier label (e.g., "High Potential") below the ring
   - Apply tier color class from VIRAL_TIERS
   - Fade in after ring animation completes

6. **Size variants:**
   - sm: 120px diameter, score text-3xl
   - md: 180px diameter (default), score text-5xl
   - lg: 240px diameter, score text-7xl

**Styling notes:**
- Use Tailwind where possible
- Dark background compatible (designed for near-black bg)
- Ring stroke width: 8-12px depending on size
- Number uses bold font weight

**Reduced motion:**
- Respect `prefers-reduced-motion`: instant fill, no count-up
- Use CSS media query or `useReducedMotion` hook
  </action>
  <verify>
Build passes: `npm run build`
Component renders: Create a test at /viral-score-test in (marketing) route group to visually verify
  </verify>
  <done>
ViralScoreRing component displays animated circular gauge with:
- Gradient fill that shifts colors based on score
- Count-up animation for score number
- Tier label below with appropriate color
- Reduced motion support
  </done>
</task>

<task type="auto">
  <name>Task 3: Create barrel export and test page</name>
  <files>src/components/viral-results/index.ts, src/app/(marketing)/viral-score-test/page.tsx</files>
  <action>
1. **Create barrel export:**
```typescript
// src/components/viral-results/index.ts
export { ViralScoreRing } from './ViralScoreRing';
export type { ViralScoreRingProps } from './ViralScoreRing';
```

2. **Create test page for visual verification:**
```typescript
// src/app/(marketing)/viral-score-test/page.tsx
"use client";

import { ViralScoreRing } from '@/components/viral-results';
import { VIRAL_TIERS } from '@/types/viral-results';

export default function ViralScoreTestPage() {
  return (
    <div className="min-h-screen bg-bg-base p-8">
      <h1 className="text-2xl font-bold text-text-primary mb-8">Viral Score Ring Test</h1>

      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
        {/* Test each tier threshold */}
        {[95, 75, 60, 45, 30, 15].map((score) => (
          <div key={score} className="flex flex-col items-center gap-4 p-6 bg-surface rounded-xl">
            <ViralScoreRing score={score} tier={getTierFromScore(score)} />
          </div>
        ))}

        {/* Size variants */}
        <div className="col-span-full flex justify-center gap-8 p-6 bg-surface rounded-xl">
          <ViralScoreRing score={78} tier="High Potential" size="sm" />
          <ViralScoreRing score={78} tier="High Potential" size="md" />
          <ViralScoreRing score={78} tier="High Potential" size="lg" />
        </div>
      </div>
    </div>
  );
}
```

Import the `getTierFromScore` helper from types.
  </action>
  <verify>
Build passes: `npm run build`
Test page loads: `curl -s http://localhost:3000/viral-score-test | grep "Viral Score Ring"`
  </verify>
  <done>
Barrel export exists at @/components/viral-results
Test page at /viral-score-test displays all tier variants and sizes
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. Types imported correctly: `import { ViralResult, VIRAL_TIERS } from '@/types/viral-results'`
3. Component imported correctly: `import { ViralScoreRing } from '@/components/viral-results'`
4. Test page renders at /viral-score-test with animated rings for each tier
5. Ring animation runs for ~1.5s with color gradient
6. Reduced motion users see instant render (no animation)
</verification>

<success_criteria>
- ViralScoreRing component renders animated circular gauge
- Score counts up from 0 to final value
- Ring color gradient shifts based on score tier
- Tier label displays below ring with appropriate color
- All 6 tier thresholds work correctly
- Size variants (sm/md/lg) render at correct dimensions
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/35-results-card-structure/35-01-SUMMARY.md`
</output>
