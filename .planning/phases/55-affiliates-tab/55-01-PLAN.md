---
phase: 55-affiliates-tab
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/lib/affiliate-utils.ts
  - src/components/app/brand-deals/affiliate-link-card.tsx
  - src/components/app/brand-deals/available-product-card.tsx
  - src/components/app/brand-deals/affiliates-empty-state.tsx
autonomous: true

must_haves:
  truths:
    - "Affiliate link card displays product name, truncated URL, copy button, status badge, and three mini KPI stat blocks (clicks, conversions, earned)"
    - "Copy button on affiliate link card morphs from Copy to Check icon for 2 seconds when clicked"
    - "Available product card displays brand logo, product name, hero commission rate percentage, and Generate Link CTA button"
    - "Empty state displays when no active links exist with guidance to generate links from products below"
  artifacts:
    - path: "src/lib/affiliate-utils.ts"
      provides: "formatCurrency and formatNumber utility functions"
      exports: ["formatCurrency", "formatNumber"]
    - path: "src/components/app/brand-deals/affiliate-link-card.tsx"
      provides: "AffiliateLinkCard presentational component with stats and copy-to-clipboard"
      exports: ["AffiliateLinkCard"]
    - path: "src/components/app/brand-deals/available-product-card.tsx"
      provides: "AvailableProductCard presentational component with hero commission rate"
      exports: ["AvailableProductCard"]
    - path: "src/components/app/brand-deals/affiliates-empty-state.tsx"
      provides: "AffiliatesEmptyState component for zero active links"
      exports: ["AffiliatesEmptyState"]
  key_links:
    - from: "src/components/app/brand-deals/affiliate-link-card.tsx"
      to: "src/hooks/useCopyToClipboard.ts"
      via: "useCopyToClipboard hook for clipboard + icon morph"
      pattern: "useCopyToClipboard"
    - from: "src/components/app/brand-deals/affiliate-link-card.tsx"
      to: "src/lib/affiliate-utils.ts"
      via: "formatCurrency and formatNumber for stat display"
      pattern: "formatCurrency|formatNumber"
---

<objective>
Create the presentational components and formatting utilities for the Affiliates Tab: AffiliateLinkCard with mini KPI stat blocks and copy-to-clipboard icon morph, AvailableProductCard with hero commission rate and Generate Link CTA, AffiliatesEmptyState, and shared formatting utilities.

Purpose: These are the visual building blocks that AffiliatesTab (Plan 02) will compose into the full tab experience.
Output: Four files -- three React components and one utility module.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/55-affiliates-tab/55-CONTEXT.md
@.planning/phases/55-affiliates-tab/55-RESEARCH.md

@src/types/brand-deals.ts
@src/hooks/useCopyToClipboard.ts
@src/lib/deal-utils.ts
@src/components/app/brand-deals/deal-card.tsx
@src/components/app/brand-deals/deals-empty-state.tsx
@src/components/ui/avatar.tsx
@src/components/ui/badge.tsx
@src/components/ui/button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create formatting utilities and AffiliateLinkCard component</name>
  <files>
    src/lib/affiliate-utils.ts
    src/components/app/brand-deals/affiliate-link-card.tsx
  </files>
  <action>
    **1. Create `src/lib/affiliate-utils.ts`** with two exported functions:
    - `formatCurrency(amount: number): string` -- uses `Intl.NumberFormat("en-US", { style: "currency", currency: "USD", minimumFractionDigits: 0, maximumFractionDigits: 0 })`. Returns "$2,725" for 2725, "$0" for 0.
    - `formatNumber(num: number): string` -- uses `Intl.NumberFormat("en-US")`. Returns "5,420" for 5420, "0" for 0.

    **2. Create `src/components/app/brand-deals/affiliate-link-card.tsx`** -- Presentational component for a single active affiliate link.

    Props interface: `AffiliateLinkCardProps { link: AffiliateLink }`

    Component structure (top to bottom):
    - **Top row:** Avatar (size="xs", src=link.productImage, fallback=first 2 chars of productName uppercased) + product name (truncate, max-w-[180px]) on left, Badge on right with status variant mapping: active="success", paused="warning", expired="error". Status label capitalized.
    - **URL + copy row:** Rounded bg-white/[0.03] container with monospace truncated URL on left + copy button on right. Copy button uses `useCopyToClipboard(2000)` hook internally (each card gets its own instance). Icon morph: `{copied ? <Check size={16} className="text-green-400" weight="bold" /> : <Copy size={16} />}`. Button has `aria-label={copied ? "Link copied" : "Copy affiliate link"}`. CRITICAL: pass `link.url` (full URL from data) to `copy()`, not truncated display text.
    - **Mini KPI stat blocks:** 3-column grid of stat blocks. Each stat block is a small `div` with `rounded-lg bg-white/[0.03] px-3 py-2` containing a bold value on top and uppercase 10px tracking-wider muted label below. Stats: Clicks (formatNumber), Conversions (formatNumber), Earned (formatCurrency).

    Card wrapper: `rounded-xl border border-border bg-surface-elevated p-5` with hover: `hover:border-border-hover hover:-translate-y-px hover:shadow-md transition-all duration-200`.

    Imports: `Copy, Check` from `@phosphor-icons/react`, `Avatar` from `@/components/ui/avatar`, `Badge` from `@/components/ui/badge`, `useCopyToClipboard` from `@/hooks/useCopyToClipboard`, `AffiliateLink` type from `@/types/brand-deals`, `formatCurrency, formatNumber` from `@/lib/affiliate-utils`, `cn` from `@/lib/utils`.

    Add `"use client"` directive (uses hooks).
  </action>
  <verify>
    Run `npx tsc --noEmit` -- both files compile with no errors. Verify AffiliateLinkCard exports correctly and imports resolve.
  </verify>
  <done>
    AffiliateLinkCard renders product info, status badge, truncated URL with copy button (icon morph), and three mini KPI stat blocks using formatCurrency/formatNumber utilities.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AvailableProductCard and AffiliatesEmptyState components</name>
  <files>
    src/components/app/brand-deals/available-product-card.tsx
    src/components/app/brand-deals/affiliates-empty-state.tsx
  </files>
  <action>
    **1. Create `src/components/app/brand-deals/available-product-card.tsx`** -- Presentational component for a product available for affiliate link generation.

    Props interface: `AvailableProductCardProps { product: Product; onGenerateLink: (product: Product) => void }`

    Component structure (top to bottom):
    - **Brand row:** Avatar (size="xs", src=product.brandLogo, fallback=first 2 chars of brandName uppercased) + brandName in text-sm font-medium text-foreground-secondary
    - **Product name:** h3, text-sm font-semibold text-foreground, mb-2
    - **Hero commission rate:** Centered block with large `text-2xl font-bold text-green-400` percentage (e.g., "15%") and below it `text-[10px] uppercase tracking-wider text-foreground-muted` "Commission" label
    - **Generate Link CTA:** Full-width `Button variant="primary" size="sm"` with text "Generate Link", onClick calls `onGenerateLink(product)`

    Card wrapper: Same solid card pattern as AffiliateLinkCard -- `rounded-xl border border-border bg-surface-elevated p-5` with hover states.

    Imports: `Avatar` from `@/components/ui/avatar`, `Button` from `@/components/ui/button`, `Product` type from `@/types/brand-deals`, `cn` from `@/lib/utils`.

    No `"use client"` needed -- no hooks, parent will be client component.

    **2. Create `src/components/app/brand-deals/affiliates-empty-state.tsx`** -- Empty state when no active affiliate links exist.

    Follow the DealsEmptyState pattern from Phase 54.

    Component structure:
    - Centered flex container with min-h-[200px], rounded-xl, border border-border-subtle, padding p-8
    - `LinkSimple` icon from `@phosphor-icons/react` (size=40, weight="thin", aria-hidden="true", text-foreground-muted)
    - Heading: "No active affiliate links" (text-lg font-medium text-foreground)
    - Subtext: "Generate your first link from the products below" (text-sm text-foreground-muted, mt-1)

    No props needed. Export as named function `AffiliatesEmptyState`.
  </action>
  <verify>
    Run `npx tsc --noEmit` -- both files compile with no errors. Verify AvailableProductCard accepts product + callback props. Verify AffiliatesEmptyState renders without props.
  </verify>
  <done>
    AvailableProductCard renders brand info, product name, hero commission rate, and Generate Link CTA. AffiliatesEmptyState renders centered empty state matching design system patterns.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors for all 4 new files
2. AffiliateLinkCard uses `useCopyToClipboard` internally (per-card instance, not shared)
3. Copy button passes `link.url` to `copy()`, not truncated text
4. formatCurrency(2725) returns "$2,725", formatNumber(5420) returns "5,420"
5. formatCurrency(0) returns "$0", formatNumber(0) returns "0" (zero edge case handled)
6. Badge variant maps: active=success, paused=warning, expired=error
7. AvailableProductCard shows commission rate as large green number
8. AffiliatesEmptyState follows same pattern as DealsEmptyState
</verification>

<success_criteria>
All four files created, TypeScript compiles, components are presentational and ready for composition in AffiliatesTab (Plan 02).
</success_criteria>

<output>
After completion, create `.planning/phases/55-affiliates-tab/55-01-SUMMARY.md`
</output>
