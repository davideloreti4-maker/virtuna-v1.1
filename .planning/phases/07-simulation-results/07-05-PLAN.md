---
phase: 07-simulation-results
plan: 05
type: execute
wave: 3
depends_on: ["07-01", "07-02", "07-03", "07-04"]
files_modified:
  - src/stores/test-store.ts
  - src/app/(app)/dashboard/dashboard-client.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking submit shows 4-phase loading in floating area"
    - "After loading completes, results panel appears in floating area"
    - "Results include variants, insights, and conversation themes"
    - "Cancel during loading returns to form"
    - "Run another test returns to idle state"
  artifacts:
    - path: "src/stores/test-store.ts"
      provides: "Full result generation with variants/insights/themes"
      contains: "generateMockVariants"
    - path: "src/app/(app)/dashboard/dashboard-client.tsx"
      provides: "Integrated simulation flow"
      contains: "LoadingPhases"
  key_links:
    - from: "dashboard-client.tsx"
      to: "LoadingPhases"
      via: "import and conditional render"
      pattern: "currentStatus.*simulating.*LoadingPhases"
    - from: "dashboard-client.tsx"
      to: "ResultsPanel"
      via: "import and conditional render"
      pattern: "currentStatus.*viewing-results.*ResultsPanel"
    - from: "test-store.ts"
      to: "mock-data.ts"
      via: "import generators"
      pattern: "import.*generateMock"
---

<objective>
Integrate all components into complete simulation flow

Purpose: Wire up the full simulation experience from form submit to results display
Output: Complete, functional simulation flow matching societies.io
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-simulation-results/07-RESEARCH.md
@.planning/phases/07-simulation-results/07-CONTEXT.md
@.planning/phases/07-simulation-results/07-01-SUMMARY.md
@.planning/phases/07-simulation-results/07-02-SUMMARY.md
@.planning/phases/07-simulation-results/07-03-SUMMARY.md
@.planning/phases/07-simulation-results/07-04-SUMMARY.md
@src/stores/test-store.ts
@src/app/(app)/dashboard/dashboard-client.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update test-store to generate full results with mock data</name>
  <files>src/stores/test-store.ts</files>
  <action>
    Update src/stores/test-store.ts to use mock data generators:

    1. Add imports at top:
    ```typescript
    import {
      generateMockVariants,
      generateMockInsights,
      generateMockThemes,
      getImpactLabel,
    } from '@/lib/mock-data';
    ```

    2. Update submitTest function to generate complete result:

    Replace the result generation section (after phase 4 completes) with:
    ```typescript
    // Generate full mock result
    const impactScore = Math.floor(Math.random() * 36) + 60; // 60-95
    const result: TestResult = {
      id: generateId(),
      testType: currentTestType,
      content,
      impactScore,
      impactLabel: getImpactLabel(impactScore),
      attention: generateAttention(),
      variants: generateMockVariants(content),
      insights: generateMockInsights(),
      conversationThemes: generateMockThemes(),
      createdAt: new Date().toISOString(),
      societyId,
    };
    ```

    3. Ensure the TestResult type import matches the extended interface:
    ```typescript
    import type { TestType, TestResult, TestStatus } from '@/types/test';
    ```

    The phase progression logic from 07-02 should already be in place. This task adds the full result generation.
  </action>
  <verify>npm run build succeeds, no TypeScript errors</verify>
  <done>Test store generates full results with variants, insights, and themes</done>
</task>

<task type="auto">
  <name>Task 2: Integrate LoadingPhases and ResultsPanel in dashboard</name>
  <files>src/app/(app)/dashboard/dashboard-client.tsx</files>
  <action>
    Update src/app/(app)/dashboard/dashboard-client.tsx:

    1. Update imports to include new components:
    ```typescript
    import {
      NetworkVisualization,
      FilterPillGroup,
      ContextBar,
      TestTypeSelector,
      ContentForm,
      SurveyForm,
      LoadingPhases,
      ResultsPanel,
    } from "@/components/app";
    ```

    2. Remove the inline SimulationResultsPanel and AttentionBar components (they're replaced by ResultsPanel from @/components/app).

    3. Update the floating content area to render components based on status:

    ```tsx
    {/* Floating content at bottom */}
    <div className="absolute bottom-6 left-1/2 -translate-x-1/2 w-full max-w-2xl z-20 px-6">
      {currentStatus === 'filling-form' && currentTestType ? (
        currentTestType === 'survey' ? (
          <SurveyForm
            onChangeType={handleChangeType}
            onSubmit={handleSurveySubmit}
          />
        ) : (
          <ContentForm
            testType={currentTestType}
            onChangeType={handleChangeType}
            onSubmit={handleContentSubmit}
          />
        )
      ) : currentStatus === 'simulating' ? (
        <LoadingPhases />
      ) : currentStatus === 'viewing-results' && currentResult ? (
        <ResultsPanel
          result={currentResult}
          onRunAnother={handleRunAnother}
        />
      ) : null}
    </div>
    ```

    4. Make sure handleRunAnother calls reset():
    ```typescript
    const handleRunAnother = () => {
      reset();
    };
    ```

    5. Ensure currentResult type matches new TestResult interface. The destructuring should include:
    ```typescript
    const {
      currentStatus,
      currentTestType,
      currentResult,
      setStatus,
      setTestType,
      submitTest,
      reset,
    } = testStore;
    ```

    6. Remove any unused imports (Loader2 if no longer used inline).
  </action>
  <verify>
    npm run build succeeds
    npm run dev - test the full flow:
    1. Click "Create a new test"
    2. Select TikTok Script
    3. Enter content and submit
    4. See 4-phase loading with progress
    5. See results with Impact Score, Attention, Variants, Insights, Themes
    6. Click "Run another test" returns to idle
  </verify>
  <done>Full simulation flow integrated in dashboard</done>
</task>

</tasks>

<verification>
- Build succeeds: `npm run build`
- Full flow test:
  1. Create new test -> shows TestTypeSelector
  2. Select type -> shows ContentForm or SurveyForm
  3. Submit -> shows LoadingPhases with 4 phases progressing
  4. Complete -> shows ResultsPanel with all sections
  5. Run another -> returns to idle
  6. Cancel during loading -> returns to form
</verification>

<success_criteria>
- Complete simulation flow from submit to results
- Loading phases display with progress bar
- Cancel button during loading returns to form
- Results panel shows all sections (Impact, Attention, Variants, Insights, Themes)
- Share button copies URL
- Run another test resets state
- All components display in floating position at bottom
</success_criteria>

<output>
After completion, create `.planning/phases/07-simulation-results/07-05-SUMMARY.md`
</output>
