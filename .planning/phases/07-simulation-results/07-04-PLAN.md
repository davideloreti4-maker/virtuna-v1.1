---
phase: 07-simulation-results
plan: 04
type: execute
wave: 2
depends_on: ["07-03"]
files_modified:
  - src/components/app/simulation/impact-score.tsx
  - src/components/app/simulation/attention-breakdown.tsx
  - src/components/app/simulation/variants-section.tsx
  - src/components/app/simulation/insights-section.tsx
  - src/components/app/simulation/themes-section.tsx
  - src/components/app/simulation/share-button.tsx
  - src/components/app/simulation/results-panel.tsx
  - src/components/app/index.ts
autonomous: true

must_haves:
  truths:
    - "Impact score displays with rating label (Poor/Average/Good/Excellent)"
    - "Attention breakdown shows horizontal stacked bar"
    - "Variants section shows original + AI-generated alternatives"
    - "Insights section shows AI analysis paragraphs"
    - "Conversation themes show with percentages and quotes"
    - "Share button allows copying results"
  artifacts:
    - path: "src/components/app/simulation/impact-score.tsx"
      provides: "Impact score display with label"
      min_lines: 30
    - path: "src/components/app/simulation/variants-section.tsx"
      provides: "Variants carousel/list"
      contains: "Variant"
    - path: "src/components/app/simulation/results-panel.tsx"
      provides: "Assembled results panel"
      min_lines: 50
  key_links:
    - from: "results-panel.tsx"
      to: "impact-score.tsx"
      via: "import and render"
      pattern: "ImpactScore"
    - from: "results-panel.tsx"
      to: "variants-section.tsx"
      via: "import and render"
      pattern: "VariantsSection"
---

<objective>
Build all results panel components using v0 MCP

Purpose: Create UI components for full results display matching societies.io
Output: Complete set of results components ready for integration
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-simulation-results/07-RESEARCH.md
@.planning/phases/07-simulation-results/07-CONTEXT.md
@src/types/test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Query v0 MCP for all results components</name>
  <files>n/a (research task)</files>
  <action>
    Use ToolSearch to find "v0" MCP tool, then query for EACH component:

    **Query 1 - Impact Score:**
    - "Dark themed impact score display component"
    - "Large score number (e.g., 64/100) with rating label below (Poor/Below Average/Average/Good/Excellent)"
    - "Optional info icon with tooltip explaining the score"
    - "Use Tailwind CSS, zinc-900/950 dark theme"
    - "Color the score based on rating: emerald for Good/Excellent, blue for Average, amber for Below Average/Poor"

    **Query 2 - Attention Breakdown:**
    - "Horizontal stacked progress bar component"
    - "Three segments: Full (emerald), Partial (amber/yellow), Ignore (zinc/gray)"
    - "Labels with percentages for each segment"
    - "Dark theme, rounded bar"

    **Query 3 - Variants Section:**
    - "AI content variants carousel/cards component"
    - "Horizontal row of 3 cards: Original, Variant 1, Variant 2"
    - "Each card shows: score at top, content preview, optional label"
    - "Original card distinct from AI variants"
    - "Dark theme cards with border, hover states"
    - "Optional 'Generate New Variants' button at bottom"

    **Query 4 - Insights Section:**
    - "AI insights display component"
    - "Header with 'Insights' title and info icon"
    - "List of insight paragraphs with bullet points or numbered"
    - "Dark theme, zinc text colors"

    **Query 5 - Conversation Themes:**
    - "Conversation themes cards component"
    - "Header with 'Conversation' title and info icon"
    - "Cards for each theme showing: title, percentage, description"
    - "Expandable quotes section with sample user quotes"
    - "Dark theme, subtle borders"

    **Query 6 - Share Button:**
    - "Share simulation button component"
    - "Icon + text button, positioned top-right style"
    - "Copies link to clipboard or opens share dialog"
    - "Dark theme, subtle hover state"

    Save all v0 outputs for adaptation in Task 2.
  </action>
  <verify>Have v0 MCP output for all 6 component types</verify>
  <done>Reference code ready for all results components</done>
</task>

<task type="auto">
  <name>Task 2: Build ImpactScore and AttentionBreakdown components</name>
  <files>src/components/app/simulation/impact-score.tsx, src/components/app/simulation/attention-breakdown.tsx</files>
  <action>
    **Create src/components/app/simulation/impact-score.tsx:**

    Adapt v0 output:
    ```typescript
    'use client';

    import { cn } from '@/lib/utils';
    import { Info } from 'lucide-react';
    import type { ImpactLabel } from '@/types/test';

    interface ImpactScoreProps {
      score: number;
      label: ImpactLabel;
    }

    const LABEL_COLORS: Record<ImpactLabel, string> = {
      'Excellent': 'text-emerald-400',
      'Good': 'text-emerald-400',
      'Average': 'text-blue-400',
      'Below Average': 'text-amber-400',
      'Poor': 'text-red-400',
    };

    export function ImpactScore({ score, label }: ImpactScoreProps) {
      return (
        <div className="space-y-2">
          <div className="flex items-center gap-2">
            <h3 className="text-sm font-medium text-zinc-400">Impact Score</h3>
            <Info className="h-4 w-4 text-zinc-500" />
          </div>
          <div className="flex items-baseline gap-2">
            <span className={cn("text-4xl font-bold", LABEL_COLORS[label])}>
              {score}
            </span>
            <span className="text-lg text-zinc-500">/100</span>
          </div>
          <p className={cn("text-sm font-medium", LABEL_COLORS[label])}>
            {label}
          </p>
        </div>
      );
    }
    ```

    **Create src/components/app/simulation/attention-breakdown.tsx:**

    ```typescript
    'use client';

    import { cn } from '@/lib/utils';
    import { Info } from 'lucide-react';

    interface AttentionBreakdownProps {
      attention: {
        full: number;
        partial: number;
        ignore: number;
      };
    }

    export function AttentionBreakdown({ attention }: AttentionBreakdownProps) {
      return (
        <div className="space-y-3">
          <div className="flex items-center gap-2">
            <h3 className="text-sm font-medium text-zinc-400">Attention</h3>
            <Info className="h-4 w-4 text-zinc-500" />
          </div>

          {/* Stacked bar */}
          <div className="flex h-3 w-full overflow-hidden rounded-full">
            <div
              className="bg-emerald-500 transition-all"
              style={{ width: `${attention.full}%` }}
            />
            <div
              className="bg-amber-400 transition-all"
              style={{ width: `${attention.partial}%` }}
            />
            <div
              className="bg-zinc-600 transition-all"
              style={{ width: `${attention.ignore}%` }}
            />
          </div>

          {/* Legend */}
          <div className="flex flex-wrap gap-4 text-sm">
            <div className="flex items-center gap-2">
              <div className="h-2 w-2 rounded-full bg-emerald-500" />
              <span className="text-zinc-400">Full</span>
              <span className="font-medium text-white">{attention.full}%</span>
            </div>
            <div className="flex items-center gap-2">
              <div className="h-2 w-2 rounded-full bg-amber-400" />
              <span className="text-zinc-400">Partial</span>
              <span className="font-medium text-white">{attention.partial}%</span>
            </div>
            <div className="flex items-center gap-2">
              <div className="h-2 w-2 rounded-full bg-zinc-600" />
              <span className="text-zinc-400">Ignore</span>
              <span className="font-medium text-white">{attention.ignore}%</span>
            </div>
          </div>
        </div>
      );
    }
    ```
  </action>
  <verify>npm run build succeeds</verify>
  <done>ImpactScore and AttentionBreakdown components created</done>
</task>

<task type="auto">
  <name>Task 3: Build VariantsSection, InsightsSection, ThemesSection, ShareButton, and ResultsPanel</name>
  <files>src/components/app/simulation/variants-section.tsx, src/components/app/simulation/insights-section.tsx, src/components/app/simulation/themes-section.tsx, src/components/app/simulation/share-button.tsx, src/components/app/simulation/results-panel.tsx, src/components/app/index.ts</files>
  <action>
    **Create src/components/app/simulation/variants-section.tsx:**

    ```typescript
    'use client';

    import { cn } from '@/lib/utils';
    import { Info, Sparkles } from 'lucide-react';
    import type { Variant } from '@/types/test';

    interface VariantsSectionProps {
      variants: Variant[];
    }

    export function VariantsSection({ variants }: VariantsSectionProps) {
      return (
        <div className="space-y-3">
          <div className="flex items-center gap-2">
            <h3 className="text-sm font-medium text-zinc-400">Variants</h3>
            <Info className="h-4 w-4 text-zinc-500" />
          </div>

          <div className="flex gap-3 overflow-x-auto pb-2">
            {variants.map((variant) => (
              <div
                key={variant.id}
                className={cn(
                  "flex-shrink-0 w-48 rounded-xl border p-4",
                  variant.type === 'original'
                    ? "border-zinc-700 bg-zinc-800/50"
                    : "border-zinc-700 bg-zinc-900"
                )}
              >
                {/* Score */}
                <div className="mb-2 flex items-center justify-between">
                  <span className="text-2xl font-bold text-white">
                    {variant.impactScore}
                  </span>
                  {variant.type === 'ai-generated' && (
                    <Sparkles className="h-4 w-4 text-purple-400" />
                  )}
                </div>

                {/* Label */}
                <p className="mb-2 text-xs font-medium text-zinc-500">
                  {variant.type === 'original' ? 'Original' : variant.label}
                </p>

                {/* Content preview */}
                <p className="line-clamp-3 text-sm text-zinc-400">
                  {variant.content}
                </p>
              </div>
            ))}
          </div>

          {/* Generate button - UI only for now */}
          <button
            type="button"
            onClick={() => {
              // Future: generate new variants
              console.log('Generate new variants - coming soon');
            }}
            className={cn(
              "flex items-center gap-2 text-sm text-zinc-400",
              "transition-colors hover:text-white"
            )}
          >
            <Sparkles className="h-4 w-4" />
            Generate New Variants
          </button>
        </div>
      );
    }
    ```

    **Create src/components/app/simulation/insights-section.tsx:**

    ```typescript
    'use client';

    import { Info } from 'lucide-react';

    interface InsightsSectionProps {
      insights: string[];
    }

    export function InsightsSection({ insights }: InsightsSectionProps) {
      return (
        <div className="space-y-3">
          <div className="flex items-center gap-2">
            <h3 className="text-sm font-medium text-zinc-400">Insights</h3>
            <Info className="h-4 w-4 text-zinc-500" />
          </div>

          <div className="space-y-2">
            {insights.map((insight, index) => (
              <p key={index} className="text-sm text-zinc-300 leading-relaxed">
                {insight}
              </p>
            ))}
          </div>
        </div>
      );
    }
    ```

    **Create src/components/app/simulation/themes-section.tsx:**

    ```typescript
    'use client';

    import { useState } from 'react';
    import { cn } from '@/lib/utils';
    import { Info, ChevronDown, ChevronUp, MessageSquare } from 'lucide-react';
    import type { ConversationTheme } from '@/types/test';

    interface ThemesSectionProps {
      themes: ConversationTheme[];
    }

    export function ThemesSection({ themes }: ThemesSectionProps) {
      const [expandedTheme, setExpandedTheme] = useState<string | null>(themes[0]?.id ?? null);

      return (
        <div className="space-y-3">
          <div className="flex items-center gap-2">
            <h3 className="text-sm font-medium text-zinc-400">Conversation</h3>
            <Info className="h-4 w-4 text-zinc-500" />
          </div>

          <div className="space-y-2">
            {themes.map((theme) => {
              const isExpanded = expandedTheme === theme.id;

              return (
                <div
                  key={theme.id}
                  className="rounded-xl border border-zinc-700 bg-zinc-800/50 overflow-hidden"
                >
                  {/* Header - clickable */}
                  <button
                    type="button"
                    onClick={() => setExpandedTheme(isExpanded ? null : theme.id)}
                    className="flex w-full items-center justify-between p-4 text-left"
                  >
                    <div className="flex items-center gap-3">
                      <MessageSquare className="h-4 w-4 text-zinc-500" />
                      <span className="font-medium text-white">{theme.title}</span>
                      <span className="text-sm text-zinc-500">~{theme.percentage}%</span>
                    </div>
                    {isExpanded ? (
                      <ChevronUp className="h-4 w-4 text-zinc-500" />
                    ) : (
                      <ChevronDown className="h-4 w-4 text-zinc-500" />
                    )}
                  </button>

                  {/* Expanded content */}
                  {isExpanded && (
                    <div className="border-t border-zinc-700 px-4 pb-4">
                      <p className="py-3 text-sm text-zinc-400">{theme.description}</p>
                      <div className="space-y-2">
                        {theme.quotes.map((quote, i) => (
                          <p
                            key={i}
                            className="text-sm italic text-zinc-500 pl-3 border-l-2 border-zinc-700"
                          >
                            {quote}
                          </p>
                        ))}
                      </div>
                    </div>
                  )}
                </div>
              );
            })}
          </div>
        </div>
      );
    }
    ```

    **Create src/components/app/simulation/share-button.tsx:**

    ```typescript
    'use client';

    import { useState } from 'react';
    import { cn } from '@/lib/utils';
    import { Share2, Check } from 'lucide-react';

    interface ShareButtonProps {
      resultId: string;
    }

    export function ShareButton({ resultId }: ShareButtonProps) {
      const [copied, setCopied] = useState(false);

      const handleShare = async () => {
        // For now, copy a mock URL to clipboard
        const shareUrl = `${window.location.origin}/results/${resultId}`;

        try {
          await navigator.clipboard.writeText(shareUrl);
          setCopied(true);
          setTimeout(() => setCopied(false), 2000);
        } catch {
          console.error('Failed to copy to clipboard');
        }
      };

      return (
        <button
          type="button"
          onClick={handleShare}
          className={cn(
            "flex items-center gap-2 rounded-lg px-3 py-1.5",
            "border border-zinc-700 bg-zinc-800/50",
            "text-sm text-zinc-400",
            "transition-colors hover:bg-zinc-800 hover:text-white"
          )}
        >
          {copied ? (
            <>
              <Check className="h-4 w-4 text-emerald-400" />
              <span className="text-emerald-400">Copied!</span>
            </>
          ) : (
            <>
              <Share2 className="h-4 w-4" />
              <span>Share Simulation</span>
            </>
          )}
        </button>
      );
    }
    ```

    **Create src/components/app/simulation/results-panel.tsx:**

    ```typescript
    'use client';

    import { cn } from '@/lib/utils';
    import type { TestResult } from '@/types/test';
    import { ImpactScore } from './impact-score';
    import { AttentionBreakdown } from './attention-breakdown';
    import { VariantsSection } from './variants-section';
    import { InsightsSection } from './insights-section';
    import { ThemesSection } from './themes-section';
    import { ShareButton } from './share-button';

    interface ResultsPanelProps {
      result: TestResult;
      onRunAnother: () => void;
    }

    export function ResultsPanel({ result, onRunAnother }: ResultsPanelProps) {
      return (
        <div className="rounded-2xl border border-zinc-800 bg-zinc-900 shadow-xl max-h-[70vh] overflow-y-auto">
          {/* Header with share button */}
          <div className="sticky top-0 flex items-center justify-between p-4 border-b border-zinc-800 bg-zinc-900/95 backdrop-blur">
            <h2 className="text-sm font-medium text-zinc-400">Simulation Results</h2>
            <ShareButton resultId={result.id} />
          </div>

          {/* Content */}
          <div className="p-6 space-y-8">
            {/* Impact Score */}
            <ImpactScore score={result.impactScore} label={result.impactLabel} />

            {/* Attention Breakdown */}
            <AttentionBreakdown attention={result.attention} />

            {/* Variants */}
            <VariantsSection variants={result.variants} />

            {/* Insights */}
            <InsightsSection insights={result.insights} />

            {/* Conversation Themes */}
            <ThemesSection themes={result.conversationThemes} />
          </div>

          {/* Footer actions */}
          <div className="sticky bottom-0 p-4 border-t border-zinc-800 bg-zinc-900/95 backdrop-blur">
            <button
              type="button"
              onClick={onRunAnother}
              className={cn(
                "w-full rounded-xl px-6 py-3",
                "bg-white text-zinc-900",
                "text-sm font-medium",
                "transition-colors hover:bg-zinc-200"
              )}
            >
              Run another test
            </button>
          </div>
        </div>
      );
    }
    ```

    **Update src/components/app/index.ts exports:**

    Add these exports:
    ```typescript
    // Simulation components
    export { LoadingPhases } from './simulation/loading-phases';
    export { ImpactScore } from './simulation/impact-score';
    export { AttentionBreakdown } from './simulation/attention-breakdown';
    export { VariantsSection } from './simulation/variants-section';
    export { InsightsSection } from './simulation/insights-section';
    export { ThemesSection } from './simulation/themes-section';
    export { ShareButton } from './simulation/share-button';
    export { ResultsPanel } from './simulation/results-panel';
    ```
  </action>
  <verify>npm run build succeeds, all components export correctly</verify>
  <done>All results panel components created and exported</done>
</task>

</tasks>

<verification>
- Build succeeds: `npm run build`
- All components export from @/components/app
- Components accept correct props matching types from test.ts
</verification>

<success_criteria>
- ImpactScore displays score with colored label
- AttentionBreakdown shows horizontal stacked bar with legend
- VariantsSection shows scrollable variant cards
- InsightsSection displays insight paragraphs
- ThemesSection shows expandable theme cards with quotes
- ShareButton copies URL to clipboard
- ResultsPanel assembles all sections with proper spacing
</success_criteria>

<output>
After completion, create `.planning/phases/07-simulation-results/07-04-SUMMARY.md`
</output>
