---
phase: 01-sidebar-navigation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/components/app/sidebar.tsx
autonomous: false

must_haves:
  truths:
    - "User can type a TikTok @handle into a text input in the sidebar"
    - "User can click Save to persist the handle to Supabase creator_profiles.tiktok_handle"
    - "After saving, the input is replaced with @handle text display (no checkmark icon)"
    - "Sidebar visually harmonizes with the overall platform — Raycast aesthetic throughout"
  artifacts:
    - path: "src/components/app/sidebar.tsx"
      provides: "TikTok handle text input with Save button and Supabase persistence"
      contains: "tiktok_handle"
  key_links:
    - from: "src/components/app/sidebar.tsx"
      to: "Supabase creator_profiles table"
      via: "supabase.from('creator_profiles').upsert()"
      pattern: "creator_profiles.*tiktok_handle"
---

<objective>
Replace the TikTok OAuth-style connect prompt with a simple text input where users type their @handle and click Save. After saving to Supabase, the input collapses to show the saved @handle as plain text. Then verify the complete sidebar visually matches Raycast design language.

Purpose: Completes the TikTok handle input per user decision (simple text input, not OAuth) and provides a visual checkpoint to ensure the sidebar redesign from Plan 01 looks correct.
Output: Fully functional TikTok handle input + visual verification of entire sidebar.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-sidebar-navigation/01-CONTEXT.md
@.planning/phases/01-sidebar-navigation/01-01-SUMMARY.md
@BRAND-BIBLE.md
@src/components/app/sidebar.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build TikTok handle text input with Save button and Supabase persistence</name>
  <files>
    src/components/app/sidebar.tsx
  </files>
  <action>
    Replace the current TikTok account section in sidebar.tsx (both connected and unconnected states) with a new text input approach:

    **State management:**
    1. Add `inputValue` state (string, default empty) for the text input.
    2. Add `isSaving` state (boolean) for save loading state.
    3. Keep existing `tiktokHandle` state for displaying saved handle.
    4. Add `isEditing` state (boolean, default false) — when handle exists, user can click to re-enter edit mode.

    **Unconnected state (no saved handle, or isEditing=true):**
    1. Render a text input field following brand bible input patterns:
       - `bg-white/[0.05]` background
       - `border border-white/[0.05]` border (input border is 0.05, not 0.06)
       - `rounded-lg` (8px radius per brand bible inputs)
       - `h-[42px]` height per brand bible
       - Placeholder text: "@handle"
       - `text-sm` (14px) Inter font
       - `text-foreground` for input text, `text-foreground-muted` for placeholder
       - Focus state: `focus:border-accent focus:outline-none` (coral border on focus)
    2. Render a "Save" button below the input:
       - Use the `<Button>` component with `variant="primary"` and `size="sm"`
       - Full width (`w-full`)
       - Text: "Save" (or "Saving..." when isSaving)
       - Disabled when: input is empty, isSaving, or input matches current saved handle
    3. Both input and button wrapped in a container with `px-3 py-2` padding.

    **Save handler (`handleSaveHandle`):**
    1. Trim the input value, remove leading `@` if user includes it.
    2. Set `isSaving = true`.
    3. Get current user via `supabase.auth.getUser()`.
    4. Upsert to `creator_profiles` table: `{ user_id: user.id, tiktok_handle: trimmedHandle }` with `onConflict: 'user_id'`.
    5. On success: set `tiktokHandle` to the saved value, set `isEditing = false`, clear `inputValue`.
    6. On error: log error, optionally show a subtle error state (red border on input).
    7. Set `isSaving = false`.

    **Connected state (handle saved, isEditing=false):**
    1. Show `@{tiktokHandle}` as plain text (no checkmark icon per user decision).
    2. Style: `text-sm text-foreground` in a container matching the same `px-3 py-2` padding.
    3. Make the text clickable — clicking sets `isEditing = true` and populates `inputValue` with current handle.
    4. On hover, show a subtle cursor pointer and maybe `text-foreground-secondary` transition to indicate editability.

    **Remove old code:**
    1. Remove the `ContextualTooltip` wrapper around the Connect TikTok prompt.
    2. Remove the checkmark SVG icon in the connected state.
    3. Remove the circular avatar placeholder (`h-6 w-6 rounded-full bg-white/[0.1]`).
    4. Remove the `ContextualTooltip` import if no longer used elsewhere in this file.
    5. Remove the `useTooltipStore` import and hydration useEffect if no longer needed.

    **Position:** This section should already be above nav items per Plan 01's restructure. Verify it's in the correct position.
  </action>
  <verify>
    Run `npx tsc --noEmit` — no type errors. Test the flow:
    1. When no handle saved: text input with placeholder "@handle" appears in sidebar above nav
    2. Type a handle, click Save — handle persists to Supabase
    3. After save: input replaced by "@handle" text display
    4. Click the displayed handle — returns to edit mode with input pre-filled
    5. Input follows brand bible styling (bg white/5%, border 0.05, radius 8px, height 42px)
  </verify>
  <done>
    TikTok handle input is a text field (not OAuth) with Save button. Saving writes to Supabase creator_profiles.tiktok_handle. After saving, displays @handle as plain text (no checkmark). Clicking the text re-enters edit mode. Input styling matches brand bible.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Visual verification of complete sidebar redesign</name>
  <files>src/components/app/sidebar.tsx</files>
  <action>
    Human visual verification of the complete sidebar overhaul across Plan 01 and Plan 02:
    - Solid dark background (#07080a), flush to left edge, full height
    - Right-side border only (6% white)
    - No glassmorphic effect, no rounded corners, no floating inset
    - Coral left-border indicator for active nav items (not filled bg)
    - Navigation: Dashboard, Trending, Referrals (top) + Pricing (bottom)
    - "Content Intelligence" removed
    - TikTok handle text input above nav items with Save + Supabase persistence
    - Collapse slides fully off-screen, no icon rail
    - Account section at bottom with sign-out dropdown

    Steps to verify:
    1. Open the app at http://localhost:3000/dashboard
    2. Verify sidebar is solid dark, flush to left edge, no glass blur, no rounded corners
    3. Verify active nav item (Dashboard) has a coral left-border indicator, NOT a filled background
    4. Verify nav items are: Dashboard, Trending, Referrals (top group), Pricing (bottom group)
    5. Verify "Content Intelligence" does NOT appear anywhere in sidebar
    6. Verify TikTok handle section is above nav items — either a text input or saved @handle
    7. Type a TikTok handle and click Save — verify it saves and displays
    8. Click the displayed handle — verify it returns to edit mode
    9. Collapse the sidebar — verify it slides completely off-screen (no icon rail)
    10. Expand sidebar — verify main content adjusts correctly
    11. Click each nav item — verify correct navigation (Dashboard, Trending, Referrals, Pricing)
    12. Compare sidebar aesthetics with Raycast.com left sidebar — should feel like the same design language

    Resume signal: Type "approved" if sidebar looks correct, or describe specific issues to fix.
  </action>
  <verify>Human confirms all 12 verification steps pass</verify>
  <done>Sidebar redesign approved by human — visually matches Raycast design language, all navigation works correctly, TikTok handle input functional</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` — zero type errors
2. `npx next build` — successful build
3. TikTok handle input: type handle -> Save -> shows @handle text -> click to re-edit
4. Supabase persistence: handle saved to creator_profiles.tiktok_handle, survives page refresh
5. Visual: sidebar matches Raycast design language (solid dark, flush, coral indicators)
6. No console errors when navigating between pages
7. Mobile overlay still functional
</verification>

<success_criteria>
- TikTok handle text input works end-to-end (type, save, display, re-edit)
- Handle persists in Supabase and survives page refresh
- Complete sidebar visually matches Raycast design language
- Human verification approved
</success_criteria>

<output>
After completion, create `.planning/phases/01-sidebar-navigation/01-02-SUMMARY.md`
</output>
