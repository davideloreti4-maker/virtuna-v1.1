---
phase: 08-test-history-polish
plan: 03
type: execute
wave: 2
depends_on: ["08-02"]
files_modified:
  - src/components/app/view-selector.tsx
  - src/components/app/legend-pills.tsx
  - src/components/app/index.ts
  - src/app/(app)/dashboard/dashboard-client.tsx
autonomous: true

must_haves:
  truths:
    - "View selector shows role level options with color dots"
    - "Legend pills display below filter pills"
    - "Role level colors match established palette (Indigo, Pink, Emerald, Orange)"
    - "Selecting a view updates both dropdown and legend"
  artifacts:
    - path: "src/components/app/view-selector.tsx"
      provides: "Enhanced view selector with role colors"
      exports: ["ViewSelector"]
    - path: "src/components/app/legend-pills.tsx"
      provides: "Color-coded legend for network visualization"
      exports: ["LegendPills"]
  key_links:
    - from: "legend-pills.tsx"
      to: "dashboard-client.tsx"
      via: "Integration in top bar"
      pattern: "LegendPills"
    - from: "view-selector.tsx"
      to: "ROLE_LEVELS constant"
      via: "Color indicators in menu items"
      pattern: "ROLE_LEVELS"
---

<objective>
Enhance ViewSelector with role level colors and create LegendPills component.

Purpose: Match societies.io reference for view selection and provide visual legend for network visualization.
Output: Enhanced ViewSelector with color dots and LegendPills component in dashboard.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-test-history-polish/08-CONTEXT.md

# Role level colors from accumulated decisions (Phase 4)
# Indigo (Executive), Pink (Mid), Emerald (Senior), Orange (Entry)

# Existing patterns
@src/components/app/view-selector.tsx
@src/components/app/filter-pills.tsx
@src/app/(app)/dashboard/dashboard-client.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Enhance ViewSelector with role level colors</name>
  <files>src/components/app/view-selector.tsx</files>
  <action>
Update ViewSelector to show color indicators for role level view option:

1. Add ROLE_LEVELS constant matching accumulated decisions:
```typescript
const ROLE_LEVELS = [
  { id: 'executive', label: 'Executive', color: 'bg-indigo-500' },
  { id: 'senior', label: 'Senior', color: 'bg-emerald-500' },
  { id: 'mid', label: 'Mid', color: 'bg-pink-500' },
  { id: 'entry', label: 'Entry', color: 'bg-orange-500' },
] as const;
```

2. Export ROLE_LEVELS for use in LegendPills:
```typescript
export { ROLE_LEVELS };
```

3. Update the dropdown to show color dot next to each view option:

For regular views, just show the label.
For "Role Level" view, can show a multi-dot indicator or keep simple.

Keep the view selector mostly as-is, but ensure selected state is clear.

The key enhancement is exporting ROLE_LEVELS and ensuring ViewSelector can communicate selected view to parent.

Update the interface to allow controlled mode:
```typescript
interface ViewSelectorProps {
  className?: string;
  value?: ViewOption;
  onSelect?: (view: ViewOption) => void;
}

export function ViewSelector({ className, value, onSelect }: ViewSelectorProps) {
  const [internalValue, setInternalValue] = useState<ViewOption>(VIEW_OPTIONS[0]);
  const selectedView = value ?? internalValue;

  const handleSelect = (view: ViewOption) => {
    if (!value) {
      setInternalValue(view);
    }
    onSelect?.(view);
  };
  // ... rest
}
```

Add color dot to the "Role Level" option in dropdown:
```tsx
{VIEW_OPTIONS.map((view) => (
  <DropdownMenu.Item
    key={view.id}
    onSelect={() => handleSelect(view)}
    className={cn(
      'flex cursor-pointer items-center gap-2 px-4 py-2.5 text-sm text-zinc-200 outline-none transition-colors hover:bg-zinc-800 focus:bg-zinc-800',
      selectedView.id === view.id && 'text-white'
    )}
  >
    {/* Color dots for Role Level option */}
    {view.id === 'role-level' && (
      <div className="flex gap-1">
        {ROLE_LEVELS.map((level) => (
          <span key={level.id} className={cn('h-2 w-2 rounded-full', level.color)} />
        ))}
      </div>
    )}
    <span className="flex-1">{view.label}</span>
    {selectedView.id === view.id && (
      <Check className="h-4 w-4 text-indigo-500" />
    )}
  </DropdownMenu.Item>
))}
```
  </action>
  <verify>
    - ViewSelector shows color dots for Role Level option
    - ROLE_LEVELS is exported from module
    - TypeScript compiles
  </verify>
  <done>ViewSelector enhanced with role level color indicators and controllable value prop</done>
</task>

<task type="auto">
  <name>Task 2: Create LegendPills component</name>
  <files>src/components/app/legend-pills.tsx, src/components/app/index.ts</files>
  <action>
Create LegendPills component for displaying role level legend:

```typescript
// src/components/app/legend-pills.tsx
'use client';

import { cn } from '@/lib/utils';

const ROLE_LEVELS = [
  { id: 'executive', label: 'Executive', color: 'bg-indigo-500' },
  { id: 'senior', label: 'Senior', color: 'bg-emerald-500' },
  { id: 'mid', label: 'Mid', color: 'bg-pink-500' },
  { id: 'entry', label: 'Entry', color: 'bg-orange-500' },
] as const;

export type RoleLevel = (typeof ROLE_LEVELS)[number]['id'];

interface LegendPillsProps {
  className?: string;
  /** Optional: which levels are currently visible/active */
  activelevels?: RoleLevel[];
  /** Optional: toggle a level on/off */
  onToggle?: (levelId: RoleLevel) => void;
}

/**
 * LegendPills - Displays role level color legend for network visualization.
 * Can optionally support click-to-toggle filtering.
 */
export function LegendPills({
  className,
  activelevels,
  onToggle,
}: LegendPillsProps) {
  // If no activeLevels provided, all are active (display-only mode)
  const isActive = (id: RoleLevel) =>
    activelevels ? activelevels.includes(id) : true;

  return (
    <div className={cn('flex items-center gap-2', className)}>
      {ROLE_LEVELS.map((level) => (
        <button
          key={level.id}
          type="button"
          onClick={() => onToggle?.(level.id)}
          disabled={!onToggle}
          className={cn(
            'flex items-center gap-1.5 rounded-full px-3 py-1.5 text-xs font-medium transition-colors',
            isActive(level.id)
              ? 'bg-zinc-800/80 text-zinc-200'
              : 'bg-zinc-900/50 text-zinc-500',
            onToggle && 'cursor-pointer hover:bg-zinc-700',
            !onToggle && 'cursor-default'
          )}
        >
          <span
            className={cn(
              'h-2 w-2 rounded-full',
              level.color,
              !isActive(level.id) && 'opacity-40'
            )}
          />
          {level.label}
        </button>
      ))}
    </div>
  );
}

export { ROLE_LEVELS };
```

Add export to index.ts:
```typescript
export { LegendPills, ROLE_LEVELS } from './legend-pills';
export type { RoleLevel } from './legend-pills';
```
  </action>
  <verify>
    - LegendPills renders all 4 role levels with correct colors
    - Component is display-only by default (no toggle)
    - TypeScript compiles
  </verify>
  <done>LegendPills component created with optional toggle support</done>
</task>

<task type="auto">
  <name>Task 3: Integrate LegendPills into dashboard</name>
  <files>src/app/(app)/dashboard/dashboard-client.tsx</files>
  <action>
Add LegendPills to dashboard top bar, positioned after FilterPillGroup:

1. Import LegendPills:
```typescript
import {
  NetworkVisualization,
  FilterPillGroup,
  ContextBar,
  TestTypeSelector,
  ContentForm,
  SurveyForm,
  LoadingPhases,
  ResultsPanel,
  LegendPills,
} from "@/components/app";
```

2. Add to top bar layout:
```tsx
{/* Top bar with context, filters, and create button - above network */}
<div className="relative z-10 flex items-center justify-between px-6 py-4">
  <ContextBar location="Switzerland" />
  <div className="flex items-center gap-3">
    {/* Legend pills for role level view */}
    <LegendPills className="hidden md:flex" />
    <FilterPillGroup />
    <button
      type="button"
      onClick={handleOpenSelector}
      className={cn(
        "flex items-center gap-2 rounded-xl px-4 py-2",
        "bg-white text-zinc-900",
        "text-sm font-medium",
        "transition-colors hover:bg-zinc-200"
      )}
    >
      <Plus className="h-4 w-4" />
      <span className="hidden sm:inline">Create a new test</span>
      <span className="sm:hidden">New</span>
    </button>
  </div>
</div>
```

Position LegendPills before FilterPillGroup. Hide on mobile (hidden md:flex) for cleaner mobile view.
  </action>
  <verify>
    - LegendPills visible in dashboard top bar on desktop
    - Hidden on mobile screens
    - All 4 role level colors displayed
    - `npm run build` passes
  </verify>
  <done>LegendPills integrated into dashboard layout matching societies.io placement</done>
</task>

</tasks>

<verification>
- [ ] ViewSelector shows color dots for Role Level option
- [ ] ROLE_LEVELS constant exported and reusable
- [ ] LegendPills shows all 4 role levels (Executive, Senior, Mid, Entry)
- [ ] Colors match: Indigo, Emerald, Pink, Orange
- [ ] LegendPills positioned in dashboard top bar
- [ ] Hidden on mobile for cleaner layout
- [ ] `npm run build` passes without errors
</verification>

<success_criteria>
- View selector enhanced with visual role level indicators
- Legend pills display in dashboard matching societies.io
- Role level colors consistent across components
- Display-only mode works (no toggle needed for MVP)
</success_criteria>

<output>
After completion, create `.planning/phases/08-test-history-polish/08-03-SUMMARY.md`
</output>
