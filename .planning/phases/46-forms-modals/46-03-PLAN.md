---
phase: 46-forms-modals
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/create-society-modal.tsx
  - src/components/app/delete-test-modal.tsx
  - src/components/app/leave-feedback-modal.tsx
autonomous: true

must_haves:
  truths:
    - "CreateSocietyModal uses design system Dialog + GlassTextarea + Button"
    - "CreateSocietyModal shows dirty-form confirmation before closing with unsaved changes"
    - "DeleteTestModal uses AlertDialog with design system visual styling and Button destructive"
    - "DeleteTestModal does NOT close on overlay click (AlertDialog behavior preserved)"
    - "LeaveFeedbackModal uses design system Dialog + GlassInput + GlassTextarea + Button"
    - "LeaveFeedbackModal shows dirty-form confirmation before closing with unsaved changes"
    - "All three modals use consistent overlay, animation, and close behavior"
    - "All hardcoded zinc/orange/red/indigo colors replaced with design tokens"
  artifacts:
    - path: "src/components/app/create-society-modal.tsx"
      provides: "Create society modal using Dialog + GlassTextarea + Button + dirty form confirmation"
      contains: "DialogContent"
    - path: "src/components/app/delete-test-modal.tsx"
      provides: "Delete test confirmation using AlertDialog + design system styling + Button destructive"
      contains: "Button.*destructive"
    - path: "src/components/app/leave-feedback-modal.tsx"
      provides: "Leave feedback modal using Dialog + GlassInput + GlassTextarea + Button"
      contains: "GlassInput"
  key_links:
    - from: "src/components/app/create-society-modal.tsx"
      to: "@/components/ui/dialog"
      via: "import replacing raw Radix Dialog"
      pattern: "import.*Dialog.*from.*ui/dialog"
    - from: "src/components/app/create-society-modal.tsx"
      to: "@/components/primitives/GlassTextarea"
      via: "import"
      pattern: "GlassTextarea"
    - from: "src/components/app/leave-feedback-modal.tsx"
      to: "@/components/primitives/GlassInput"
      via: "import"
      pattern: "GlassInput"
    - from: "src/components/app/delete-test-modal.tsx"
      to: "@/components/ui/button"
      via: "import for destructive Button"
      pattern: "Button.*destructive"
---

<objective>
Migrate CreateSocietyModal, DeleteTestModal, and LeaveFeedbackModal to design system components with dirty-form confirmation.

Purpose: Replace raw Radix Dialog/AlertDialog imports and hardcoded styles with design system Dialog, GlassTextarea, GlassInput, and Button components. Add dirty-form confirmation for modals with editable forms. This covers MODL-01, MODL-02, MODL-03, and partially MODL-05 (consistent behavior).
Output: Three migrated modal components with consistent glass styling, z-index tokens, animations, and design system inputs/buttons.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/46-forms-modals/46-CONTEXT.md
@.planning/phases/46-forms-modals/46-RESEARCH.md

@src/components/app/create-society-modal.tsx
@src/components/app/delete-test-modal.tsx
@src/components/app/leave-feedback-modal.tsx
@src/components/ui/dialog.tsx
@src/components/ui/button.tsx
@src/components/primitives/GlassTextarea.tsx
@src/components/primitives/GlassInput.tsx
@src/stores/society-store.ts
@src/stores/settings-store.ts
@BRAND-BIBLE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate CreateSocietyModal and LeaveFeedbackModal to design system</name>
  <files>src/components/app/create-society-modal.tsx, src/components/app/leave-feedback-modal.tsx</files>
  <action>
Migrate both form-bearing modals to design system components. Use v0 MCP as the primary UI generation tool.

**CreateSocietyModal migration:**

1. Remove `import * as Dialog from "@radix-ui/react-dialog"`.
2. Import `{ Dialog, DialogContent, DialogHeader, DialogTitle, DialogDescription }` from `@/components/ui/dialog`.
3. Import `{ Button }` from `@/components/ui/button`.
4. Import `{ GlassTextarea }` from `@/components/primitives/GlassTextarea`.

5. Replace Dialog structure:
   - `<Dialog.Root>` -> `<Dialog>`
   - `<Dialog.Portal>` + `<Dialog.Overlay>` + `<Dialog.Content>` -> `<DialogContent size="lg">` (DialogContent renders portal + overlay automatically)
   - `<Dialog.Title>` -> `<DialogTitle>` inside `<DialogHeader>`
   - `<Dialog.Description>` -> `<DialogDescription>` inside `<DialogHeader>`

6. Replace textarea:
   - Raw `<textarea>` -> `<GlassTextarea value={description} onChange={...} placeholder="..." autoResize minRows={3} />`

7. Replace buttons:
   - Raw submit button -> `<Button variant="primary" loading={isSubmitting} disabled={!description.trim() || isSubmitting} className="w-full">`. When loading, show text "Matching AI personas..." (Button's loading prop adds spinner automatically, keep the text too).
   - Replace back button (ArrowLeft) with `<Button variant="ghost" size="sm">` with ArrowLeft icon.

8. Add Zod v4 validation:
   ```typescript
   const createSocietySchema = z.object({
     description: z.string()
       .min(1, { error: "Required" })
       .min(10, { error: "At least 10 characters" }),
   });
   ```
   - Validate on blur and on submit. Show inline error below GlassTextarea.

9. Add dirty-form confirmation:
   - Add `isDirty` state, set to `true` on any textarea change.
   - Add `showDiscardConfirm` state.
   - Intercept `onOpenChange`: if closing and `isDirty`, set `showDiscardConfirm(true)` instead.
   - Render a lightweight confirmation: a small Dialog (or inline div within the modal) asking "Discard changes?" with Cancel and Discard buttons.
   - On discard: reset form state, close modal.
   - On cancel: dismiss confirmation, stay in modal.
   - Reset `isDirty` after successful submission.

10. Token migration:
   - Remove inline `style={{ background: ... }}` gradient -- let DialogContent's glass bg handle it.
   - Replace `text-white` -> `text-foreground`.
   - Replace `text-zinc-400` -> `text-foreground-secondary`.
   - Replace `border-zinc-800` -> `border-border`.
   - Replace `bg-[#18181B]` -> removed (DialogContent handles bg).
   - Replace `bg-orange-500` -> Button primary handles it.
   - Remove `z-50` classes (Dialog uses z-index tokens).

**LeaveFeedbackModal migration:**

1. Same Dialog import swap as above.
2. Import `GlassInput` from `@/components/primitives/GlassInput`.
3. Import `GlassTextarea` from `@/components/primitives/GlassTextarea`.

4. Replace Dialog structure (same pattern as CreateSocietyModal).

5. Replace inputs:
   - Name `<input>` -> `<GlassInput value={displayName} onChange={...} placeholder="Your name" size="md" />`
   - Email `<input>` -> `<GlassInput type="email" value={displayEmail} onChange={...} placeholder="your@email.com" size="md" />`
   - Feedback `<textarea>` -> `<GlassTextarea value={feedback} onChange={...} placeholder="Tell us what you think..." autoResize minRows={4} />`

6. Replace buttons:
   - Submit button -> `<Button variant="primary" loading={isSubmitting} disabled={isSubmitting || !feedback.trim()}>Submit</Button>`. Keep the ArrowRight icon next to text when not loading.
   - Close button (X) -> use `DialogClose` + `<Button variant="ghost" size="sm">` with X icon.

7. Add Zod v4 validation:
   ```typescript
   const feedbackFormSchema = z.object({
     name: z.string().optional(),
     email: z.string().email({ error: "Enter a valid email" }).optional().or(z.literal("")),
     feedback: z.string().min(1, { error: "Required" }),
   });
   ```
   - Validate email on blur (only if non-empty). Validate feedback on blur and submit.

8. Add dirty-form confirmation (same pattern as CreateSocietyModal).

9. Token migration:
   - Replace `border-zinc-800` -> `border-border`.
   - Replace `bg-[#18181B]` -> removed.
   - Replace `border-zinc-700 bg-zinc-800` -> handled by GlassInput/GlassTextarea.
   - Replace `text-zinc-400` -> `text-foreground-secondary`.
   - Replace `text-zinc-500` -> `text-foreground-muted`.
   - Replace `bg-orange-500` -> Button primary.
   - Replace `bg-emerald-500/10` + `text-emerald-400` -> `bg-success/10` + `text-success` (if success tokens exist, otherwise keep green as intentional).
   - Remove `z-50` classes.

10. Preserve:
   - The `_isHydrated` check and `displayName`/`displayEmail` pattern from settings store.
   - The success state (`submitted`) with checkmark animation.
   - The email link in footer.
   - All business logic in `handleSubmit`.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors. Grep for `"@radix-ui/react-dialog"` in both files to confirm raw Radix removed. Grep for `DialogContent`, `GlassTextarea`, `GlassInput`, `Button` to confirm design system usage. Grep for hardcoded colors (`bg-zinc`, `border-zinc`, `text-zinc`, `bg-orange`, `bg-\[`) to confirm zero hardcoded values.
  </verify>
  <done>
CreateSocietyModal uses Dialog + GlassTextarea + Button (primary with loading) + Zod validation + dirty-form confirmation. LeaveFeedbackModal uses Dialog + GlassInput + GlassTextarea + Button + Zod validation + dirty-form confirmation. Both modals use consistent overlay, animation, and close behavior from design system Dialog. All hardcoded colors replaced. No TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate DeleteTestModal to design system styling with Button destructive</name>
  <files>src/components/app/delete-test-modal.tsx</files>
  <action>
Migrate `DeleteTestModal` to use design system visual styling while preserving AlertDialog behavior. Use v0 MCP as the primary UI generation tool.

**Critical: Keep AlertDialog for destructive action safety.** AlertDialog prevents closing on overlay click, which is correct for destructive confirmations. Do NOT replace with regular Dialog.

**Two approaches (choose the simpler one):**

**Approach A (preferred): Keep AlertDialog primitives, apply design system visual classes:**
- Keep `import * as AlertDialog from '@radix-ui/react-alert-dialog'`.
- Import `{ Button }` from `@/components/ui/button`.
- Apply design system classes to AlertDialog.Overlay:
  ```tsx
  <AlertDialog.Overlay className="fixed inset-0 z-[var(--z-modal-backdrop)] bg-black/60 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"
    style={{ backdropFilter: "blur(4px)", WebkitBackdropFilter: "blur(4px)" }}
  />
  ```
- Apply design system classes to AlertDialog.Content:
  ```tsx
  <AlertDialog.Content className="fixed left-[50%] top-[50%] z-[var(--z-modal)] w-full max-w-md translate-x-[-50%] translate-y-[-50%] rounded-xl border border-border-glass bg-surface-elevated shadow-xl duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95"
    style={{ backdropFilter: "blur(20px)", WebkitBackdropFilter: "blur(20px)" }}
  >
  ```

- Replace AlertDialog.Title styling: `className="text-lg font-semibold text-foreground"`.
- Replace AlertDialog.Description styling: `className="mt-2 text-sm text-foreground-secondary"`.

- Replace Cancel button:
  ```tsx
  <AlertDialog.Cancel asChild>
    <Button variant="secondary">Cancel</Button>
  </AlertDialog.Cancel>
  ```

- Replace Delete button:
  ```tsx
  <AlertDialog.Action asChild>
    <Button variant="destructive" onClick={onConfirm}>Delete</Button>
  </AlertDialog.Action>
  ```

**Token migration:**
- Replace `border-zinc-800` -> `border-border-glass`.
- Replace `bg-zinc-900` -> `bg-surface-elevated`.
- Replace `text-white` -> `text-foreground`.
- Replace `text-zinc-400` -> `text-foreground-secondary`.
- Replace `border-zinc-700 bg-transparent` -> handled by Button secondary.
- Replace `text-zinc-300` -> handled by Button.
- Replace `bg-red-600` -> handled by Button destructive.
- Replace `focus-visible:ring-2 focus-visible:ring-zinc-500` / `focus-visible:ring-red-500` -> handled by Button.
- Add inline backdrop-filter styles to Overlay and Content.
- Replace hardcoded `z-50` with `z-[var(--z-modal)]` and `z-[var(--z-modal-backdrop)]`.
- Remove slide animation classes (keep only fade + zoom for consistency with design system Dialog pattern).

**Preserve:**
- `AlertDialog.Root`, `AlertDialog.Portal`, `AlertDialog.Overlay`, `AlertDialog.Content` (Radix AlertDialog structure).
- `AlertDialog.Cancel`, `AlertDialog.Action` (proper destructive action semantics).
- `onConfirm` callback on Delete button.
- Props interface (`open`, `onOpenChange`, `onConfirm`).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors. Grep for `AlertDialog` to confirm AlertDialog is preserved (not replaced with Dialog). Grep for `Button.*destructive` to confirm design system Button is used. Grep for `border-zinc\|bg-zinc\|text-zinc\|bg-red\|ring-zinc\|ring-red` to confirm zero hardcoded colors. Grep for `z-\[var(--z-modal` to confirm z-index tokens.
  </verify>
  <done>
DeleteTestModal keeps AlertDialog primitives for overlay-click prevention. Uses design system visual styling (border-border-glass, bg-surface-elevated, z-index tokens, glass backdrop-filter). Cancel uses Button secondary, Delete uses Button destructive. All hardcoded colors replaced. No TypeScript errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `grep -c "@radix-ui/react-dialog" src/components/app/create-society-modal.tsx src/components/app/leave-feedback-modal.tsx` returns 0 for both
3. `grep -c "DialogContent" src/components/app/create-society-modal.tsx src/components/app/leave-feedback-modal.tsx` returns >= 1 each
4. `grep -c "AlertDialog" src/components/app/delete-test-modal.tsx` returns >= 1 (preserved)
5. `grep -c "Button" src/components/app/create-society-modal.tsx src/components/app/delete-test-modal.tsx src/components/app/leave-feedback-modal.tsx` returns >= 1 each
6. `grep -c "GlassTextarea" src/components/app/create-society-modal.tsx` returns >= 1
7. `grep -c "GlassInput" src/components/app/leave-feedback-modal.tsx` returns >= 1
8. `grep -c "isDirty\|showDiscardConfirm" src/components/app/create-society-modal.tsx src/components/app/leave-feedback-modal.tsx` returns >= 1 each
9. `grep -c "bg-zinc\|border-zinc\|text-zinc\|bg-orange\|bg-red\|bg-\[#" src/components/app/create-society-modal.tsx src/components/app/delete-test-modal.tsx src/components/app/leave-feedback-modal.tsx` returns 0 for all
10. `npm run build` completes without errors
</verification>

<success_criteria>
- CreateSocietyModal uses Dialog, GlassTextarea, Button (primary with loading), Zod validation, dirty-form confirmation
- DeleteTestModal uses AlertDialog (preserved) with design system styling, Button destructive, z-index tokens, glass backdrop-filter
- LeaveFeedbackModal uses Dialog, GlassInput, GlassTextarea, Button (primary with loading), Zod validation, dirty-form confirmation
- DeleteTestModal does NOT close on overlay click (AlertDialog behavior intact)
- All three modals have consistent overlay, animation, and close behavior
- Zero hardcoded color values in all three files
- Props interfaces unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/46-forms-modals/46-03-SUMMARY.md`
</output>
