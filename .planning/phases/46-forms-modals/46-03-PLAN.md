---
phase: 46-forms-modals
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/create-society-modal.tsx
  - src/components/app/delete-test-modal.tsx
  - src/components/app/leave-feedback-modal.tsx
autonomous: true

must_haves:
  truths:
    - "CreateSocietyModal uses design system Dialog + GlassTextarea + Button"
    - "CreateSocietyModal shows dirty-form confirmation before closing with unsaved changes"
    - "DeleteTestModal uses AlertDialog with design system visual styling and Button destructive"
    - "DeleteTestModal does NOT close on overlay click (AlertDialog behavior preserved)"
    - "LeaveFeedbackModal uses design system Dialog + GlassInput + GlassTextarea + Button"
    - "LeaveFeedbackModal shows dirty-form confirmation before closing with unsaved changes"
    - "All three modals use consistent overlay, animation, and close behavior"
    - "All hardcoded zinc/orange/red/indigo colors replaced with design tokens"
  artifacts:
    - path: "src/components/app/create-society-modal.tsx"
      provides: "Create society modal using Dialog + GlassTextarea + Button + dirty form confirmation"
      contains: "DialogContent"
    - path: "src/components/app/delete-test-modal.tsx"
      provides: "Delete test confirmation using AlertDialog + design system styling + Button destructive"
      contains: "Button.*destructive"
    - path: "src/components/app/leave-feedback-modal.tsx"
      provides: "Leave feedback modal using Dialog + GlassInput + GlassTextarea + Button"
      contains: "GlassInput"
  key_links:
    - from: "src/components/app/create-society-modal.tsx"
      to: "@/components/ui/dialog"
      via: "import replacing raw Radix Dialog"
      pattern: "import.*Dialog.*from.*ui/dialog"
    - from: "src/components/app/create-society-modal.tsx"
      to: "@/components/primitives/GlassTextarea"
      via: "import"
      pattern: "GlassTextarea"
    - from: "src/components/app/leave-feedback-modal.tsx"
      to: "@/components/primitives/GlassInput"
      via: "import"
      pattern: "GlassInput"
    - from: "src/components/app/delete-test-modal.tsx"
      to: "@/components/ui/button"
      via: "import for destructive Button"
      pattern: "Button.*destructive"
---

<objective>
Migrate CreateSocietyModal, DeleteTestModal, and LeaveFeedbackModal to design system components with dirty-form confirmation.

Purpose: Replace raw Radix Dialog/AlertDialog imports and hardcoded styles with design system Dialog, GlassTextarea, GlassInput, and Button components. Add dirty-form confirmation for modals with editable forms. This covers MODL-01, MODL-02, MODL-03, and partially MODL-05 (consistent behavior).
Output: Three migrated modal components with consistent glass styling, z-index tokens, animations, and design system inputs/buttons.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/46-forms-modals/46-CONTEXT.md
@.planning/phases/46-forms-modals/46-RESEARCH.md

@src/components/app/create-society-modal.tsx
@src/components/app/delete-test-modal.tsx
@src/components/app/leave-feedback-modal.tsx
@src/components/ui/dialog.tsx
@src/components/ui/button.tsx
@src/components/primitives/GlassTextarea.tsx
@src/components/primitives/GlassInput.tsx
@src/stores/society-store.ts
@src/stores/settings-store.ts
@.planning/BRAND-BIBLE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate CreateSocietyModal to design system</name>
  <files>src/components/app/create-society-modal.tsx</files>
  <action>
**Step 1: Read current component**
Read `src/components/app/create-society-modal.tsx` to understand:
- Props interface, Radix Dialog import pattern
- State: `description`, `isSubmitting`, submit flow
- Business logic in `handleSubmit` (society creation via store)
- Overlay/Content/Title JSX structure and inline styles
- Back button (ArrowLeft) for multi-step flow

**Step 2: Read design system components**
Read these files to understand their APIs:
- `src/components/ui/dialog.tsx` — `Dialog`, `DialogContent` (size), `DialogHeader`, `DialogTitle`, `DialogDescription`, `DialogClose`, `DialogFooter`
- `src/components/primitives/GlassTextarea.tsx` — `size`, `error` (boolean), `autoResize`, `minRows`, `maxRows`
- `src/components/ui/button.tsx` — `variant`, `size`, `loading`, `asChild`

**Step 3: Generate via v0**
First call ToolSearch with query "select:mcp__v0__v0_generate_ui" to load the tool. Then call `mcp__v0__v0_generate_ui` with a prompt including:

- The full current create-society-modal.tsx code
- Design system APIs: Dialog (DialogContent size="lg"), GlassTextarea (autoResize, minRows, error), Button (variant="primary", loading)
- Brand bible context: dark theme tokens, glass surfaces, coral accent
- Requirements:
  - Replace raw Radix Dialog with design system: `Dialog.Root` -> `Dialog`, `Dialog.Portal` + `Dialog.Overlay` + `Dialog.Content` -> `DialogContent size="lg"`, `Dialog.Title` -> `DialogTitle` in `DialogHeader`
  - Replace raw `<textarea>` with `<GlassTextarea autoResize minRows={3} />`
  - Replace submit button with `<Button variant="primary" loading={isSubmitting} disabled={!description.trim() || isSubmitting} className="w-full">`
  - Replace back button with `<Button variant="ghost" size="sm">` + ArrowLeft icon
  - Add Zod v4 validation: `z.object({ description: z.string().min(1, { error: "Required" }).min(10, { error: "At least 10 characters" }) })` — validate on blur and submit, inline error below textarea
  - Add dirty-form confirmation: `isDirty` state (set true on any change), `showDiscardConfirm` state. Intercept `onOpenChange`: if closing while dirty, show "Discard changes?" confirmation instead. Confirmation has Cancel and Discard buttons. On discard: reset form, close. On cancel: dismiss, stay.
  - Replace ALL hardcoded colors: remove inline `style={{ background: ... }}` gradient, `text-white` -> `text-foreground`, `text-zinc-400` -> `text-foreground-secondary`, `border-zinc-800` -> `border-border`, `bg-[#18181B]` -> removed (DialogContent handles bg), `bg-orange-500` -> Button primary, remove `z-50` classes
- What to preserve: all `handleSubmit` business logic, society store connections, the multi-step flow back button

**Step 4: Integrate v0 output**
Write v0's generated code to `src/components/app/create-society-modal.tsx`, then manually adjust:
- Fix import paths: Dialog from `@/components/ui/dialog`, GlassTextarea from `@/components/primitives/GlassTextarea`, Button from `@/components/ui/button`, `z` from `zod`
- Re-wire society store connection (`useSocietyStore`), ensure `handleSubmit` business logic is intact, verify back button works in multi-step flow
- Ensure `isDirty` + `showDiscardConfirm` pattern intercepts `onOpenChange` correctly (Dialog must NOT close when dirty, confirmation must appear instead)

**Step 5: Verify**
Run `npx tsc --noEmit`. Grep for `"@radix-ui/react-dialog"` in create-society-modal.tsx — must return zero. Grep for `DialogContent`, `GlassTextarea`, `Button` — must find them. Grep for hardcoded colors — must return zero.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors. Grep for `"@radix-ui/react-dialog"` in create-society-modal.tsx to confirm raw Radix removed. Grep for `DialogContent`, `GlassTextarea`, `Button` to confirm design system usage. Grep for hardcoded colors (`bg-zinc`, `border-zinc`, `text-zinc`, `bg-orange`, `bg-\[`) to confirm zero hardcoded values.
  </verify>
  <done>
CreateSocietyModal uses Dialog + GlassTextarea + Button (primary with loading) + Zod validation + dirty-form confirmation. Consistent overlay, animation, and close behavior from design system Dialog. All hardcoded colors replaced. No TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate LeaveFeedbackModal to design system</name>
  <files>src/components/app/leave-feedback-modal.tsx</files>
  <action>
**Step 1: Read current component**
Read `src/components/app/leave-feedback-modal.tsx` to understand:
- Props interface, Radix Dialog import pattern
- State: `displayName`, `displayEmail`, `feedback`, `isSubmitting`, `submitted` (success state)
- The `_isHydrated` check and settings store connection for pre-filling name/email
- Success state with checkmark animation
- Business logic in `handleSubmit`
- Email link in footer

**Step 2: Read design system components**
Read these files to understand their APIs:
- `src/components/ui/dialog.tsx` — `Dialog`, `DialogContent` (size), `DialogHeader`, `DialogTitle`, `DialogDescription`, `DialogClose`, `DialogFooter`
- `src/components/primitives/GlassInput.tsx` — `size`, `error` (boolean|string), `loading`, `leftIcon`, `rightIcon`, `showClear`, `onClear`
- `src/components/primitives/GlassTextarea.tsx` — `size`, `error` (boolean), `autoResize`, `minRows`, `maxRows`
- `src/components/ui/button.tsx` — `variant`, `size`, `loading`, `asChild`

**Step 3: Generate via v0**
First call ToolSearch with query "select:mcp__v0__v0_generate_ui" to load the tool. Then call `mcp__v0__v0_generate_ui` with a prompt including:

- The full current leave-feedback-modal.tsx code
- Design system APIs: Dialog (DialogContent size="md"), GlassInput (size, error as string for inline error message), GlassTextarea (autoResize, minRows, error), Button (variant="primary", loading), DialogClose
- Brand bible context: dark theme tokens, glass surfaces, coral accent
- Requirements:
  - Replace raw Radix Dialog with design system: `Dialog.Root` -> `Dialog`, `Dialog.Portal` + `Dialog.Overlay` + `Dialog.Content` -> `DialogContent size="md"`, `Dialog.Title` -> `DialogTitle` in `DialogHeader`
  - Replace name `<input>` with `<GlassInput placeholder="Your name" size="md" />`
  - Replace email `<input>` with `<GlassInput type="email" placeholder="your@email.com" size="md" />`
  - Replace feedback `<textarea>` with `<GlassTextarea autoResize minRows={4} placeholder="Tell us what you think..." />`
  - Replace submit button with `<Button variant="primary" loading={isSubmitting} disabled={isSubmitting || !feedback.trim()}>Submit</Button>` — keep ArrowRight icon next to text when not loading
  - Replace close (X) button with `<DialogClose asChild><Button variant="ghost" size="sm">` + X icon
  - Add Zod v4 validation: `z.object({ name: z.string().optional(), email: z.string().email({ error: "Enter a valid email" }).optional().or(z.literal("")), feedback: z.string().min(1, { error: "Required" }) })` — validate email on blur (if non-empty), feedback on blur and submit
  - Add dirty-form confirmation: `isDirty` state (set true on any change), `showDiscardConfirm` state. Intercept `onOpenChange`: if closing while dirty, show "Discard changes?" confirmation instead. Confirmation has Cancel and Discard buttons. On discard: reset form, close. On cancel: dismiss, stay.
  - Replace ALL hardcoded colors: `border-zinc-800` -> `border-border`, `bg-[#18181B]` -> removed, `border-zinc-700 bg-zinc-800` -> handled by GlassInput/GlassTextarea, `text-zinc-400` -> `text-foreground-secondary`, `text-zinc-500` -> `text-foreground-muted`, `bg-orange-500` -> Button primary, `bg-emerald-500/10 text-emerald-400` -> `bg-success/10 text-success` (if tokens exist, else keep green as intentional), remove `z-50`
- What to preserve: `_isHydrated` check and `displayName`/`displayEmail` pattern from settings store, success state (`submitted`) with checkmark animation, email link in footer, all `handleSubmit` business logic

**Step 4: Integrate v0 output**
Write v0's generated code to `src/components/app/leave-feedback-modal.tsx`, then manually adjust:
- Fix import paths: Dialog from `@/components/ui/dialog`, GlassInput from `@/components/primitives/GlassInput`, GlassTextarea from `@/components/primitives/GlassTextarea`, Button from `@/components/ui/button`, `z` from `zod`
- Re-wire settings store connection (`useSettingsStore`, `_isHydrated`), ensure `displayName`/`displayEmail` pre-fill logic works, verify success state rendering is intact
- Ensure `isDirty` + `showDiscardConfirm` pattern intercepts `onOpenChange` correctly (Dialog must NOT close when dirty, confirmation must appear instead)

**Step 5: Verify**
Run `npx tsc --noEmit`. Grep for `"@radix-ui/react-dialog"` in leave-feedback-modal.tsx — must return zero. Grep for `DialogContent`, `GlassInput`, `GlassTextarea`, `Button` — must find them. Grep for hardcoded colors — must return zero.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors. Grep for `"@radix-ui/react-dialog"` in leave-feedback-modal.tsx to confirm raw Radix removed. Grep for `DialogContent`, `GlassInput`, `GlassTextarea`, `Button` to confirm design system usage. Grep for hardcoded colors (`bg-zinc`, `border-zinc`, `text-zinc`, `bg-orange`, `bg-\[`) to confirm zero hardcoded values.
  </verify>
  <done>
LeaveFeedbackModal uses Dialog + GlassInput + GlassTextarea + Button + Zod validation + dirty-form confirmation. Consistent overlay, animation, and close behavior from design system Dialog. All hardcoded colors replaced. No TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 3: Migrate DeleteTestModal to design system styling with Button destructive</name>
  <files>src/components/app/delete-test-modal.tsx</files>
  <action>
**Step 1: Read current component**
Read `src/components/app/delete-test-modal.tsx` to understand:
- Props interface (`open`, `onOpenChange`, `onConfirm`)
- Raw Radix AlertDialog import and JSX structure
- AlertDialog.Cancel and AlertDialog.Action usage
- Current styling (inline styles, hardcoded colors)

**Step 2: Read design system components**
Read:
- `src/components/ui/dialog.tsx` — understand `dialogContentVariants` classes and `DialogOverlay` styling to replicate on AlertDialog
- `src/components/ui/button.tsx` — `variant="destructive"` and `variant="secondary"` styling

**Step 3: Generate via v0**
First call ToolSearch with query "select:mcp__v0__v0_generate_ui" to load the tool. Then call `mcp__v0__v0_generate_ui` with a prompt including:

- The full current delete-test-modal.tsx code
- Design system APIs: Button (variant="destructive", variant="secondary")
- The Dialog's Overlay and Content class patterns (from dialog.tsx — for visual consistency)
- Brand bible context: dark theme tokens, glass surfaces
- Requirements:
  - **KEEP AlertDialog for destructive action safety** — AlertDialog prevents close on overlay click. Do NOT replace with regular Dialog.
  - Keep `import * as AlertDialog from '@radix-ui/react-alert-dialog'`
  - Apply design system visual classes to AlertDialog.Overlay: `fixed inset-0 z-[var(--z-modal-backdrop)] bg-black/60 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0` with inline `style={{ backdropFilter: "blur(4px)", WebkitBackdropFilter: "blur(4px)" }}`
  - Apply design system classes to AlertDialog.Content: `fixed left-[50%] top-[50%] z-[var(--z-modal)] w-full max-w-md translate-x-[-50%] translate-y-[-50%] rounded-xl border border-border-glass bg-surface-elevated shadow-xl duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95` with inline `style={{ backdropFilter: "blur(20px)", WebkitBackdropFilter: "blur(20px)" }}`
  - AlertDialog.Title: `className="text-lg font-semibold text-foreground"`
  - AlertDialog.Description: `className="mt-2 text-sm text-foreground-secondary"`
  - Cancel button: `<AlertDialog.Cancel asChild><Button variant="secondary">Cancel</Button></AlertDialog.Cancel>`
  - Delete button: `<AlertDialog.Action asChild><Button variant="destructive" onClick={onConfirm}>Delete</Button></AlertDialog.Action>`
  - Replace ALL hardcoded colors: `border-zinc-800` -> `border-border-glass`, `bg-zinc-900` -> `bg-surface-elevated`, `text-white` -> `text-foreground`, `text-zinc-400` -> `text-foreground-secondary`, `border-zinc-700 bg-transparent` -> Button secondary, `text-zinc-300` -> Button, `bg-red-600` -> Button destructive, `z-50` -> `z-[var(--z-modal)]`/`z-[var(--z-modal-backdrop)]`
- What to preserve: AlertDialog.Root, AlertDialog.Portal, AlertDialog.Overlay, AlertDialog.Content structure. AlertDialog.Cancel/Action semantics. `onConfirm` callback. Props interface.

**Step 4: Integrate v0 output**
Write v0's generated code to `src/components/app/delete-test-modal.tsx`, then manually adjust:
- Fix import path: Button from `@/components/ui/button`
- Verify AlertDialog is still from `@radix-ui/react-alert-dialog` (not replaced with Dialog)
- Ensure `onConfirm` callback is wired to the Delete button
- Verify overlay click does NOT close the modal (AlertDialog behavior)

**Step 5: Verify**
Run `npx tsc --noEmit`. Grep for `AlertDialog` — must find it (preserved). Grep for `Button.*destructive` — must find it. Grep for `border-zinc`, `bg-zinc`, `text-zinc`, `bg-red`, `ring-zinc`, `ring-red` — must return zero. Grep for `z-\[var(--z-modal` — must find it.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors. Grep for `AlertDialog` to confirm AlertDialog is preserved (not replaced with Dialog). Grep for `Button.*destructive` to confirm design system Button is used. Grep for `border-zinc\|bg-zinc\|text-zinc\|bg-red\|ring-zinc\|ring-red` to confirm zero hardcoded colors. Grep for `z-\[var(--z-modal` to confirm z-index tokens.
  </verify>
  <done>
DeleteTestModal keeps AlertDialog primitives for overlay-click prevention. Uses design system visual styling (border-border-glass, bg-surface-elevated, z-index tokens, glass backdrop-filter). Cancel uses Button secondary, Delete uses Button destructive. All hardcoded colors replaced. No TypeScript errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `grep -c "@radix-ui/react-dialog" src/components/app/create-society-modal.tsx src/components/app/leave-feedback-modal.tsx` returns 0 for both
3. `grep -c "DialogContent" src/components/app/create-society-modal.tsx src/components/app/leave-feedback-modal.tsx` returns >= 1 each
4. `grep -c "AlertDialog" src/components/app/delete-test-modal.tsx` returns >= 1 (preserved)
5. `grep -c "Button" src/components/app/create-society-modal.tsx src/components/app/delete-test-modal.tsx src/components/app/leave-feedback-modal.tsx` returns >= 1 each
6. `grep -c "GlassTextarea" src/components/app/create-society-modal.tsx` returns >= 1
7. `grep -c "GlassInput" src/components/app/leave-feedback-modal.tsx` returns >= 1
8. `grep -c "isDirty\|showDiscardConfirm" src/components/app/create-society-modal.tsx src/components/app/leave-feedback-modal.tsx` returns >= 1 each
9. `grep -c "bg-zinc\|border-zinc\|text-zinc\|bg-orange\|bg-red\|bg-\[#" src/components/app/create-society-modal.tsx src/components/app/delete-test-modal.tsx src/components/app/leave-feedback-modal.tsx` returns 0 for all
10. `npm run build` completes without errors
</verification>

<success_criteria>
- CreateSocietyModal uses Dialog, GlassTextarea, Button (primary with loading), Zod validation, dirty-form confirmation
- DeleteTestModal uses AlertDialog (preserved) with design system styling, Button destructive, z-index tokens, glass backdrop-filter
- LeaveFeedbackModal uses Dialog, GlassInput, GlassTextarea, Button (primary with loading), Zod validation, dirty-form confirmation
- DeleteTestModal does NOT close on overlay click (AlertDialog behavior intact)
- All three modals have consistent overlay, animation, and close behavior
- Zero hardcoded color values in all three files
- Props interfaces unchanged
</success_criteria>

<output>
After completion, create `.planning/phases/46-forms-modals/46-03-SUMMARY.md`
</output>
