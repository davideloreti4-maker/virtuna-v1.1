---
phase: 46-forms-modals
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/content-form.tsx
  - src/components/app/survey-form.tsx
autonomous: true

must_haves:
  truths:
    - "ContentForm textarea uses GlassTextarea with autoResize instead of raw textarea"
    - "SurveyForm question textarea uses GlassTextarea instead of raw textarea"
    - "SurveyForm option inputs use GlassInput instead of raw inputs"
    - "SurveyForm question type dropdown uses design system Select instead of Radix DropdownMenu"
    - "Both forms validate on blur and on submit with inline error text below invalid fields"
    - "Submit buttons use Button variant=primary with loading prop during submission"
    - "Character counter appears on textareas when within 20% of max length"
    - "All hardcoded zinc/orange colors replaced with design tokens"
  artifacts:
    - path: "src/components/app/content-form.tsx"
      provides: "Content form using GlassTextarea + Button + Zod validation"
      contains: "GlassTextarea"
    - path: "src/components/app/survey-form.tsx"
      provides: "Survey form using GlassInput + GlassTextarea + Select + Button + Zod validation"
      contains: "GlassInput"
  key_links:
    - from: "src/components/app/content-form.tsx"
      to: "@/components/primitives/GlassTextarea"
      via: "import"
      pattern: "GlassTextarea"
    - from: "src/components/app/content-form.tsx"
      to: "@/components/ui/button"
      via: "import"
      pattern: "Button.*variant.*primary"
    - from: "src/components/app/survey-form.tsx"
      to: "@/components/ui/select"
      via: "import replacing DropdownMenu"
      pattern: "Select.*options"
    - from: "src/components/app/survey-form.tsx"
      to: "@/components/primitives/GlassInput"
      via: "import"
      pattern: "GlassInput"
---

<objective>
Migrate ContentForm and SurveyForm to design system components with Zod v4 validation.

Purpose: Replace all raw HTML form elements and hardcoded styles with GlassTextarea, GlassInput, Select, and Button from the design system. Add on-blur + on-submit validation with inline error text. This covers FORM-01, FORM-02, FORM-04, FORM-05.
Output: Two fully migrated form components using design system primitives with consistent validation, focus rings, error states, and submit loading states.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/46-forms-modals/46-CONTEXT.md
@.planning/phases/46-forms-modals/46-RESEARCH.md

@src/components/app/content-form.tsx
@src/components/app/survey-form.tsx
@src/components/app/test-creation-flow.tsx
@src/components/primitives/GlassTextarea.tsx
@src/components/primitives/GlassInput.tsx
@src/components/ui/select.tsx
@src/components/ui/button.tsx
@src/lib/test-types.ts
@src/types/test.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate ContentForm to design system components with Zod validation</name>
  <files>src/components/app/content-form.tsx</files>
  <action>
Replace all raw HTML form elements in `content-form.tsx` with design system components. Use v0 MCP as the primary UI generation tool -- generate the migrated component through v0, providing BRAND-BIBLE.md and current component code as context.

**Input migration:**
- Replace raw `<textarea>` with `<GlassTextarea>` from `@/components/primitives/GlassTextarea`. Use `autoResize` prop (remove manual `useEffect` height calculation). Set `size="md"`.
- The GlassTextarea handles auto-resize natively -- delete the entire `useEffect` block that manually sets `textarea.style.height`.

**Button migration:**
- Replace the submit button (`<button type="submit" className="...bg-orange-500...">`) with `<Button variant="primary">Simulate</Button>` from `@/components/ui/button`. Add `loading={isSubmitting}` prop (add `isSubmitting` state to the component).
- Replace the type selector badge button (the `onChangeType` trigger) with `<Button variant="secondary" size="sm">` wrapping the icon + type name.
- Replace "Upload Images" and "Help Me Craft" buttons with `<Button variant="secondary" size="sm">` with appropriate content.

**Zod v4 validation:**
- Add a Zod schema:
  ```typescript
  const contentFormSchema = z.object({
    content: z.string()
      .min(1, { error: "Required" })
      .min(10, { error: "At least 10 characters" }),
  });
  ```
- Add `errors` state: `useState<Record<string, string>>({})`.
- Add `validateField` function that validates on blur using `contentFormSchema.shape.content.safeParse(value)`.
- Add `validateForm` function that validates all fields on submit.
- On blur of textarea: call `validateField("content", content)`.
- After first error, re-validate on change (clear error when valid). Track `touched` state per field.
- Display error text below textarea: `{errors.content && <p className="text-sm text-error" role="alert">{errors.content}</p>}`.

**Character counter:**
- Add character counter below GlassTextarea. Show only when `content.length >= MAX_LENGTH * 0.8` (where MAX_LENGTH = 500).
- Format: `{content.length}/{MAX_LENGTH}`. Use `text-foreground-muted` color, switch to `text-error` when at/over limit.
- Position: right-aligned below the textarea.

**Token migration:**
- Replace `border-zinc-800 bg-zinc-900` on the form wrapper with `border-border bg-surface`.
- Replace `text-white` with `text-foreground`.
- Replace `text-zinc-600` (placeholder) with `placeholder:text-foreground-muted`.
- Replace `border-zinc-800` on separator with `border-border`.
- Replace `text-zinc-400` with `text-foreground-secondary`.
- Replace `bg-zinc-800/50` with `bg-surface-elevated/50`.
- Replace `border-zinc-700` with `border-border`.

**Preserve:**
- The `iconMap` record and icon rendering logic (keep Lucide icons -- icon migration is separate scope).
- The `isViewingHistory` read-only behavior and `currentResult` pre-fill logic.
- The `onChangeType`, `onSubmit` props interface.
- All existing business logic in `handleSubmit`.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors. Grep for `bg-zinc`, `border-zinc`, `text-zinc`, `bg-orange` in content-form.tsx to confirm zero hardcoded colors. Grep for `GlassTextarea` and `Button` to confirm design system imports.
  </verify>
  <done>
ContentForm uses GlassTextarea (with autoResize) for content input, Button (primary) for submit with loading state, Button (secondary) for action buttons. Zod v4 validation on blur + submit with inline error text. Character counter at 80%+ of max. All hardcoded colors replaced with design tokens. No TypeScript errors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate SurveyForm to design system components with Zod validation</name>
  <files>src/components/app/survey-form.tsx</files>
  <action>
Replace all raw HTML form elements in `survey-form.tsx` with design system components. Use v0 MCP as the primary UI generation tool.

**Input migration:**
- Replace the question `<textarea>` with `<GlassTextarea>` from `@/components/primitives/GlassTextarea`. Use `autoResize` prop. Remove manual height `useEffect`.
- Replace each option `<input>` with `<GlassInput>` from `@/components/primitives/GlassInput`. Set `size="sm"` for compact option inputs.

**Dropdown migration (critical):**
- Delete the entire `QuestionTypeDropdown` component (lines ~243-300).
- Remove `import * as DropdownMenu from "@radix-ui/react-dropdown-menu"` and the `ChevronDown`, `Check` icons from Lucide (unless needed elsewhere).
- Replace with design system `Select` from `@/components/ui/select`:
  ```tsx
  const QUESTION_TYPE_OPTIONS = [
    { value: "single-select", label: "Single Select" },
    { value: "open-response", label: "Open Response" },
  ];

  <Select
    options={QUESTION_TYPE_OPTIONS}
    value={questionType}
    onChange={(val) => setQuestionType(val as QuestionType)}
    placeholder="Select question type..."
  />
  ```
- When `isViewingHistory`, pass `disabled` prop to Select.

**Button migration:**
- Replace submit button with `<Button variant="primary">Ask</Button>`. Add `loading={isSubmitting}` (add `isSubmitting` state).
- Replace the type badge button with `<Button variant="secondary" size="sm">`.
- Replace add/remove option buttons with `<Button variant="ghost" size="sm">`.

**Zod v4 validation:**
- Add schema:
  ```typescript
  const surveyFormSchema = z.object({
    question: z.string()
      .min(1, { error: "Required" })
      .min(5, { error: "At least 5 characters" }),
  });
  ```
- Validate question field on blur and on submit with inline error text.
- Options don't need validation beyond the existing empty-filter logic.

**Token migration:**
- Replace `border-zinc-800 bg-zinc-900` with `border-border bg-surface`.
- Replace all `text-zinc-*` with corresponding design tokens (`text-foreground`, `text-foreground-secondary`, `text-foreground-muted`).
- Replace `bg-zinc-800/50` with `bg-surface-elevated/50`.
- Replace `border-zinc-700` with `border-border`.
- Replace `bg-orange-500` with design system Button primary.
- Replace `focus-visible:ring-indigo-500` with the design system focus ring pattern.
- Replace `text-indigo-500` (check icon) with `text-accent`.
- Replace label `text-zinc-500` with `text-foreground-muted`.

**Preserve:**
- The `SurveySubmission` interface and export (other components import it).
- The `QuestionType` type.
- All option management callbacks (`addOption`, `removeOption`, `updateOption`).
- The `isViewingHistory` read-only behavior.
- The `GripVertical` drag handle icon (visual only, keep as-is).
- All business logic in `handleSubmit`.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors. Grep for `DropdownMenu` in survey-form.tsx to confirm Radix dropdown is removed. Grep for `Select` to confirm design system Select is used. Grep for `GlassTextarea`, `GlassInput`, `Button` to confirm design system imports. Grep for `bg-zinc`, `border-zinc`, `text-zinc`, `bg-orange`, `text-indigo` to confirm zero hardcoded colors.
  </verify>
  <done>
SurveyForm uses GlassTextarea for question input, GlassInput for option inputs, Select for question type dropdown (replacing Radix DropdownMenu), Button (primary) for submit with loading state. Zod v4 validation on question field. QuestionTypeDropdown component deleted. All hardcoded colors replaced with design tokens. SurveySubmission interface preserved. No TypeScript errors.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `grep -c "bg-zinc\|border-zinc\|text-zinc\|bg-orange\|text-indigo" src/components/app/content-form.tsx src/components/app/survey-form.tsx` returns 0 for both files
3. `grep -c "GlassTextarea" src/components/app/content-form.tsx` returns >= 1
4. `grep -c "GlassInput" src/components/app/survey-form.tsx` returns >= 1
5. `grep -c "Select" src/components/app/survey-form.tsx` returns >= 1 (design system Select)
6. `grep -c "DropdownMenu" src/components/app/survey-form.tsx` returns 0 (Radix removed)
7. `grep -c "Button" src/components/app/content-form.tsx src/components/app/survey-form.tsx` returns >= 2 each
8. `grep -c "z\.string\|safeParse\|zod" src/components/app/content-form.tsx src/components/app/survey-form.tsx` returns >= 1 each
9. `npm run build` completes without errors
</verification>

<success_criteria>
- ContentForm uses GlassTextarea, Button (primary/secondary), Zod v4 validation with inline errors, character counter
- SurveyForm uses GlassTextarea, GlassInput, Select (replacing Radix DropdownMenu), Button, Zod v4 validation
- All form inputs show consistent focus rings (from design system primitives)
- Error text appears below invalid fields on blur and submit
- Submit buttons show loading state during submission
- Zero hardcoded color classes remain
- No TypeScript errors
- test-creation-flow.tsx continues to work without changes (props interfaces preserved)
</success_criteria>

<output>
After completion, create `.planning/phases/46-forms-modals/46-01-SUMMARY.md`
</output>
