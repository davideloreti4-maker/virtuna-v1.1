---
phase: 46-forms-modals
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/society-selector.tsx
autonomous: false

must_haves:
  truths:
    - "SocietySelector modal uses design system Dialog (not raw Radix Dialog)"
    - "Society cards use GlassCard with appropriate hover effect"
    - "Selected society shows coral accent border/ring (brand accent)"
    - "Create Target Society button uses design system styling"
    - "Dialog trigger button uses design system tokens"
    - "All hardcoded zinc/orange colors replaced with design tokens"
    - "The _hydrate pattern is preserved (not migrated to Zustand persist)"
    - "All modals across the phase use consistent overlay, animation, and close behavior"
  artifacts:
    - path: "src/components/app/society-selector.tsx"
      provides: "Society selector using Dialog + GlassCard"
      contains: "DialogContent"
  key_links:
    - from: "src/components/app/society-selector.tsx"
      to: "@/components/ui/dialog"
      via: "import replacing raw Radix Dialog"
      pattern: "import.*Dialog.*from.*ui/dialog"
    - from: "src/components/app/society-selector.tsx"
      to: "@/components/primitives/GlassCard"
      via: "import for society cards"
      pattern: "GlassCard"
    - from: "src/components/app/society-selector.tsx"
      to: "src/stores/society-store.ts"
      via: "useSocietyStore with _hydrate pattern preserved"
      pattern: "_hydrate"
---

<objective>
Migrate SocietySelector modal to design system Dialog + GlassCard and verify MODL-05 consistency across all phase modals.

Purpose: Replace raw Radix Dialog and hardcoded styles in SocietySelector with design system components. Preserve the _hydrate pattern. After migration, visually verify all 5 modals (TestTypeSelector, CreateSociety, DeleteTest, LeaveFeedback, SocietySelector) use consistent overlay/animation/close behavior. This covers MODL-04 and MODL-05.
Output: SocietySelector using Dialog, DialogContent, GlassCard. All phase modals verified consistent.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/46-forms-modals/46-CONTEXT.md
@.planning/phases/46-forms-modals/46-RESEARCH.md

@src/components/app/society-selector.tsx
@src/components/app/create-society-modal.tsx
@src/components/ui/dialog.tsx
@src/components/primitives/GlassCard.tsx
@src/components/ui/button.tsx
@src/stores/society-store.ts
@src/types/society.ts
@.planning/BRAND-BIBLE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate SocietySelector to design system Dialog + GlassCard</name>
  <files>src/components/app/society-selector.tsx</files>
  <action>
**Step 1: Read current component**
Read `src/components/app/society-selector.tsx` to understand:
- Props interface and export
- Raw Radix Dialog import (`import * as Dialog from "@radix-ui/react-dialog"`)
- Dialog.Root, Dialog.Trigger, Dialog.Portal, Dialog.Overlay, Dialog.Content, Dialog.Close usage
- Sub-components: `PersonalSocietyCard`, `TargetSocietyCard`, `PlatformIcon`, `SocietyIcon`
- The `_hydrate()` call in `useEffect` and `_isHydrated` check (MUST preserve)
- All `useMemo` derivations: `selectedSociety`, `personalSocieties`, `targetSocieties`
- `CardActionMenu` import and usage in TargetSocietyCard
- `CreateSocietyModal` import and rendering
- All event handlers: `handleSelectSociety`, `handleCreateSociety`, `handleEdit`, `handleRefresh`, `handleDelete`
- The trigger button (shows selected society name + ChevronDown)
- The "Create Target Society" dashed-border card

Also read `src/stores/society-store.ts` to understand the `_hydrate` and `_isHydrated` pattern.

**Step 2: Read design system components**
Read these files to understand their APIs:
- `src/components/ui/dialog.tsx` — `Dialog`, `DialogContent` (size: "full" for large selectors), `DialogTrigger`, `DialogClose`
- `src/components/primitives/GlassCard.tsx` — `hover` ("lift"|"glow-boost"|"none"), `padding`, `color`, `tinted`, `glow`, `onClick`, `className`
- `src/components/ui/button.tsx` — `variant`, `size`, `loading`, `asChild`
- `src/components/ui/badge.tsx` — `variant`, `size`

**Step 3: Generate via v0**
Load the v0 MCP tool via ToolSearch (query: "select:mcp__v0__v0_generate_ui"), then call `mcp__v0__v0_generate_ui` with a prompt including:

- The full current society-selector.tsx code (this is the most complex component — include all sub-components)
- Design system APIs: Dialog (DialogContent size="full" className="max-w-[800px]"), DialogTrigger, DialogClose, GlassCard (hover="lift", padding="md", onClick), Button (variant="secondary", "ghost"), Badge (variant="accent", "secondary")
- Brand bible context: dark theme tokens, glass surfaces, coral accent (#E57850) for selection state
- Requirements:
  - Replace raw Radix Dialog: `Dialog.Root` -> `Dialog`, `Dialog.Trigger asChild` -> `DialogTrigger asChild`, `Dialog.Portal` + `Dialog.Overlay` + `Dialog.Content` -> `DialogContent size="full" className="max-w-[800px]"`, `Dialog.Close` -> `DialogClose`
  - Trigger button: `<Button variant="secondary" className="w-full justify-between">` with society name + ChevronDown. Loading state (pre-hydration): `<Button variant="secondary" disabled className="w-full justify-between">`
  - Close button: `<DialogClose asChild><Button variant="ghost" size="sm">` + X icon
  - **PersonalSocietyCard:** Replace raw `<button>` card with `<GlassCard hover="lift" padding="md">` in clickable wrapper. Selected state: `className="ring-2 ring-accent border-accent"` (replaces `border-orange-500 ring-2 ring-orange-500/50`). Setup badge: `<Badge variant="accent" size="sm">Setup</Badge>` (replaces `bg-orange-500` badge)
  - **TargetSocietyCard:** Same GlassCard pattern. Selected state: `ring-2 ring-accent border-accent`. Society type badge: `<Badge variant="secondary" size="sm">{society.societyType}</Badge>` (replaces `bg-zinc-800 text-zinc-300`)
  - **Create Target Society button:** `<GlassCard padding="md" className="border-dashed cursor-pointer">` or `<Button variant="ghost" className="min-h-[180px] flex-col border-dashed border">` with Plus icon + "Create Target Society" text
  - Replace ALL hardcoded colors across all sub-components:
    - Main: `border-zinc-800 bg-zinc-900` -> Button secondary, `text-zinc-500` -> `text-foreground-muted`, `text-zinc-400` -> by Button, `border-zinc-800` separator -> `border-border`, `bg-[#18181B]` -> removed, `z-50` -> removed
    - PersonalSocietyCard: `border-dashed border-zinc-700` -> `border-dashed border-border`, `hover:border-zinc-500 hover:bg-zinc-800/30` -> GlassCard hover, `border-solid border-orange-500 ring-2 ring-orange-500/50` -> `border-accent ring-2 ring-accent/50`, `bg-orange-500 text-white` badge -> Badge accent, `text-white` -> `text-foreground`, `text-zinc-400` -> `text-foreground-secondary`
    - TargetSocietyCard: `border-zinc-800 bg-zinc-900/50` -> GlassCard, `hover:border-zinc-600 hover:bg-zinc-800/50` -> GlassCard hover, `border-orange-500 ring-2 ring-orange-500/50` -> `border-accent ring-2 ring-accent/50`, `bg-zinc-800 text-zinc-300` badge -> Badge secondary
    - PlatformIcon/SocietyIcon: `text-white` -> `text-foreground`, `text-zinc-400` -> `text-foreground-secondary`
    - Create button: `border-dashed border-zinc-700` -> `border-dashed border-border`, `hover:border-zinc-600 hover:bg-zinc-900/30` -> `hover:border-border-hover hover:bg-hover`, `text-zinc-500` -> `text-foreground-muted`, `text-zinc-400` -> `text-foreground-secondary`
- What to preserve (CRITICAL): `_hydrate()` call in useEffect and `_isHydrated` check, all `useMemo` derivations, `CardActionMenu` import and usage, `CreateSocietyModal` import and rendering, ALL event handlers, `PlatformIcon` and `SocietyIcon` sub-components, props interface and export

**Step 4: Integrate v0 output**
Write v0's generated code to `src/components/app/society-selector.tsx`, then manually adjust:
- Fix import paths: Dialog from `@/components/ui/dialog`, GlassCard from `@/components/primitives/GlassCard`, Button from `@/components/ui/button`, Badge from `@/components/ui/badge`
- Re-wire `useSocietyStore` connection — ensure `_hydrate()` call in useEffect and `_isHydrated` check are exactly as before (v0 will likely not understand this pattern)
- Re-wire all event handlers if v0 altered them
- Ensure `CardActionMenu` import and usage in TargetSocietyCard is preserved
- Ensure `CreateSocietyModal` import and rendering (with its open/close state) is preserved
- Verify all `useMemo` derivations are intact (`selectedSociety`, `personalSocieties`, `targetSocieties`)
- Verify `PlatformIcon` and `SocietyIcon` sub-components render correctly with new tokens

**Step 5: Verify**
Run `npx tsc --noEmit`. Grep for `"@radix-ui/react-dialog"` — must return zero. Grep for `DialogContent` and `GlassCard` — must find them. Grep for `_hydrate` — must find it (preserved). Grep for hardcoded colors (`bg-zinc`, `border-zinc`, `text-zinc`, `bg-orange`, `ring-orange`, `bg-\[#`) — must return zero.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors. Grep for `"@radix-ui/react-dialog"` to confirm raw Radix removed. Grep for `DialogContent` and `GlassCard` to confirm design system usage. Grep for `_hydrate` to confirm hydration pattern preserved. Grep for hardcoded colors (`bg-zinc`, `border-zinc`, `text-zinc`, `bg-orange`, `ring-orange`, `bg-\[#`) to confirm zero hardcoded values.
  </verify>
  <done>
SocietySelector uses Dialog from @/components/ui/dialog, GlassCard for society cards, Button for trigger and actions, Badge for labels. Selected state uses ring-accent. _hydrate pattern preserved. All hardcoded colors replaced with design tokens. No TypeScript errors.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>All 5 modals (TestTypeSelector, CreateSocietyModal, DeleteTestModal, LeaveFeedbackModal, SocietySelector) and 2 forms (ContentForm, SurveyForm) migrated to design system components across plans 01-04.</what-built>
  <how-to-verify>
1. Run `npm run dev` and open http://localhost:3000 in the browser.
2. Open the society selector dropdown -- verify it opens as a glass Dialog with GlassCard society cards, coral accent on selected.
3. Click "Create Target Society" -- verify CreateSocietyModal opens with GlassTextarea, coral Button, glass backdrop. Type something, then try to close -- verify dirty-form confirmation appears.
4. Open the test type selector (create new test button) -- verify it shows as a glass Dialog with a responsive grid of GlassCards, each with icon + title + description. Click a type -- verify it proceeds immediately.
5. On the content form -- verify GlassTextarea is used, coral submit Button, error appears if you blur with empty content.
6. On the survey form -- verify GlassTextarea for question, GlassInput for options, Select dropdown for question type. Verify coral submit Button.
7. Trigger delete on a test history item -- verify DeleteTestModal uses glass styling with destructive red button, does NOT close on overlay click.
8. Open feedback modal (if accessible from UI) -- verify GlassInput + GlassTextarea + coral submit button.
9. Check that ALL modals have consistent backdrop blur, fade+scale animation, and close on Escape.
10. Check mobile viewport (resize to ~375px) -- verify modals are centered and usable.
  </how-to-verify>
  <resume-signal>Type "approved" to confirm all modals and forms look correct, or describe issues that need fixing.</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `grep -c "@radix-ui/react-dialog" src/components/app/society-selector.tsx` returns 0
3. `grep -c "DialogContent" src/components/app/society-selector.tsx` returns >= 1
4. `grep -c "GlassCard" src/components/app/society-selector.tsx` returns >= 1
5. `grep -c "_hydrate" src/components/app/society-selector.tsx` returns >= 1 (preserved)
6. `grep -c "bg-zinc\|border-zinc\|text-zinc\|bg-orange\|ring-orange\|bg-\[#" src/components/app/society-selector.tsx` returns 0
7. `npm run build` completes without errors
8. Human verification of all 5 modals and 2 forms confirms consistent design system usage
</verification>

<success_criteria>
- SocietySelector uses Dialog, GlassCard, Button, Badge from design system
- _hydrate pattern preserved unchanged
- Selected society shows accent ring (coral)
- All 5 modals have consistent overlay, animation, close behavior (MODL-05)
- All form inputs show consistent focus rings and error states (FORM-05)
- Zero hardcoded color values in society-selector.tsx
- Human verifies visual consistency across all migrated components
</success_criteria>

<output>
After completion, create `.planning/phases/46-forms-modals/46-04-SUMMARY.md`
</output>
