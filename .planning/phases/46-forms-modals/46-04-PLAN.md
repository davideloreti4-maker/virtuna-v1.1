---
phase: 46-forms-modals
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/society-selector.tsx
autonomous: false

must_haves:
  truths:
    - "SocietySelector modal uses design system Dialog (not raw Radix Dialog)"
    - "Society cards use GlassCard with appropriate hover effect"
    - "Selected society shows coral accent border/ring (brand accent)"
    - "Create Target Society button uses design system styling"
    - "Dialog trigger button uses design system tokens"
    - "All hardcoded zinc/orange colors replaced with design tokens"
    - "The _hydrate pattern is preserved (not migrated to Zustand persist)"
    - "All modals across the phase use consistent overlay, animation, and close behavior"
  artifacts:
    - path: "src/components/app/society-selector.tsx"
      provides: "Society selector using Dialog + GlassCard"
      contains: "DialogContent"
  key_links:
    - from: "src/components/app/society-selector.tsx"
      to: "@/components/ui/dialog"
      via: "import replacing raw Radix Dialog"
      pattern: "import.*Dialog.*from.*ui/dialog"
    - from: "src/components/app/society-selector.tsx"
      to: "@/components/primitives/GlassCard"
      via: "import for society cards"
      pattern: "GlassCard"
    - from: "src/components/app/society-selector.tsx"
      to: "src/stores/society-store.ts"
      via: "useSocietyStore with _hydrate pattern preserved"
      pattern: "_hydrate"
---

<objective>
Migrate SocietySelector modal to design system Dialog + GlassCard and verify MODL-05 consistency across all phase modals.

Purpose: Replace raw Radix Dialog and hardcoded styles in SocietySelector with design system components. Preserve the _hydrate pattern. After migration, visually verify all 5 modals (TestTypeSelector, CreateSociety, DeleteTest, LeaveFeedback, SocietySelector) use consistent overlay/animation/close behavior. This covers MODL-04 and MODL-05.
Output: SocietySelector using Dialog, DialogContent, GlassCard. All phase modals verified consistent.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/46-forms-modals/46-CONTEXT.md
@.planning/phases/46-forms-modals/46-RESEARCH.md

@src/components/app/society-selector.tsx
@src/components/app/create-society-modal.tsx
@src/components/ui/dialog.tsx
@src/components/primitives/GlassCard.tsx
@src/components/ui/button.tsx
@src/stores/society-store.ts
@src/types/society.ts
@BRAND-BIBLE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate SocietySelector to design system Dialog + GlassCard</name>
  <files>src/components/app/society-selector.tsx</files>
  <action>
Migrate `society-selector.tsx` to use design system components. Use v0 MCP as the primary UI generation tool.

**Dialog migration:**
- Remove `import * as Dialog from "@radix-ui/react-dialog"`.
- Import `{ Dialog, DialogContent, DialogTrigger, DialogClose }` from `@/components/ui/dialog`.
- Import `{ Button }` from `@/components/ui/button`.

- Replace Dialog structure:
  - `<Dialog.Root>` -> `<Dialog>`
  - `<Dialog.Trigger asChild>` -> `<DialogTrigger asChild>`
  - `<Dialog.Portal>` + `<Dialog.Overlay>` + `<Dialog.Content>` -> `<DialogContent size="full" className="max-w-[800px]">` (DialogContent renders portal + overlay automatically)
  - `<Dialog.Close>` -> `<DialogClose>`

**Trigger button:**
- Replace the trigger button with `<Button variant="secondary" className="w-full justify-between">` wrapping the society name + ChevronDown icon.
- Loading state button (pre-hydration) also uses `<Button variant="secondary" disabled className="w-full justify-between">`.

**Close button:**
- Replace X close button with `<DialogClose asChild><Button variant="ghost" size="sm">` with X icon.

**Society cards migration:**
- Import `GlassCard` from `@/components/primitives` (or `@/components/primitives/GlassCard`).

- **PersonalSocietyCard:** Replace the raw `<button>` card with `<GlassCard hover="lift" padding="md">` inside a clickable wrapper.
  - Selection state: When `isSelected`, add `className="ring-2 ring-accent border-accent"` (replaces `border-orange-500 ring-2 ring-orange-500/50`).
  - Setup badge: Replace `bg-orange-500` badge with design system `<Badge variant="accent" size="sm">Setup</Badge>` (import Badge from `@/components/ui/badge`).
  - Text tokens: `text-white` -> `text-foreground`, `text-zinc-400` -> `text-foreground-secondary`.

- **TargetSocietyCard:** Same GlassCard migration pattern.
  - Selection state: Same `ring-2 ring-accent border-accent` pattern.
  - Society type badge: Replace `bg-zinc-800 text-zinc-300` with `<Badge variant="secondary" size="sm">{society.societyType}</Badge>`.
  - Text tokens: Same replacements.

- **Create Target Society button:** Replace the dashed border button with `<GlassCard padding="md" className="border-dashed cursor-pointer">` or a `<Button variant="ghost" className="min-h-[180px] flex-col border-dashed border">` â€” choose whichever looks better for the "create new" card pattern. Keep Plus icon + "Create Target Society" text.

**Token migration (main component):**
- Replace `border-zinc-800 bg-zinc-900` (trigger) -> handled by Button secondary.
- Replace `text-zinc-500` (loading state) -> `text-foreground-muted`.
- Replace `text-zinc-400` (chevron) -> handled by Button.
- Replace `border-zinc-800` (separator) -> `border-border`.
- Replace `bg-[#18181B]` -> removed (DialogContent handles bg).
- Remove all `z-50` classes (Dialog handles z-index).

**Token migration (PersonalSocietyCard):**
- Replace `border-dashed border-zinc-700` -> `border-dashed border-border`.
- Replace `hover:border-zinc-500 hover:bg-zinc-800/30` -> handled by GlassCard hover.
- Replace `border-solid border-orange-500 ring-2 ring-orange-500/50` -> `border-accent ring-2 ring-accent/50`.
- Replace `bg-orange-500 text-white` (badge) -> Badge accent variant.
- Replace `text-white` -> `text-foreground`.
- Replace `text-zinc-400` -> `text-foreground-secondary`.

**Token migration (TargetSocietyCard):**
- Replace `border-zinc-800 bg-zinc-900/50` -> handled by GlassCard.
- Replace `hover:border-zinc-600 hover:bg-zinc-800/50` -> handled by GlassCard hover.
- Replace `border-orange-500 ring-2 ring-orange-500/50` -> `border-accent ring-2 ring-accent/50`.
- Replace `bg-zinc-800 text-zinc-300` (badge) -> Badge secondary variant.

**Token migration (PlatformIcon, SocietyIcon):**
- Replace `text-white` -> `text-foreground`.
- Replace `text-zinc-400` -> `text-foreground-secondary`.

**Token migration (Create button):**
- Replace `border-dashed border-zinc-700` -> `border-dashed border-border`.
- Replace `hover:border-zinc-600 hover:bg-zinc-900/30` -> `hover:border-border-hover hover:bg-hover`.
- Replace `text-zinc-500` (icon) -> `text-foreground-muted`.
- Replace `text-zinc-400` (text) -> `text-foreground-secondary`.

**Preserve (critical):**
- The `_hydrate()` call in `useEffect` and `_isHydrated` check. Do NOT change the hydration pattern.
- All `useMemo` derivations (`selectedSociety`, `personalSocieties`, `targetSocieties`).
- `CardActionMenu` import and usage in TargetSocietyCard.
- `CreateSocietyModal` import and rendering.
- All event handlers (`handleSelectSociety`, `handleCreateSociety`, `handleEdit`, `handleRefresh`, `handleDelete`).
- `PlatformIcon` and `SocietyIcon` sub-components.
- Props interface and export.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no TypeScript errors. Grep for `"@radix-ui/react-dialog"` to confirm raw Radix removed. Grep for `DialogContent` and `GlassCard` to confirm design system usage. Grep for `_hydrate` to confirm hydration pattern preserved. Grep for hardcoded colors (`bg-zinc`, `border-zinc`, `text-zinc`, `bg-orange`, `bg-\[#`, `ring-orange`) to confirm zero hardcoded values.
  </verify>
  <done>
SocietySelector uses Dialog from @/components/ui/dialog, GlassCard for society cards, Button for trigger and actions, Badge for labels. Selected state uses ring-accent. _hydrate pattern preserved. All hardcoded colors replaced with design tokens. No TypeScript errors.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>All 5 modals (TestTypeSelector, CreateSocietyModal, DeleteTestModal, LeaveFeedbackModal, SocietySelector) and 2 forms (ContentForm, SurveyForm) migrated to design system components across plans 01-04.</what-built>
  <how-to-verify>
1. Run `npm run dev` and open http://localhost:3000 in the browser.
2. Open the society selector dropdown -- verify it opens as a glass Dialog with GlassCard society cards, coral accent on selected.
3. Click "Create Target Society" -- verify CreateSocietyModal opens with GlassTextarea, coral Button, glass backdrop. Type something, then try to close -- verify dirty-form confirmation appears.
4. Open the test type selector (create new test button) -- verify it shows as a glass Dialog with a responsive grid of GlassCards, each with icon + title + description. Click a type -- verify it proceeds immediately.
5. On the content form -- verify GlassTextarea is used, coral submit Button, error appears if you blur with empty content.
6. On the survey form -- verify GlassTextarea for question, GlassInput for options, Select dropdown for question type. Verify coral submit Button.
7. Trigger delete on a test history item -- verify DeleteTestModal uses glass styling with destructive red button, does NOT close on overlay click.
8. Open feedback modal (if accessible from UI) -- verify GlassInput + GlassTextarea + coral submit button.
9. Check that ALL modals have consistent backdrop blur, fade+scale animation, and close on Escape.
10. Check mobile viewport (resize to ~375px) -- verify modals are centered and usable.
  </how-to-verify>
  <resume-signal>Type "approved" to confirm all modals and forms look correct, or describe issues that need fixing.</resume-signal>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `grep -c "@radix-ui/react-dialog" src/components/app/society-selector.tsx` returns 0
3. `grep -c "DialogContent" src/components/app/society-selector.tsx` returns >= 1
4. `grep -c "GlassCard" src/components/app/society-selector.tsx` returns >= 1
5. `grep -c "_hydrate" src/components/app/society-selector.tsx` returns >= 1 (preserved)
6. `grep -c "bg-zinc\|border-zinc\|text-zinc\|bg-orange\|ring-orange\|bg-\[#" src/components/app/society-selector.tsx` returns 0
7. `npm run build` completes without errors
8. Human verification of all 5 modals and 2 forms confirms consistent design system usage
</verification>

<success_criteria>
- SocietySelector uses Dialog, GlassCard, Button, Badge from design system
- _hydrate pattern preserved unchanged
- Selected society shows accent ring (coral)
- All 5 modals have consistent overlay, animation, close behavior (MODL-05)
- All form inputs show consistent focus rings and error states (FORM-05)
- Zero hardcoded color values in society-selector.tsx
- Human verifies visual consistency across all migrated components
</success_criteria>

<output>
After completion, create `.planning/phases/46-forms-modals/46-04-SUMMARY.md`
</output>
