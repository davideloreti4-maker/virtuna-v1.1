---
phase: 35-results-card-structure
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/viral-results/FactorCard.tsx
  - src/components/viral-results/FactorProgressBar.tsx
  - src/components/viral-results/FactorsList.tsx
  - src/components/viral-results/index.ts
autonomous: true

must_haves:
  truths:
    - "Factor cards display in vertical stacked list layout"
    - "Progress bars fill with animation on mount"
    - "Accordion expand reveals detailed breakdown on tap"
    - "Staggered reveal animates cards sequentially"
    - "Color coding reflects factor score (green to red)"
  artifacts:
    - path: "src/components/viral-results/FactorCard.tsx"
      provides: "Single factor display with accordion expansion"
      min_lines: 60
    - path: "src/components/viral-results/FactorProgressBar.tsx"
      provides: "Animated progress bar with color coding"
      min_lines: 40
    - path: "src/components/viral-results/FactorsList.tsx"
      provides: "Staggered list wrapper with reveal animation"
      min_lines: 50
  key_links:
    - from: "src/components/viral-results/FactorCard.tsx"
      to: "src/types/viral-results.ts"
      via: "imports ViralFactor type"
      pattern: "import.*ViralFactor.*viral-results"
    - from: "src/components/viral-results/FactorsList.tsx"
      to: "src/components/viral-results/FactorCard.tsx"
      via: "maps over factors and renders FactorCard"
      pattern: "FactorCard"
---

<objective>
Build the factor breakdown components - individual factor cards with progress bars, accordion expansion, and staggered reveal animation.

Purpose: Create the detailed breakdown layer that gives users actionable insights about what makes content viral
Output: FactorCard, FactorProgressBar, and FactorsList components with animations and interactive expand/collapse
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/35-results-card-structure/35-CONTEXT.md
@src/types/viral-results.ts (types from 35-01, may not exist yet - define inline if needed)
@src/components/ui/accordion.tsx (existing Radix accordion components)
@src/components/primitives/GlassPanel.tsx (glass effect pattern)
@src/app/globals.css (design tokens, animation keyframes)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FactorProgressBar component</name>
  <files>src/components/viral-results/FactorProgressBar.tsx</files>
  <action>
Create an animated progress bar with score-based color coding:

**Props interface:**
```typescript
interface FactorProgressBarProps {
  score: number;        // 1-10 (or percentage if normalized)
  maxScore: number;     // Usually 10
  animated?: boolean;   // Enable fill animation
  delay?: number;       // Animation delay in ms (for stagger)
  size?: "sm" | "md";   // Height variant
  className?: string;
}
```

**Implementation requirements:**

1. **Visual structure:**
   - Background track: subtle gray (bg-white/10 or similar)
   - Foreground fill: colored based on score percentage
   - Rounded ends (rounded-full)
   - Heights: sm = 4px, md = 6px

2. **Color coding (green to red gradient):**
   - 8-10 (80-100%): Emerald/green (bg-emerald-400)
   - 6-7 (60-79%): Lime/yellow-green (bg-lime-400)
   - 4-5 (40-59%): Yellow/amber (bg-yellow-400)
   - 2-3 (20-39%): Orange (bg-orange-400)
   - 0-1 (0-19%): Red (bg-red-400)

3. **Fill animation:**
   - Duration: 0.8-1s
   - Easing: ease-out (from Tailwind or custom)
   - Starts from 0 width, animates to final percentage
   - Use CSS `transition` on width property
   - `delay` prop adds animation-delay for stagger effect

4. **Reduced motion:**
   - Instant fill (no animation) when `prefers-reduced-motion` is set
   - Use Tailwind `motion-safe:` and `motion-reduce:` variants

**Example styling approach:**
```tsx
<div className="relative h-1.5 w-full bg-white/10 rounded-full overflow-hidden">
  <div
    className={cn(
      "absolute left-0 top-0 h-full rounded-full",
      getColorClass(percentage),
      "motion-safe:transition-all motion-safe:duration-700 motion-safe:ease-out"
    )}
    style={{
      width: `${percentage}%`,
      transitionDelay: delay ? `${delay}ms` : undefined,
    }}
  />
</div>
```
  </action>
  <verify>TypeScript compiles: `npx tsc --noEmit`</verify>
  <done>FactorProgressBar renders with animated fill and score-based color coding</done>
</task>

<task type="auto">
  <name>Task 2: Create FactorCard component with accordion</name>
  <files>src/components/viral-results/FactorCard.tsx</files>
  <action>
Create the individual factor card with expandable details:

**Props interface:**
```typescript
interface FactorCardProps {
  factor: ViralFactor;
  index: number;          // For stagger delay calculation
  selectable?: boolean;   // Show checkbox for remix selection
  selected?: boolean;     // Checkbox state
  onSelectChange?: (id: string, selected: boolean) => void;
  className?: string;
}
```

**Implementation requirements:**

1. **Card structure (collapsed state):**
   - Glass panel background using GlassPanel primitive OR glass-base class
   - Left side: Factor name + brief score indicator
   - Right side: Numerical score (e.g., "8/10")
   - Progress bar below the header row
   - Subtle chevron/caret indicating expandability

2. **Expanded state (accordion):**
   - Use Radix Accordion components (AccordionItem, AccordionTrigger, AccordionContent)
   - Shows `factor.details` text
   - Shows `factor.tips` as bullet list if present
   - Smooth height animation (already in accordion.tsx)

3. **Checkbox for remix selection:**
   - When `selectable={true}`, show checkbox at left of card
   - Styled to match dark theme (custom checkbox or Radix Checkbox)
   - Does NOT interfere with accordion expand/collapse
   - Clicking checkbox: only toggles selection
   - Clicking card area: expands/collapses accordion

4. **Stagger animation:**
   - Use `index` prop to calculate delay
   - Each card fades/slides in after previous
   - Base delay: 100ms between cards
   - Use Tailwind `animate-` classes or inline style with animation-delay
   - Initial state: `opacity-0 translate-y-4`
   - Final state: `opacity-100 translate-y-0`

5. **Styling:**
   - Medium glass intensity (opacity 0.5-0.7)
   - Border glow subtle (ring-1 ring-white/10)
   - Rounded corners (rounded-xl)
   - Padding: p-4
   - Hover state: slight brightness increase

**Score display:**
- Score prominently visible: "8/10" or "80%"
- Color matches progress bar color (score-based)
- Font: medium weight, slightly larger than description
  </action>
  <verify>TypeScript compiles and component renders in isolation</verify>
  <done>
FactorCard displays:
- Factor name, score, and progress bar
- Expands on click to show details and tips
- Optional checkbox for remix selection
- Stagger animation based on index
  </done>
</task>

<task type="auto">
  <name>Task 3: Create FactorsList wrapper and update exports</name>
  <files>src/components/viral-results/FactorsList.tsx, src/components/viral-results/index.ts</files>
  <action>
1. **Create FactorsList component:**

```typescript
interface FactorsListProps {
  factors: ViralFactor[];
  selectable?: boolean;
  selectedIds?: Set<string>;
  onSelectionChange?: (selectedIds: Set<string>) => void;
  className?: string;
}
```

**Implementation:**
- Wraps factors in Radix AccordionRoot (type="single" collapsible)
- Maps over factors, renders FactorCard for each
- Passes index for stagger calculation
- Manages selection state if `selectable={true}`
- Handles accordion state (which item is open)

**Selection handling:**
```tsx
const handleSelectChange = (factorId: string, selected: boolean) => {
  const newSelection = new Set(selectedIds);
  if (selected) {
    newSelection.add(factorId);
  } else {
    newSelection.delete(factorId);
  }
  onSelectionChange?.(newSelection);
};
```

**Layout:**
- Vertical stack (flex flex-col gap-3)
- Full width cards
- No horizontal scroll

2. **Update barrel export:**
```typescript
// src/components/viral-results/index.ts
export { ViralScoreRing } from './ViralScoreRing';
export { FactorCard } from './FactorCard';
export { FactorProgressBar } from './FactorProgressBar';
export { FactorsList } from './FactorsList';

// Re-export types if useful
export type { ViralScoreRingProps } from './ViralScoreRing';
export type { FactorCardProps } from './FactorCard';
export type { FactorsListProps } from './FactorsList';
```

3. **Add to test page (update existing or create section):**
Add a section to the viral-score-test page showing FactorsList with mock data:

```typescript
const mockFactors: ViralFactor[] = [
  {
    id: "hook",
    name: "Hook Strength",
    score: 8,
    maxScore: 10,
    description: "First 3 seconds grab attention effectively",
    details: "Your opening uses pattern interrupt and curiosity gap techniques. The hook creates immediate intrigue without revealing the payoff.",
    tips: ["Consider adding a visual hook alongside verbal", "Test shorter variations (1-2 second hooks)"],
  },
  {
    id: "emotion",
    name: "Emotional Triggers",
    score: 6,
    maxScore: 10,
    description: "Content evokes moderate emotional response",
    details: "The content touches on aspiration and curiosity but lacks strong emotional peaks. Consider adding moments of surprise or relatability.",
    tips: ["Add a relatable struggle moment", "Include an unexpected twist"],
  },
  // ... more factors
];
```
  </action>
  <verify>
Build passes: `npm run build`
Test page shows FactorsList with expandable cards
Clicking card expands accordion
Progress bars animate on load
  </verify>
  <done>
FactorsList component:
- Renders vertical list of FactorCards
- Accordion expand/collapse works
- Selection checkboxes functional when enabled
- Staggered reveal animation on mount
Barrel export updated with all new components
  </done>
</task>

</tasks>

<verification>
1. `npm run build` completes without errors
2. FactorProgressBar animates fill with correct colors based on score
3. FactorCard expands/collapses on click with smooth animation
4. FactorsList renders multiple cards with staggered reveal
5. Selection checkboxes work independently of accordion
6. Test page at /viral-score-test shows factor components
7. Reduced motion respected (instant states, no animation)
</verification>

<success_criteria>
- Factor cards display in vertical stacked layout
- Progress bars fill with animation, color-coded by score
- Accordion expansion shows detailed breakdown
- Tips render as bullet list in expanded state
- Stagger animation delays each card's entrance
- Selection checkboxes toggle without expanding card
- All components type-safe and exported
</success_criteria>

<output>
After completion, create `.planning/phases/35-results-card-structure/35-02-SUMMARY.md`
</output>
