---
phase: 09-settings-modals
plan: 05
type: execute
wave: 3
depends_on: ["09-02", "09-03", "09-04"]
files_modified:
  - src/components/app/settings/index.ts
  - src/components/app/settings/settings-page.tsx
  - src/components/app/sidebar.tsx
  - src/components/app/index.ts
  - src/app/(app)/settings/page.tsx
autonomous: false

must_haves:
  truths:
    - "User can access settings from sidebar"
    - "All settings sections render in tabs"
    - "Leave Feedback modal opens from sidebar"
    - "Product Guide link opens external docs"
    - "Manage plan navigates to settings billing tab"
  artifacts:
    - path: "src/app/(app)/settings/page.tsx"
      provides: "Settings route page"
      exports: ["default"]
    - path: "src/components/app/settings/index.ts"
      provides: "Settings barrel export"
      exports: ["SettingsPage", "ProfileSection", "AccountSection", "NotificationsSection", "BillingSection", "TeamSection"]
  key_links:
    - from: "src/components/app/sidebar.tsx"
      to: "src/components/app/leave-feedback-modal.tsx"
      via: "Modal sibling pattern"
      pattern: "LeaveFeedbackModal"
    - from: "src/app/(app)/settings/page.tsx"
      to: "src/components/app/settings/settings-page.tsx"
      via: "Component import"
      pattern: "import.*SettingsPage"
---

<objective>
Integrate all settings components, create the settings route, and wire up sidebar actions.

Purpose: Connect all settings functionality into a working flow accessible from the app.
Output: Complete settings experience with all tabs, modals, and sidebar integration.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/09-settings-modals/09-RESEARCH.md

# Sidebar to update
@src/components/app/sidebar.tsx

# Settings components to integrate
# (created in prior plans)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Settings Barrel Export and Update SettingsPage</name>
  <files>
src/components/app/settings/index.ts
src/components/app/settings/settings-page.tsx
  </files>
  <action>
Create the barrel export for settings components and update SettingsPage to include all sections:

**1. Create barrel export:**

```typescript
// src/components/app/settings/index.ts
export { SettingsPage } from "./settings-page";
export { ProfileSection } from "./profile-section";
export { AccountSection } from "./account-section";
export { NotificationsSection } from "./notifications-section";
export { BillingSection } from "./billing-section";
export { TeamSection } from "./team-section";
```

**2. Update SettingsPage to import all sections:**

Update the imports in settings-page.tsx to include all sections (replacing the placeholder divs):

```typescript
// Add these imports
import { NotificationsSection } from "./notifications-section";
import { BillingSection } from "./billing-section";
import { TeamSection } from "./team-section";

// Update the Tabs.Content components:
<Tabs.Content value="notifications" className="outline-none">
  <NotificationsSection />
</Tabs.Content>
<Tabs.Content value="billing" className="outline-none">
  <BillingSection />
</Tabs.Content>
<Tabs.Content value="team" className="outline-none">
  <TeamSection />
</Tabs.Content>
```

Also add URL param support for defaultTab:

```typescript
// Add this to allow deep-linking to specific tab
interface SettingsPageProps {
  defaultTab?: "profile" | "account" | "notifications" | "billing" | "team";
}
```
  </action>
  <verify>All sections import correctly, TypeScript compiles without errors</verify>
  <done>Settings barrel export created, SettingsPage includes all 5 sections</done>
</task>

<task type="auto">
  <name>Task 2: Create Settings Route Page</name>
  <files>src/app/(app)/settings/page.tsx</files>
  <action>
Create the settings route page:

```typescript
// src/app/(app)/settings/page.tsx
import { SettingsPage } from "@/components/app/settings";

export const metadata = {
  title: "Settings | Virtuna",
  description: "Manage your account settings and preferences",
};

interface PageProps {
  searchParams: { tab?: string };
}

export default function Settings({ searchParams }: PageProps) {
  const validTabs = ["profile", "account", "notifications", "billing", "team"];
  const defaultTab = validTabs.includes(searchParams.tab || "")
    ? (searchParams.tab as "profile" | "account" | "notifications" | "billing" | "team")
    : "profile";

  return <SettingsPage defaultTab={defaultTab} />;
}
```

This allows deep-linking like `/settings?tab=billing` to open specific tabs.
  </action>
  <verify>Navigate to /settings - page renders with settings tabs</verify>
  <done>Settings route page created at /settings with tab query param support</done>
</task>

<task type="auto">
  <name>Task 3: Wire Up Sidebar Actions</name>
  <files>
src/components/app/sidebar.tsx
src/components/app/index.ts
  </files>
  <action>
Update the sidebar to:
1. Add Leave Feedback modal (sibling pattern)
2. Wire up Manage Plan to navigate to settings/billing
3. Wire up Product Guide to open external docs
4. Add Settings nav item (before Manage Plan)

**Update sidebar.tsx:**

```typescript
"use client";

import { useState, useMemo } from "react";
import { useRouter } from "next/navigation";
// ... existing imports ...
import { Settings } from "lucide-react"; // Add this import
import { LeaveFeedbackModal } from "./leave-feedback-modal";

// ... rest of existing code ...

export function Sidebar({ mobileOpen, onMobileOpenChange, className }: SidebarProps) {
  const router = useRouter();
  const [feedbackOpen, setFeedbackOpen] = useState(false);

  // ... existing store/state code ...

  const handleSettings = () => {
    router.push("/settings");
    onMobileOpenChange?.(false); // Close mobile drawer
  };

  const handleManagePlan = () => {
    router.push("/settings?tab=billing");
    onMobileOpenChange?.(false);
  };

  const handleFeedback = () => {
    setFeedbackOpen(true);
  };

  const handleProductGuide = () => {
    window.open("https://docs.societies.io", "_blank");
  };

  // ... existing render code ...

  return (
    <>
      {/* Mobile overlay */}
      {/* ... existing overlay code ... */}

      <aside /* ... existing aside code ... */>
        {/* ... existing content until bottom nav ... */}

        {/* Separator line */}
        <div className="border-t border-zinc-800" />

        {/* Bottom nav items */}
        <nav className="mt-2">
          <SidebarNavItem
            label="Settings"
            icon={Settings}
            onClick={handleSettings}
          />
          <SidebarNavItem
            label="Manage plan"
            icon={CreditCard}
            onClick={handleManagePlan}
          />
          <SidebarNavItem
            label="Leave Feedback"
            icon={MessageSquare}
            onClick={handleFeedback}
          />
          <SidebarNavItem
            label="Product Guide"
            icon={BookOpen}
            onClick={handleProductGuide}
          />
          <SidebarNavItem
            label="Log Out"
            icon={LogOut}
            onClick={handleLogout}
          />
        </nav>

        {/* Version text */}
        <p className="mt-2 text-center text-xs text-zinc-600">Version 2.1</p>
      </aside>

      {/* Leave Feedback Modal - sibling pattern */}
      <LeaveFeedbackModal open={feedbackOpen} onOpenChange={setFeedbackOpen} />
    </>
  );
}
```

**Update src/components/app/index.ts to export new components:**

Add the following exports:

```typescript
export { LeaveFeedbackModal } from "./leave-feedback-modal";
export { SettingsPage } from "./settings";
```
  </action>
  <verify>
1. Settings nav item navigates to /settings
2. Manage plan navigates to /settings?tab=billing
3. Leave Feedback opens modal
4. Product Guide opens new tab
  </verify>
  <done>Sidebar wired up with all settings actions and feedback modal as sibling</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete settings and modals functionality:
- Settings page with 5 tabs (Profile, Account, Notifications, Billing, Team)
- Profile editing with avatar and form fields
- Account settings with password change and delete account
- Notification preferences with toggle switches
- Billing info with Stripe portal link
- Team management with invite and role controls
- Leave Feedback modal with pre-filled user info
- Product Guide opens external docs
- Manage Plan navigates to billing tab
  </what-built>
  <how-to-verify>
1. Start dev server: `npm run dev`
2. Navigate to http://localhost:3000/dashboard
3. Verify sidebar has new "Settings" link at bottom
4. Click "Settings" - should navigate to /settings
5. Test all 5 tabs render correctly:
   - Profile: avatar, name, email, company, role fields
   - Account: email change, password change, delete account danger zone
   - Notifications: 4 toggle switches that persist
   - Billing: plan info, credits bar, manage subscription button (opens new tab)
   - Team: member list with roles, invite form
6. Click "Manage plan" in sidebar - should go to /settings?tab=billing
7. Click "Leave Feedback" - modal should open with pre-filled name/email
8. Submit feedback - should show success and close
9. Click "Product Guide" - should open new tab
10. Test on mobile: drawer closes after navigation

Expected: All settings functionality works, forms persist to localStorage, modals match societies.io styling
  </how-to-verify>
  <resume-signal>Type "approved" or describe any issues found</resume-signal>
</task>

</tasks>

<verification>
1. Run `npx tsc --noEmit` - no TypeScript errors
2. Navigate to /settings - all tabs render
3. Sidebar actions work correctly
4. Leave Feedback modal opens and submits
5. Settings persist to localStorage across page reload
</verification>

<success_criteria>
- Settings route exists at /settings
- All 5 tabs render their sections
- Settings link added to sidebar
- Manage plan deep-links to billing tab
- Leave Feedback modal wired up (sibling pattern)
- Product Guide opens external docs
- Mobile drawer closes after navigation
- User verifies complete settings flow
</success_criteria>

<output>
After completion, create `.planning/phases/09-settings-modals/09-05-SUMMARY.md`
</output>
