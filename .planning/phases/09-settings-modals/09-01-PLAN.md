---
phase: 09-settings-modals
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/stores/settings-store.ts
  - src/types/settings.ts
autonomous: true

must_haves:
  truths:
    - "Radix Tabs, Switch, Avatar packages are installed"
    - "Settings store exists with notification preferences"
    - "Settings types are defined for profile, notifications, team"
  artifacts:
    - path: "src/stores/settings-store.ts"
      provides: "Settings state management with localStorage persistence"
      exports: ["useSettingsStore"]
    - path: "src/types/settings.ts"
      provides: "Type definitions for settings data"
      exports: ["UserProfile", "NotificationPrefs", "TeamMember"]
  key_links:
    - from: "src/stores/settings-store.ts"
      to: "localStorage"
      via: "manual save/load with _hydrate pattern"
      pattern: "localStorage\\.(get|set)Item"
---

<objective>
Install required Radix UI packages and create the settings store foundation with types.

Purpose: Establish the data layer and dependencies needed for settings UI components.
Output: Working settings store with SSR-safe persistence, type definitions for all settings data.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-settings-modals/09-RESEARCH.md

# Reference for store pattern
@src/stores/society-store.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install Radix UI Dependencies</name>
  <files>package.json</files>
  <action>
Install the required Radix UI packages for settings UI:

```bash
npm install @radix-ui/react-tabs @radix-ui/react-switch @radix-ui/react-avatar
```

These packages provide:
- Tabs: Settings page navigation between sections
- Switch: Toggle switches for notification preferences
- Avatar: User avatar display with fallback support

All packages follow established Radix pattern in the project.
  </action>
  <verify>Run `npm list @radix-ui/react-tabs @radix-ui/react-switch @radix-ui/react-avatar` shows all three packages installed</verify>
  <done>All three Radix packages installed and visible in package.json dependencies</done>
</task>

<task type="auto">
  <name>Task 2: Create Settings Types</name>
  <files>src/types/settings.ts</files>
  <action>
Create type definitions for settings data:

```typescript
// src/types/settings.ts

export interface UserProfile {
  name: string;
  email: string;
  avatar?: string; // URL or null for initials fallback
  company?: string;
  role?: string;
}

export interface NotificationPrefs {
  emailUpdates: boolean;      // Product updates and news
  testResults: boolean;       // Notifications when tests complete
  weeklyDigest: boolean;      // Weekly summary email
  marketingEmails: boolean;   // Promotional content
}

export interface TeamMember {
  id: string;
  name: string;
  email: string;
  role: "owner" | "admin" | "member";
  avatar?: string;
  joinedAt: string; // ISO date string
}

export interface BillingInfo {
  plan: "free" | "pro" | "enterprise";
  pricePerMonth: number;
  creditsRemaining: number;
  creditsTotal: number;
  renewalDate: string; // ISO date string
}
```

Types cover all settings sections: profile, notifications, team, billing.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>Settings types exported and available for import throughout the app</done>
</task>

<task type="auto">
  <name>Task 3: Create Settings Store</name>
  <files>src/stores/settings-store.ts</files>
  <action>
Create Zustand store following the established manual localStorage pattern (NOT persist middleware - causes SSR issues per Phase 5 decision):

```typescript
// src/stores/settings-store.ts
import { create } from "zustand";
import type { UserProfile, NotificationPrefs, TeamMember, BillingInfo } from "@/types/settings";

const STORAGE_KEY = "virtuna-settings";

// Mock data for initial state
const DEFAULT_PROFILE: UserProfile = {
  name: "Davide Loreti",
  email: "davide.loreti4@gmail.com",
  company: "Virtuna",
  role: "Founder",
};

const DEFAULT_NOTIFICATIONS: NotificationPrefs = {
  emailUpdates: true,
  testResults: true,
  weeklyDigest: false,
  marketingEmails: false,
};

const DEFAULT_TEAM: TeamMember[] = [
  {
    id: "1",
    name: "Davide Loreti",
    email: "davide.loreti4@gmail.com",
    role: "owner",
    joinedAt: "2024-01-15",
  },
];

const DEFAULT_BILLING: BillingInfo = {
  plan: "pro",
  pricePerMonth: 55,
  creditsRemaining: 847,
  creditsTotal: 1000,
  renewalDate: "2026-02-15",
};

interface SettingsState {
  // Data
  profile: UserProfile;
  notifications: NotificationPrefs;
  team: TeamMember[];
  billing: BillingInfo;

  // Hydration
  _isHydrated: boolean;
  _hydrate: () => void;

  // Actions
  updateProfile: (updates: Partial<UserProfile>) => void;
  updateNotifications: (updates: Partial<NotificationPrefs>) => void;
  addTeamMember: (member: Omit<TeamMember, "id" | "joinedAt">) => void;
  removeTeamMember: (id: string) => void;
  updateTeamMemberRole: (id: string, role: TeamMember["role"]) => void;
}

function loadFromStorage(): Partial<SettingsState> | null {
  if (typeof window === "undefined") return null;
  try {
    const stored = localStorage.getItem(STORAGE_KEY);
    return stored ? JSON.parse(stored) : null;
  } catch {
    return null;
  }
}

function saveToStorage(state: Pick<SettingsState, "profile" | "notifications" | "team">) {
  if (typeof window === "undefined") return;
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
  } catch {
    // Ignore storage errors
  }
}

export const useSettingsStore = create<SettingsState>((set, get) => ({
  profile: DEFAULT_PROFILE,
  notifications: DEFAULT_NOTIFICATIONS,
  team: DEFAULT_TEAM,
  billing: DEFAULT_BILLING, // Billing not persisted - comes from backend in real app

  _isHydrated: false,

  _hydrate: () => {
    const stored = loadFromStorage();
    if (stored) {
      set({
        profile: stored.profile || DEFAULT_PROFILE,
        notifications: stored.notifications || DEFAULT_NOTIFICATIONS,
        team: stored.team || DEFAULT_TEAM,
        _isHydrated: true,
      });
    } else {
      set({ _isHydrated: true });
    }
  },

  updateProfile: (updates) => {
    set((state) => {
      const newProfile = { ...state.profile, ...updates };
      saveToStorage({ profile: newProfile, notifications: state.notifications, team: state.team });
      return { profile: newProfile };
    });
  },

  updateNotifications: (updates) => {
    set((state) => {
      const newNotifications = { ...state.notifications, ...updates };
      saveToStorage({ profile: state.profile, notifications: newNotifications, team: state.team });
      return { notifications: newNotifications };
    });
  },

  addTeamMember: (member) => {
    set((state) => {
      const newMember: TeamMember = {
        ...member,
        id: crypto.randomUUID(),
        joinedAt: new Date().toISOString().split("T")[0],
      };
      const newTeam = [...state.team, newMember];
      saveToStorage({ profile: state.profile, notifications: state.notifications, team: newTeam });
      return { team: newTeam };
    });
  },

  removeTeamMember: (id) => {
    set((state) => {
      const newTeam = state.team.filter((m) => m.id !== id);
      saveToStorage({ profile: state.profile, notifications: state.notifications, team: newTeam });
      return { team: newTeam };
    });
  },

  updateTeamMemberRole: (id, role) => {
    set((state) => {
      const newTeam = state.team.map((m) => (m.id === id ? { ...m, role } : m));
      saveToStorage({ profile: state.profile, notifications: state.notifications, team: newTeam });
      return { team: newTeam };
    });
  },
}));
```

Key patterns:
- Manual localStorage (not persist middleware)
- _isHydrated flag for SSR safety
- _hydrate() called in useEffect after mount
- Billing info not persisted (would come from Stripe in real app)
  </action>
  <verify>
1. TypeScript compiles: `npx tsc --noEmit`
2. Store can be imported: create test file that imports useSettingsStore
  </verify>
  <done>Settings store with full CRUD for profile, notifications, and team, using SSR-safe localStorage pattern</done>
</task>

</tasks>

<verification>
1. Run `npm list @radix-ui/react-tabs @radix-ui/react-switch @radix-ui/react-avatar` - all installed
2. Run `npx tsc --noEmit` - no TypeScript errors
3. Verify settings store exports match expected interface
</verification>

<success_criteria>
- All three Radix packages installed
- Types defined for UserProfile, NotificationPrefs, TeamMember, BillingInfo
- Settings store with _hydrate pattern, CRUD actions for profile/notifications/team
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/09-settings-modals/09-01-SUMMARY.md`
</output>
