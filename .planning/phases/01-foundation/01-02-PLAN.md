---
phase: 01-foundation
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - src/components/app/sidebar.tsx
  - src/components/app/sidebar-nav-item.tsx
  - src/components/app/mobile-nav.tsx
  - src/app/(app)/trending/page.tsx
  - src/app/(app)/trending/trending-client.tsx
  - src/app/not-found.tsx
  - src/app/(app)/layout.tsx
autonomous: true

must_haves:
  truths:
    - "Sidebar shows Dashboard, TikTok account selector, Content Intelligence, Earnings in top section (in that order)"
    - "Sidebar shows Pricing in bottom section"
    - "Sidebar sign-out action exists in avatar dropdown and calls real Supabase signOut"
    - "/trending returns a 404 page (route files deleted)"
    - "No trending-related nav links exist in sidebar"
    - "404 page matches Raycast design language (dark, minimal)"
    - "Mobile hamburger menu opens sidebar as overlay (no bottom tab bar)"
    - "All sidebar links navigate to real routes with no dead links"
  artifacts:
    - path: "src/components/app/sidebar.tsx"
      provides: "Restructured sidebar with MVP navigation"
      contains: "Dashboard.*Content Intelligence.*Earnings"
    - path: "src/app/not-found.tsx"
      provides: "Global 404 page in Raycast design language"
      min_lines: 20
  key_links:
    - from: "src/components/app/sidebar.tsx"
      to: "supabase.auth.signOut()"
      via: "Sign-out action in avatar menu"
      pattern: "signOut"
    - from: "src/components/app/sidebar.tsx"
      to: "/dashboard, /brand-deals, /pricing"
      via: "Navigation links"
      pattern: "router\\.push|href="
---

<objective>
Remove the trending page route, restructure the sidebar navigation for MVP scope (Dashboard, Content Intelligence, Earnings top; Pricing bottom; TikTok account selector; sign-out in avatar menu), create a global 404 page, and clean up mobile navigation.

Purpose: The app currently shows development-era navigation (Trending Feed, Manage Plan, Leave Feedback, Product Guide, Log Out). This plan transforms it into a product-ready navigation that only shows MVP features and removes access to pages that don't exist in MVP scope.

Output: Clean sidebar with MVP-only pages, trending route deleted, proper 404 page, functional sign-out.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-CONTEXT.md
@.planning/phases/01-foundation/01-01-SUMMARY.md

@src/components/app/sidebar.tsx
@src/components/app/sidebar-nav-item.tsx
@src/components/app/sidebar-toggle.tsx
@src/components/app/mobile-nav.tsx
@src/components/app/app-shell.tsx
@src/app/(app)/trending/page.tsx
@src/app/(app)/trending/trending-client.tsx
@src/app/(app)/layout.tsx
@src/app/(marketing)/layout.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Restructure sidebar navigation for MVP scope + add sign-out</name>
  <files>
    src/components/app/sidebar.tsx
    src/components/app/sidebar-nav-item.tsx
  </files>
  <action>
    **Restructure sidebar nav items (src/components/app/sidebar.tsx):**

    Replace the current `navItems` array:
    ```
    FROM: Content Intelligence, Trending Feed, Brand Deals
    TO:   Dashboard, Content Intelligence, Earnings
    ```

    New top nav items (in exact order per locked decision):
    1. **Dashboard** -- icon: House (from @phosphor-icons/react), route: `/dashboard`, active when `pathname === '/dashboard'`
    2. **TikTok Account Selector** -- NOT a nav item, it's a display element between Dashboard and Content Intelligence. Show a small component with a placeholder avatar (gray circle) + "@handle" text (use "Connect TikTok" as placeholder since onboarding hasn't been built yet). Style: subtle bg-white/[0.04] rounded-lg px-3 py-2, flex items-center gap-2. This is a visual placeholder that will be wired to real TikTok data in Phase 3 (Onboarding).
    3. **Content Intelligence** -- icon: Lightbulb (keep existing), route: `/dashboard` (same page, this is the main analysis tool), active when `pathname === '/dashboard'` and it's the default active item
    4. **Earnings** -- icon: Briefcase (keep existing, rename from "Brand Deals"), route: `/brand-deals`, active when `pathname.startsWith('/brand-deals')`

    Replace the current `bottomNavItems` array:
    ```
    FROM: Manage Plan, Leave Feedback, Product Guide, Log Out
    TO:   Pricing
    ```

    New bottom nav:
    1. **Pricing** -- icon: CreditCard (from @phosphor-icons/react), route: `/coming-soon` (temporary until Phase 2 pricing page built), active when `pathname === '/pricing'`

    **Sign-out action:**
    Add a user avatar section at the very bottom of the sidebar (below Pricing, separated by a divider). Show a small avatar circle (placeholder, gray bg with user icon) with a dropdown menu on click. The dropdown has one item: "Sign out". On click:
    ```typescript
    import { createClient } from '@/lib/supabase/client';
    const supabase = createClient();
    await supabase.auth.signOut();
    router.push('/');  // Landing page per discretion recommendation
    ```

    **Remove from sidebar:**
    - "Create a new test" button -- not MVP (keep code in file as comment for reference)
    - TestHistoryList component -- not MVP (remove import and usage)
    - Leave Feedback modal trigger and import -- not MVP (keep modal file, remove sidebar reference)
    - "Manage Plan", "Leave Feedback", "Product Guide", "Log Out" bottom nav items

    **Keep but update:**
    - Sidebar toggle (collapse) button -- keep as-is
    - Logo -- keep as-is
    - Mobile overlay behavior -- keep as-is
    - Glass panel styling -- keep as-is

    **Update imports:** Add `House`, `CreditCard`, `User` from @phosphor-icons/react. Remove `TrendUp`, `Plus`, `SlidersHorizontal`, `ChatCircleDots`, `BookOpen`, `SignOut` if no longer used. Remove `useTestStore` import.

    **SidebarNavItem (src/components/app/sidebar-nav-item.tsx):**
    Review and update if needed. The component should support the `onClick` handler pattern (already does) and active state via `isActive` prop (already does). No changes likely needed, but verify it handles route-based navigation cleanly.
  </action>
  <verify>
    - `pnpm build` succeeds
    - Sidebar renders: Dashboard, [TikTok selector], Content Intelligence, Earnings (top)
    - Sidebar renders: Pricing (bottom)
    - Sidebar has avatar dropdown with Sign out action
    - No "Trending Feed", "Manage Plan", "Leave Feedback", "Product Guide" items remain
    - No "Create a new test" button visible
    - No `useTestStore` import in sidebar.tsx
  </verify>
  <done>
    Sidebar shows only MVP navigation items in correct order. TikTok account selector placeholder is positioned between Dashboard and Content Intelligence. Sign-out is in avatar dropdown at bottom. All old dev-era nav items removed.
  </done>
</task>

<task type="auto">
  <name>Task 2: Delete trending route files + create global 404 page</name>
  <files>
    src/app/(app)/trending/page.tsx
    src/app/(app)/trending/trending-client.tsx
    src/app/not-found.tsx
    src/app/(app)/layout.tsx
  </files>
  <action>
    **Delete trending route files (soft-hide per locked decision):**
    Delete ONLY the route files (the actual pages that make /trending accessible):
    - `src/app/(app)/trending/page.tsx` -- DELETE
    - `src/app/(app)/trending/trending-client.tsx` -- DELETE
    - `src/app/(app)/trending/` directory -- DELETE (should be empty after above)

    **Keep these files (soft-hide = keep code, remove route access):**
    - `src/components/trending/` (all 7 component files) -- KEEP
    - `src/types/trending.ts` -- KEEP
    - `src/lib/trending-mock-data.ts` -- KEEP
    - `src/hooks/use-infinite-videos.ts` -- KEEP
    - `src/stores/bookmark-store.ts` -- KEEP

    **Create 404 page (src/app/not-found.tsx):**
    Global not-found page that Next.js renders for any unmatched route. This is a ROOT-level not-found.tsx (inside `src/app/`, not inside a route group). It needs its own minimal layout since it renders outside route groups.

    Design (Raycast design language, per discretion):
    - Dark background (#07080a or bg-background)
    - Centered content (flex, items-center, justify-center, min-h-screen)
    - Large "404" text (text-6xl, font-bold, text-foreground-muted)
    - Subtitle "Page not found" (text-lg, text-foreground-secondary)
    - Brief message "The page you're looking for doesn't exist or has been moved." (text-sm, text-foreground-muted)
    - "Go home" link button (coral bg, 8px radius) linking to "/"
    - Inter font applied via className
    - Keep it simple -- no animations, no complex layout

    Note: Since this is a root-level not-found.tsx and the app uses route-group layouts (not a root layout.tsx), you need to wrap it in a minimal `<html><body>` with the Inter font and dark bg applied. Next.js requires not-found.tsx to be a valid full page when no root layout exists.

    **Update (app) layout metadata (src/app/(app)/layout.tsx):**
    Update the metadata title from "Dashboard | Artificial Societies" to "Dashboard | Virtuna". Update description to something relevant to Virtuna.
  </action>
  <verify>
    - `pnpm build` succeeds
    - `src/app/(app)/trending/` directory does not exist
    - `src/components/trending/` directory still exists (soft-hidden, not deleted)
    - `src/app/not-found.tsx` exists and exports a default function
    - Visiting /trending in browser shows 404 page (not a blank page or error)
    - 404 page has dark background, "404" heading, and "Go home" link
  </verify>
  <done>
    /trending route deleted (returns 404). All trending component code preserved (soft-hidden). Global 404 page renders in Raycast design language. App layout metadata updated for Virtuna branding.
  </done>
</task>

</tasks>

<verification>
1. `pnpm build` completes without errors
2. Sidebar shows exactly: Dashboard, TikTok selector, Content Intelligence, Earnings (top); Pricing (bottom)
3. No dead links in sidebar -- every item navigates to a real route
4. Sign-out button exists in avatar dropdown and calls supabase.auth.signOut()
5. /trending returns 404 page
6. 404 page matches Raycast design language
7. No trending-related nav items in sidebar
8. Mobile: hamburger menu opens sidebar overlay
9. `src/components/trending/` directory still exists (soft-hidden)
10. `src/app/(app)/trending/` directory deleted
</verification>

<success_criteria>
- Sidebar navigation matches MVP spec exactly (Dashboard, TikTok selector, Content Intelligence, Earnings, Pricing)
- Sign-out calls real Supabase signOut and redirects to landing page
- /trending and any other unmatched routes show proper 404 page
- All trending component code preserved for future re-enable
- No dead links, no dev-era navigation items visible
- Mobile hamburger menu works (sidebar slides in as overlay)
- `pnpm build` passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-02-SUMMARY.md`
</output>
