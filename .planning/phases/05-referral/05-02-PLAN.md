---
phase: 05-referral
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/sidebar.tsx
autonomous: true

must_haves:
  truths:
    - "Sidebar shows 'Referrals' link that navigates to /referrals"
    - "Referral dashboard page is accessible at /referrals and renders link card + stats"
    - "Application builds without TypeScript errors"
  artifacts:
    - path: "src/components/app/sidebar.tsx"
      provides: "Referrals navigation link in sidebar"
      contains: "referrals"
  key_links:
    - from: "src/components/app/sidebar.tsx"
      to: "src/app/(app)/referrals/page.tsx"
      via: "href='/referrals' navigation link"
      pattern: "/referrals"
---

<objective>
Update sidebar navigation to link to the referral dashboard and verify the full referral system builds correctly.

Purpose: The sidebar currently shows "Earnings" linking to /brand-deals. Since Phase 5 replaces the earnings concept with Virtuna's own referral program, the sidebar link needs to point to /referrals. Additionally, a full build check confirms that all referral code (middleware, callbacks, API routes, page, components) compiles and wires correctly.

Output: Updated sidebar with referrals link + confirmed clean build.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/app/sidebar.tsx
@src/app/(app)/referrals/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update sidebar nav to link to referrals dashboard</name>
  <files>src/components/app/sidebar.tsx</files>
  <action>
    In `src/components/app/sidebar.tsx`, update the `navItemsAfterSelector` array:

    Change:
    ```typescript
    { label: "Earnings", icon: Briefcase, id: "earnings", href: "/brand-deals" },
    ```

    To:
    ```typescript
    { label: "Referrals", icon: Briefcase, id: "referrals", href: "/referrals" },
    ```

    Also update the JSDoc comment at the top of the component (around line 48) to reflect "Referrals" instead of "Earnings":
    ```
    * MVP Navigation (top): Dashboard, Trending, [TikTok Account Selector], Content Intelligence, Referrals
    ```

    Keep the Briefcase icon (it fits the referral/earnings concept). Only change label, id, and href.
  </action>
  <verify>
    - `grep "Referrals" src/components/app/sidebar.tsx` returns the nav item
    - `grep "/referrals" src/components/app/sidebar.tsx` shows the href
    - No references to "/brand-deals" remain in sidebar.tsx
  </verify>
  <done>
    Sidebar navigation shows "Referrals" linking to /referrals instead of "Earnings" linking to /brand-deals.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify full application build compiles</name>
  <files></files>
  <action>
    Run `pnpm build` (or `npm run build` if pnpm unavailable) to verify the entire application compiles without errors.

    This confirms:
    - All referral imports resolve (constants, code-generator, components)
    - Middleware changes compile correctly
    - OAuth callback route compiles
    - Whop webhook route compiles with referral conversion logic
    - Referrals page server component compiles
    - Sidebar component compiles with updated nav items
    - No circular dependencies or missing exports

    If build errors appear specifically in referral-related files, fix them. If build errors appear in unrelated files (pre-existing issues), note them but don't block on them.
  </action>
  <verify>
    - `pnpm build` (or `npm run build`) exits with code 0 (or only pre-existing errors in unrelated files)
    - No TypeScript errors in files: middleware.ts, sidebar.tsx, referrals/page.tsx, referral components, referral API routes
  </verify>
  <done>
    Full Next.js build passes, confirming all referral system code is correctly wired and type-safe.
  </done>
</task>

</tasks>

<verification>
1. `grep "Referrals" src/components/app/sidebar.tsx` shows nav item
2. `grep "/referrals" src/components/app/sidebar.tsx` shows href
3. `pnpm build` succeeds (or `npm run build`)
</verification>

<success_criteria>
- Sidebar shows "Referrals" linking to /referrals
- Full application build passes without referral-related TypeScript errors
- All 6 REF requirements are covered by existing + fixed code
</success_criteria>

<output>
After completion, create `.planning/phases/05-referral/05-02-SUMMARY.md`
</output>
