---
phase: 07-upload-input-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/video-upload.tsx
  - src/components/app/tiktok-url-input.tsx
autonomous: true

must_haves:
  truths:
    - "User can drag-and-drop or click to select a video file up to 200MB"
    - "After selecting a video, user sees thumbnail, filename, file size, and duration badge"
    - "User can remove a selected video and return to the empty upload state"
    - "Upload progress displays as a thin progress bar overlay on the upload zone"
    - "User can paste a TikTok URL and see a loading state followed by preview info"
    - "Invalid TikTok URLs show inline error text below the input field"
  artifacts:
    - path: "src/components/app/video-upload.tsx"
      provides: "Video upload component with drag-drop, thumbnail preview, progress, removal"
      min_lines: 80
    - path: "src/components/app/tiktok-url-input.tsx"
      provides: "TikTok URL input with validation and preview display"
      min_lines: 50
  key_links:
    - from: "src/components/app/video-upload.tsx"
      to: "File object"
      via: "onFileSelect callback prop"
      pattern: "onFileSelect.*File"
    - from: "src/components/app/tiktok-url-input.tsx"
      to: "URL string"
      via: "onUrlChange callback prop"
      pattern: "onUrlChange.*string"
---

<objective>
Build the two standalone input components for video upload and TikTok URL input that will be composed into the content form in Plan 7-02.

Purpose: These are self-contained, reusable components — decoupled from the form so they can be built and tested independently before integration.

Output: `video-upload.tsx` and `tiktok-url-input.tsx` in `src/components/app/`
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Existing UI primitives to use
@src/components/ui/input.tsx
@src/components/ui/button.tsx
@src/components/ui/badge.tsx
@src/components/ui/spinner.tsx

# Design system reference
@CLAUDE.md (Raycast Design Language Rules section)

# Phase context with locked decisions
@.planning/phases/07-upload-input-ui/07-CONTEXT.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create VideoUpload component</name>
  <files>src/components/app/video-upload.tsx</files>
  <action>
Create a "use client" component `VideoUpload` with the following props interface:

```ts
interface VideoUploadProps {
  file: File | null;
  onFileSelect: (file: File | null) => void;
  uploadProgress?: number; // 0-100, undefined = no upload in progress
  className?: string;
}
```

**Empty state (no file selected):**
- Solid subtle zone: `bg-white/[0.03]` (NOT dashed border — per user decision)
- Rounded 12px, border `border-white/[0.06]`
- Center-aligned upload icon (lucide `Upload` or `Video`) + text "Drop your video here or click to browse"
- Subtext: "MP4, MOV, WebM up to 200MB"
- Hidden `<input type="file" accept="video/*">` triggered on click
- Drag-and-drop: `onDragOver`/`onDragLeave`/`onDrop` handlers with visual feedback (bg-white/[0.05] on drag hover)
- File size validation: reject files > 200MB with inline error below the zone
- File type validation: reject non-video MIME types

**Upload progress state (file selected + uploadProgress defined):**
- Same zone layout but with a thin (2px) progress bar overlay at the bottom of the zone
- Progress bar uses `bg-accent` (coral), width transitions smoothly with `transition-all duration-300`
- Show filename + "Uploading..." text

**Preview state (file selected, no uploadProgress):**
- Replace the upload zone contents with:
  - Video thumbnail: extract first frame using a `<video>` element + `<canvas>` drawImage on `loadeddata` event. Display as an `<img>` with rounded corners (8px), max-height 120px
  - Metadata row: filename (truncated with ellipsis if long), file size formatted (e.g. "14.2 MB"), duration badge (extracted from video element `duration` property, formatted as "0:30" or "1:15")
  - Remove button: small "X" icon button (lucide `X`) in the top-right corner of the preview area, calls `onFileSelect(null)` on click
- Use `URL.createObjectURL` for the video element source, revoke on cleanup

**Styling rules (Raycast):**
- Use Inter font (inherited), 6% borders, bg-white/[0.03] for surfaces
- Button styling: use the existing `Button` component with `variant="secondary"` for remove
- Duration badge: use existing `Badge` component
- No animations beyond the progress bar transition
  </action>
  <verify>
- Component renders without errors in both empty and preview states
- `pnpm tsc --noEmit` passes
- Dragging a file over the zone changes background
- Selecting a video > 200MB shows error, does not call onFileSelect
- Thumbnail extraction works for an MP4 file
  </verify>
  <done>
VideoUpload component exists at src/components/app/video-upload.tsx with drag-drop zone, 200MB limit validation, thumbnail+metadata preview with duration badge, file removal, and progress bar overlay. Exports `VideoUpload` and `VideoUploadProps`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create TikTokUrlInput component</name>
  <files>src/components/app/tiktok-url-input.tsx</files>
  <action>
Create a "use client" component `TikTokUrlInput` with the following props interface:

```ts
interface TikTokUrlPreview {
  thumbnail?: string;
  caption?: string;
  creator?: string;
}

interface TikTokUrlInputProps {
  url: string;
  onUrlChange: (url: string) => void;
  preview: TikTokUrlPreview | null;
  isLoading?: boolean;
  error?: string | null;
  onFetchPreview?: (url: string) => void;
  className?: string;
}
```

**URL validation regex** (per user decision on accepted formats):
```ts
const TIKTOK_URL_PATTERN = /^(https?:\/\/)?(www\.)?(tiktok\.com\/.+|vm\.tiktok\.com\/.+|@[\w.]+\/video\/\d+)$/i;
```

**Layout:**
- Use the existing `Input` component from `@/components/ui/input` with `leftIcon` set to a link icon (lucide `Link`)
- Placeholder: "Paste TikTok URL (tiktok.com/... or vm.tiktok.com/...)"
- On paste or change: validate URL against pattern. If valid, call `onFetchPreview?.(url)`. If invalid and non-empty, don't call fetch but don't show error yet (validation on submit only, per user decision).
- The `error` prop renders as inline error text (`text-sm text-error`) below the input — for server-side errors (URL unreachable, video not found).

**Preview state (preview prop not null, isLoading false):**
- Below the input, show a compact preview card:
  - Thumbnail image (if available) on the left, 48x48 rounded-[8px]
  - Creator name (if available) in `text-sm text-foreground-secondary`
  - Caption snippet (if available) truncated to 2 lines with `line-clamp-2`
  - Whole preview card: `bg-white/[0.03] rounded-xl p-3 border border-white/[0.06]` + `mt-3`

**Loading state (isLoading true):**
- Below the input, show a skeleton-like loading indicator: use the `Spinner` component from UI kit, centered, with "Fetching preview..." text in `text-sm text-foreground-muted`

**Styling:**
- Follow Raycast conventions: 6% borders, 8px input radius, Inter font
- No dashed borders, no glow effects
  </action>
  <verify>
- Component renders without errors
- `pnpm tsc --noEmit` passes
- Typing a valid tiktok.com URL triggers onFetchPreview callback
- Error text appears when error prop is set
- Preview card renders when preview prop is provided
  </verify>
  <done>
TikTokUrlInput component exists at src/components/app/tiktok-url-input.tsx with URL validation, preview display (thumbnail, caption, creator), loading state, and inline error. Exports `TikTokUrlInput`, `TikTokUrlInputProps`, and `TikTokUrlPreview`.
  </done>
</task>

</tasks>

<verification>
1. Both components exist and export their interfaces
2. `pnpm tsc --noEmit` passes with no type errors
3. No import errors — both components use only existing UI primitives and lucide-react icons
4. VideoUpload handles drag-drop, file size validation, thumbnail extraction, progress bar, and removal
5. TikTokUrlInput handles URL validation pattern, preview rendering, loading, and error states
</verification>

<success_criteria>
- VideoUpload renders empty state, progress state, and preview state correctly
- TikTokUrlInput validates TikTok URL formats and renders preview/error/loading states
- Both components follow Raycast design language (6% borders, bg-white/[0.03] surfaces, 8px/12px radius)
- Both components are "use client" with proper TypeScript interfaces exported
</success_criteria>

<output>
After completion, create `.planning/phases/07-upload-input-ui/07-01-SUMMARY.md`
</output>
