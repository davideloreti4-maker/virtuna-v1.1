---
phase: 55-glass-docs-regression
plan: 03
type: execute
wave: 2
depends_on: ["55-01"]
files_modified:
  - verification/scripts/visual-comparison.spec.ts  # may be modified to add routes
  - verification/scripts/contrast-audit.ts  # run, may fix issues found
  - src/app/globals.css  # only if regression fixes needed
  - src/components/primitives/GlassPanel.tsx  # only if regression fixes needed
  - src/components/ui/card.tsx  # only if regression fixes needed
autonomous: false

must_haves:
  truths:
    - "All 36 design system components render correctly in the showcase with no visual errors"
    - "Trending page (/trending) renders correctly with no broken layouts or missing styles"
    - "Dashboard renders correctly with no broken layouts or missing styles"
    - "7-page showcase (/showcase) renders correctly with no broken glass/card/surface styling"
    - "WCAG AA contrast compliance maintained -- muted text (#848586 on #07080a) passes 5.4:1+"
    - "User has visually verified key pages"
  artifacts:
    - path: "verification/regression-log.md"
      provides: "Complete audit log of all components and pages checked"
  key_links:
    - from: "src/app/globals.css"
      to: "all components"
      via: "CSS tokens consumed by Tailwind classes"
      pattern: "@theme"
---

<objective>
Run a full visual regression audit across all 36 design system components, 3 page routes (trending, dashboard, showcase), and WCAG AA contrast check. Log all issues, fix in batch, then verify with user.

Purpose: After Plan 01's component changes and Plan 02's doc updates, this plan ensures zero visual regressions across the entire application. This is the final quality gate for the v2.3.5 milestone.

Output: Regression audit log, all fixes applied, WCAG AA compliance verified, user visual sign-off.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/55-glass-docs-regression/55-CONTEXT.md
@.planning/phases/55-glass-docs-regression/55-01-SUMMARY.md
@src/app/globals.css
@verification/scripts/visual-comparison.spec.ts
@verification/scripts/contrast-audit.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Full regression audit -- screenshot all pages + WCAG contrast check</name>
  <files>
    verification/scripts/visual-comparison.spec.ts
    verification/scripts/contrast-audit.ts
  </files>
  <action>
    **Pre-requisite:** Start the dev server if not running (`pnpm dev` in background).

    **Step 1: Systematic page screenshot audit.**

    Visit each of these routes in the dev server and capture screenshots for comparison. Use the existing Playwright visual comparison spec or manual browser screenshots:

    1. `/showcase` -- Main showcase overview (7-page hub)
    2. `/showcase/typography` -- Typography components
    3. `/showcase/buttons-badges` -- Button and Badge variants
    4. `/showcase/inputs` -- Input and form components
    5. `/showcase/data-display` -- Cards, GlassCard, Avatar, Skeleton
    6. `/showcase/feedback` -- Spinners, Progress, Alerts
    7. `/showcase/layout-components` -- GlassPanel, Layout primitives
    8. `/showcase/overlays` -- Modals, Tooltips, Popovers
    9. `/primitives-showcase` -- Primitives demo page (updated in Plan 01)
    10. `/trending` -- Trending page
    11. `/dashboard` -- Dashboard (if accessible without auth, otherwise skip)

    For each page, log:
    - Does the page load without console errors?
    - Are all components visible and correctly styled?
    - Are there any broken layouts, missing backgrounds, or incorrect borders?
    - Do glass/card surfaces render with correct appearance (12px radius, proper borders, correct shadows)?

    **Step 2: Component-level audit.**

    On the showcase pages, verify these specific components render correctly:
    - Cards (bg-transparent, 6% border, 12px radius, 5% inset shadow)
    - GlassCard from ui/card.tsx (white/5% bg with blur, 12px radius)
    - GlassPanel (neutral glass gradient, 5px blur, 12px radius, 6% border)
    - Buttons (8px radius, correct shadow-button on primary)
    - Inputs (white/5% bg, 5% border, 8px radius, 42px height)
    - GlassPill (still renders with color tints -- these are pill-specific, not glass-panel tints)
    - TrafficLights (unchanged, should work as before)
    - All typography (Inter font, correct weights and sizes)

    **Step 3: WCAG AA contrast audit.**

    Run the contrast audit script: `npx tsx verification/scripts/contrast-audit.ts`

    If the script is not configured for the current token values, manually verify:
    - `#f5f5f5` (foreground) on `#07080a` (background) -- should be 18:1+
    - `#848586` (foreground-muted) on `#07080a` (background) -- should be 5.4:1+ (WCAG AA)
    - `#5a5b5c` (foreground-subtle) on `#07080a` -- check ratio, may be decorative only
    - `#FF7F50` (accent/coral) on `#07080a` -- verify AA compliance
    - `#f5f5f5` on `#18191a` (surface) -- verify
    - `#848586` on `#18191a` (surface) -- verify

    **Step 4: Create regression log.**

    Write findings to `verification/regression-log.md`:
    ```markdown
    # Phase 55 Regression Audit

    **Date:** [execution date]
    **Status:** [PASS / ISSUES FOUND]

    ## Page Audit

    | Page | Status | Issues |
    |------|--------|--------|
    | /showcase | PASS/FAIL | [details] |
    | ... | ... | ... |

    ## Component Audit

    | Component | Status | Issues |
    |-----------|--------|--------|
    | Card | PASS/FAIL | [details] |
    | ... | ... | ... |

    ## WCAG AA Contrast

    | Combo | Ratio | Status |
    |-------|-------|--------|
    | foreground on background | 18:1 | PASS |
    | foreground-muted on background | 5.4:1 | PASS |
    | ... | ... | ... |

    ## Issues Found

    [List of all issues with file paths and fix descriptions]

    ## Fixes Applied

    [List of fixes applied with before/after]
    ```

    **Step 5: Fix all issues found.**

    If the audit reveals issues:
    - Apply fixes in batch (all fixes at once, not one at a time)
    - Re-verify each fix
    - Update regression log with "Fixes Applied" section
    - Run `pnpm build` to confirm no regressions from fixes
  </action>
  <verify>
    - `pnpm build` succeeds
    - All showcase pages load without console errors
    - regression-log.md exists with PASS status for all components and pages (or all issues fixed)
    - WCAG AA contrast ratios documented and passing (5.4:1+ for muted text)
  </verify>
  <done>
    All 36 components and 3+ page routes audited. All issues found and fixed. WCAG AA contrast verified. regression-log.md documents the complete audit with PASS status.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 55 changes:
    1. GlassPanel refactored to zero-config Raycast glass (5px blur, 12px radius, neutral only)
    2. GradientGlow, GradientMesh, and primitives/GlassCard hard-deleted
    3. All orphaned CSS removed from globals.css
    4. BRAND-BIBLE.md rewritten as complete Virtuna Design System reference
    5. All 8 design docs updated with correct Raycast values
    6. Full regression audit completed with all issues fixed
  </what-built>
  <how-to-verify>
    1. Open http://localhost:3000/showcase and verify all 7 sub-pages render correctly
    2. Open http://localhost:3000/primitives-showcase and verify:
       - No GradientGlow sections visible
       - GlassPanel renders with subtle 5px blur, 12px radius, neutral glass
       - TrafficLights section unchanged
    3. Open http://localhost:3000/trending and verify page renders correctly
    4. Open http://localhost:3000/showcase/data-display and verify:
       - Cards have transparent bg with correct borders
       - GlassCard (from ui/card.tsx) renders with frosted glass effect
    5. Open http://localhost:3000/showcase/layout-components and verify:
       - GlassPanel demos show simplified zero-config usage
    6. Spot-check BRAND-BIBLE.md at repo root -- should say "Virtuna Design System", reference Inter font, show correct token values
    7. Verify no console errors on any page
  </how-to-verify>
  <resume-signal>Type "approved" if all pages look correct, or describe any visual issues</resume-signal>
</task>

</tasks>

<verification>
1. `pnpm build` -- clean build
2. All showcase pages load without errors
3. `verification/regression-log.md` exists with complete audit
4. WCAG AA contrast ratios documented and passing
5. User has approved visual state
</verification>

<success_criteria>
- Zero visual regressions across all 36 components
- Zero broken pages (trending, dashboard, showcase, primitives-showcase)
- WCAG AA contrast compliance maintained (5.4:1+ for muted text on dark bg)
- User has visually verified and approved the final state
- Regression log documents the complete audit
</success_criteria>

<output>
After completion, create `.planning/phases/55-glass-docs-regression/55-03-SUMMARY.md`
</output>
