---
phase: 07-wire-tiergate
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/simulation/results-panel.tsx
autonomous: true

must_haves:
  truths:
    - "Starter/free users see ImpactScore and AttentionBreakdown but Variants, Insights, and Themes sections are replaced with an upgrade banner"
    - "Pro users see all five result sections (ImpactScore, AttentionBreakdown, Variants, Insights, Themes) without obstruction"
    - "The upgrade banner within results panel opens inline CheckoutModal for in-context upgrade"
  artifacts:
    - path: "src/components/app/simulation/results-panel.tsx"
      provides: "Results panel with TierGate wrapping advanced sections"
      contains: "TierGate"
  key_links:
    - from: "src/components/app/simulation/results-panel.tsx"
      to: "src/components/tier-gate.tsx"
      via: "TierGate import and usage"
      pattern: "TierGate.*requiredTier.*pro"
---

<objective>
Gate advanced simulation result sections (Variants, Insights, Themes) behind Pro tier using client-side TierGate.

Purpose: The pricing table marks "Audience insights" as Pro-only. The simulation results panel has 5 sections -- the first 2 (ImpactScore, AttentionBreakdown) show "what" and remain free as product hooks. The last 3 (VariantsSection, InsightsSection, ThemesSection) show "why" and "how to improve" and are gated for Pro. This creates clear feature differentiation and upgrade motivation.

Output: Results panel with TierGate wrapping the three advanced sections.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@src/components/app/simulation/results-panel.tsx
@src/components/tier-gate.tsx
@src/hooks/use-subscription.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wrap advanced simulation result sections in TierGate</name>
  <files>src/components/app/simulation/results-panel.tsx</files>
  <action>
Modify `src/components/app/simulation/results-panel.tsx` to gate the three advanced sections behind TierGate.

**Step 1: Add TierGate import**

Add at the top of the file with the other imports:
```tsx
import { TierGate } from "@/components/tier-gate";
```

**Step 2: Wrap VariantsSection + InsightsSection + ThemesSection in TierGate**

In the `{/* Content */}` div, replace the three section blocks:

Before:
```tsx
{/* Variants */}
<VariantsSection variants={result.variants} />

{/* Insights */}
<InsightsSection insights={result.insights} />

{/* Conversation Themes */}
<ThemesSection themes={result.conversationThemes} />
```

After:
```tsx
{/* Pro-only: Variants, Insights, Themes */}
<TierGate requiredTier="pro">
  <VariantsSection variants={result.variants} />
  <InsightsSection insights={result.insights} />
  <ThemesSection themes={result.conversationThemes} />
</TierGate>
```

Keep ImpactScore and AttentionBreakdown OUTSIDE the TierGate -- they remain visible to all tiers.

**What NOT to do:**
- Do NOT add a second useSubscription call. TierGate calls it internally.
- Do NOT add a custom fallback. The default TierGate fallback (UpgradeBanner + CheckoutModal) is correct here -- it provides inline checkout for conversion.
- Do NOT gate ImpactScore or AttentionBreakdown. These are the free hook that makes users want Pro.
- Do NOT change the "use client" directive or component props. ResultsPanel is already a client component.
  </action>
  <verify>
Run `pnpm build` from the project root. It must complete with exit code 0 and no TypeScript errors. Specifically verify:
- TierGate import resolves correctly
- No duplicate hook warnings
- ResultsPanel still exports correctly
  </verify>
  <done>
- ImpactScore and AttentionBreakdown render for all users (free, starter, pro)
- VariantsSection, InsightsSection, and ThemesSection are wrapped in `<TierGate requiredTier="pro">`
- Starter/free users see the default UpgradeBanner with inline CheckoutModal instead of the three advanced sections
- Pro users see all five sections without obstruction
- Build passes with no errors
  </done>
</task>

</tasks>

<verification>
1. `pnpm build` passes with zero errors
2. Grep for TierGate in results panel: `grep -n "TierGate" src/components/app/simulation/results-panel.tsx` returns matches
3. ImpactScore and AttentionBreakdown are NOT inside TierGate: verify by reading the file and confirming they appear before the TierGate block
4. All three advanced sections (Variants, Insights, Themes) are inside TierGate
</verification>

<success_criteria>
- Results panel gates Variants + Insights + Themes behind Pro tier
- ImpactScore + AttentionBreakdown remain visible to all users
- Default UpgradeBanner with inline CheckoutModal shows for non-Pro users
- Build passes cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/07-wire-tiergate/07-02-SUMMARY.md`
</output>
