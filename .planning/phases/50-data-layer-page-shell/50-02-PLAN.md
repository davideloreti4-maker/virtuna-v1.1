---
phase: 50-data-layer-page-shell
plan: 02
type: execute
wave: 2
depends_on: ["50-01"]
files_modified:
  - src/app/(app)/trending/page.tsx
  - src/app/(app)/trending/trending-client.tsx
  - src/components/app/sidebar.tsx
autonomous: false

must_haves:
  truths:
    - "User can navigate to /trending via sidebar nav item and sees a 'Trending' heading"
    - "Three category tabs render with coral accent on the active tab"
    - "Switching tabs filters content client-side without page reload"
    - "Active tab syncs with URL search params (/trending?tab=breaking-out)"
    - "Browser back/forward updates the active tab"
    - "Stats bar shows category counts and aggregate metrics"
    - "Brief skeleton flash appears when switching tabs"
    - "Empty tab state shows illustrated message when a category has no videos"
  artifacts:
    - path: "src/app/(app)/trending/page.tsx"
      provides: "Server component: metadata, searchParams validation, Suspense boundary"
      exports: ["default", "metadata"]
      min_lines: 20
    - path: "src/app/(app)/trending/trending-client.tsx"
      provides: "Client component: tabs, URL sync, stats bar, skeleton states, empty states"
      exports: ["TrendingClient"]
      min_lines: 100
    - path: "src/components/app/sidebar.tsx"
      provides: "Trending nav item in sidebar"
      contains: "TrendingUp"
  key_links:
    - from: "src/app/(app)/trending/page.tsx"
      to: "src/app/(app)/trending/trending-client.tsx"
      via: "import { TrendingClient }"
      pattern: "import.*TrendingClient.*from.*trending-client"
    - from: "src/app/(app)/trending/trending-client.tsx"
      to: "src/lib/trending-mock-data.ts"
      via: "import { getVideosByCategory, getTrendingStats }"
      pattern: "import.*from.*@/lib/trending-mock-data"
    - from: "src/app/(app)/trending/trending-client.tsx"
      to: "src/types/trending.ts"
      via: "import type { TrendingCategory, ValidTab }"
      pattern: "import type.*from.*@/types/trending"
    - from: "src/components/app/sidebar.tsx"
      to: "/trending route"
      via: "router.push('/trending')"
      pattern: "router\\.push.*trending"
---

<objective>
Build the /trending page route with server/client component split, sidebar navigation, category tabs synced to URL, stats bar, and skeleton/empty states.

Purpose: Create the complete page shell that users interact with -- the visual and interactive foundation that video cards and detail modal will build on in Phases 51-52.

Output: Server page component, client shell component with tabs/stats/states, and sidebar nav item.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/BRAND-BIBLE.md
@.planning/phases/50-data-layer-page-shell/50-CONTEXT.md
@.planning/phases/50-data-layer-page-shell/50-RESEARCH.md
@.planning/phases/50-data-layer-page-shell/50-01-SUMMARY.md

Reference files (read for patterns, do not modify):
@src/app/(app)/settings/page.tsx (server component pattern with searchParams)
@src/components/app/sidebar.tsx (nav item pattern)
@src/components/app/sidebar-nav-item.tsx (SidebarNavItem API)
@src/components/ui/category-tabs.tsx (CategoryTabs API)
@src/components/ui/tabs.tsx (TabsTrigger styling, TabsContent)
@src/components/ui/typography.tsx (Heading component API)
@src/components/ui/skeleton.tsx (Skeleton component)
@src/components/app/app-shell.tsx (AppShell layout structure)
@src/app/(app)/layout.tsx (route group layout)
</context>

<v0_methodology>
## v0 MCP — Primary UI Design Tool

**All visual UI in this plan MUST be generated via v0 MCP (`mcp__v0__v0_generate_ui`), not hand-coded.**

### Workflow
1. **Read** `.planning/BRAND-BIBLE.md` fully before prompting v0
2. **Craft a detailed v0 prompt** that includes:
   - The exact design system components to use (GlassCard, GlassPill, CategoryTabs, Typography, Skeleton, etc.)
   - The exact token names: `bg-background`, `bg-surface`, `text-foreground`, `text-foreground-secondary`, `text-foreground-muted`, `bg-accent` (coral #FF7F50), `border-border`, `border-border-glass`
   - Typography: `font-display` (Funnel Display), `font-sans` (Satoshi), sizes `text-xs` through `text-display`
   - Color semantics: coral (#FF7F50) for accents/active states, dark backgrounds, glass effects
   - Spacing: generous and breathable, premium feel (not data-dense)
   - Reference: "Raycast-quality dark UI with coral branding"
3. **Include specific layout requirements** from the task (page structure, component placement, responsive breakpoints)
4. **Iterate** on v0 output if needed (`mcp__v0__v0_chat_complete`) to refine details
5. **Integrate** v0 output into the codebase, adapting imports to match existing project structure
6. **Verify** output uses actual design system components, not v0's own approximations

### What v0 generates (this plan)
- TrendingClient page shell layout (heading, stats bar, tabs, content area)
- Skeleton loading grid
- Empty state component
- Stats bar styling

### What v0 does NOT generate (this plan)
- Server page component boilerplate (Task 1 — structural, follow existing pattern)
- Sidebar nav item addition (Task 1 — one-line change)
- URL sync / state management logic (pure logic, not visual)
</v0_methodology>

<tasks>

<task type="auto">
  <name>Task 1: Create server page component and add sidebar nav item</name>
  <files>src/app/(app)/trending/page.tsx, src/components/app/sidebar.tsx</files>
  <action>
**A. Create `src/app/(app)/trending/page.tsx`** (server component):

Follow the exact pattern from `src/app/(app)/settings/page.tsx`:

```typescript
import type { Metadata } from "next";
import { Suspense } from "react";
import { TrendingClient } from "./trending-client";
import { VALID_TABS, type ValidTab } from "@/types/trending";

export const metadata: Metadata = {
  title: "Trending | Virtuna",
  description: "Discover trending TikTok videos across categories",
};

interface PageProps {
  searchParams: Promise<{ tab?: string }>;
}

export default async function TrendingPage({ searchParams }: PageProps) {
  const params = await searchParams;
  const tabParam = params.tab || "";
  const defaultTab: ValidTab = VALID_TABS.includes(tabParam as ValidTab)
    ? (tabParam as ValidTab)
    : "breaking-out";

  return (
    <Suspense fallback={<TrendingPageSkeleton />}>
      <TrendingClient defaultTab={defaultTab} />
    </Suspense>
  );
}
```

Include a `TrendingPageSkeleton` function component that renders a skeleton matching the page layout shape:
- Max-width container (1280px), centered, padding
- Skeleton for the heading (h-8 w-48)
- Skeleton for stats bar (h-5 w-full max-w-lg, mt-3)
- Skeleton for tab bar (h-10 w-80, mt-6)
- Grid of 6 skeleton cards (3 cols, each h-64 rounded-xl, mt-8)

**B. Add sidebar nav item to `src/components/app/sidebar.tsx`:**

1. Add import: `import { TrendingUp } from "lucide-react";`
2. In the bottom `<nav>` section, add a Trending nav item BEFORE "Manage plan" (it's a primary navigation feature, not a utility):

```tsx
<SidebarNavItem
  label="Trending"
  icon={TrendingUp}
  onClick={() => {
    router.push("/trending");
    onMobileOpenChange?.(false);
  }}
/>
```

Add it right before the "Manage plan" SidebarNavItem, after the separator line and `<nav>` opening tag. This keeps primary features at the top of the bottom nav.
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. Navigate to `http://localhost:3000/trending` -- page renders (even if TrendingClient doesn't exist yet, the skeleton fallback should show)
3. Sidebar shows "Trending" nav item with TrendingUp icon
4. Clicking "Trending" in sidebar navigates to /trending
  </verify>
  <done>Server page component exists at /trending route with metadata, searchParams validation, and Suspense boundary. Sidebar has Trending nav item.</done>
</task>

<task type="auto">
  <name>Task 2: Generate trending page shell UI via v0 MCP, then integrate with state logic</name>
  <files>src/app/(app)/trending/trending-client.tsx</files>
  <action>

**Step A: Generate visual UI via v0 MCP**

Use `mcp__v0__v0_generate_ui` to generate the TrendingClient page shell. Read `.planning/BRAND-BIBLE.md` first, then craft a prompt like:

```
Generate a "Trending" page shell for a dark-mode social media intelligence app (Raycast-quality design, coral #FF7F50 branding).

Design system tokens (use these exact CSS custom properties / Tailwind classes):
- Backgrounds: bg-background (#07080a), bg-surface (#121316)
- Text: text-foreground (#e8e8e9), text-foreground-secondary (#a0a0a2), text-foreground-muted (#848586)
- Accent: bg-accent / text-accent (coral #FF7F50)
- Borders: border-border (#1e1f24), border-border-glass (rgba(255,255,255,0.06))
- Typography: font-family Satoshi (font-sans), headings in Funnel Display (font-display)
- Border radius: rounded-lg (8px), rounded-xl (12px), rounded-2xl (16px)

Layout:
- Max-width 1280px container, centered, px-6 py-8 md:px-8
- H1 heading "Trending" (h3 visual size ~24px, medium weight, font-display)
- Stats bar below heading (mt-2): category counts "Breaking Out (14) · Trending Now (14) · Rising Again (14)" and aggregate "42 videos · 156.2M total views" — use text-foreground-muted, text-sm
- Three category tabs below stats (mt-6): "Breaking Out", "Trending Now", "Rising Again"
  - Active tab: coral accent (bg-accent/10, text-accent, border-accent/20)
  - Tabs sticky on scroll with blurred background
- Tab content area: placeholder grid showing "14 videos ready" text per tab
- Skeleton loading state: 6 cards in a 3-col responsive grid (1 col mobile, 2 tablet, 3 desktop), each with h-52 thumbnail skeleton + h-4 title + h-3 subtitle
- Empty state: centered icon (Inbox) in a rounded bg-surface box, "No videos [category] right now" text, "Check back soon" subtext

Style: generous spacing, breathable, premium — not data-dense. Dark glassmorphic aesthetic.
```

If the output needs refinement, use `mcp__v0__v0_chat_complete` to iterate (e.g., "Make the stats bar more subtle", "Add more vertical spacing between sections").

**Step B: Integrate v0 output into project structure**

Take the v0-generated JSX and create `src/app/(app)/trending/trending-client.tsx` as a `"use client"` component, adapting:

1. **Replace v0 component imports** with actual design system imports:
   - `Heading, Text, Caption` from `@/components/ui/typography`
   - `CategoryTabs, TabsContent` from `@/components/ui/category-tabs`
   - `Skeleton` from `@/components/ui/skeleton`
   - `TrendingUp, Inbox` from "lucide-react"

2. **Add state management logic** (v0 won't generate this correctly):

   Props interface:
   ```typescript
   interface TrendingClientProps {
     defaultTab: ValidTab;
   }
   ```

   Tab state with URL sync:
   - Use `useSearchParams()` to read current tab from URL
   - Maintain local `activeTab` state initialized from `searchParams.get("tab") ?? defaultTab`
   - `handleTabChange(value: string)`: sets `isLoading(true)`, updates local state, calls `window.history.pushState(null, "", `/trending?tab=${value}`)`, then `setTimeout(() => setIsLoading(false), 250)` for skeleton flash
   - Add `useEffect` listening to `popstate` event to sync local tab state when user presses browser back/forward

3. **Wire data imports:**
   - `getVideosByCategory, getTrendingStats` from `@/lib/trending-mock-data`
   - `CATEGORY_LABELS, VALID_TABS` from `@/types/trending`
   - Type imports: `TrendingCategory, ValidTab, TrendingStats`

4. **Apply backdrop-filter via inline styles** (Lightning CSS strips it from classes):
   ```tsx
   <div className="sticky top-0 z-10 bg-background/80 pb-3 pt-2" style={{ backdropFilter: 'blur(12px)', WebkitBackdropFilter: 'blur(12px)' }}>
   ```

5. **Keep v0's visual layout** but ensure:
   - `CategoryTabs` in controlled mode: `value={activeTab}`, `onValueChange={handleTabChange}`
   - Tab content shows `<SkeletonGrid />` when `isLoading`, `<EmptyState />` when no videos, placeholder count otherwise
   - Stats bar always visible with zeroed values when loading (no layout shift)
   - `formatCompactNumber` helper for view counts

**Important notes:**
- Do NOT use `router.push`/`router.replace` for tab changes — use `window.history.pushState` for shallow URL updates (no server re-render)
- Do NOT create a Zustand store — URL params are source of truth
- Wrap `useSearchParams` usage properly — the Suspense boundary is in page.tsx
- Keep stats bar visible with zeroed values when loading
- v0 output is a starting point — verify it uses actual design system components, not approximations
  </action>
  <verify>
1. `npx tsc --noEmit` passes
2. `http://localhost:3000/trending` shows: Heading "Trending", stats bar, 3 category tabs
3. Default tab is "Breaking Out" with coral accent on active
4. Clicking tabs: brief skeleton flash (~250ms), then content updates, URL updates
5. Manually visit `/trending?tab=rising-again` -- "Rising Again" tab is active
6. Browser back/forward updates active tab
7. Stats bar shows category counts and total metrics
  </verify>
  <done>Client component renders complete page shell with heading, stats bar, category tabs with coral accent, URL sync via pushState, skeleton loading flash on tab switch, and empty state for categories with no videos. All tab state driven by URL search params.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete trending page shell with:
- /trending route accessible via sidebar "Trending" nav item
- "Trending" heading with stats bar showing category counts and aggregate metrics
- 3 category tabs (Breaking Out, Trending Now, Rising Again) with coral accent on active
- URL sync (tab=breaking-out in URL, browser back/forward works)
- Skeleton loading flash (~250ms) on tab switch
- Placeholder content showing video count per category (cards come in Phase 51)
  </what-built>
  <how-to-verify>
1. Start dev server: `pnpm dev` (or check if already running)
2. Navigate to `http://localhost:3000/trending` directly -- should see "Trending" heading, stats bar, tabs
3. Click sidebar "Trending" nav item -- should navigate to /trending
4. Verify default tab is "Breaking Out" with coral (#FF7F50) accent
5. Click "Trending Now" tab -- brief skeleton flash, then content switches, URL shows `?tab=trending-now`
6. Click "Rising Again" tab -- same behavior, URL shows `?tab=rising-again`
7. Press browser back button -- should go back to "Trending Now" tab
8. Visit `http://localhost:3000/trending?tab=rising-again` directly -- "Rising Again" should be active
9. Verify stats bar shows counts (14 per category) and total views
10. Verify tabs are sticky on scroll (if content is tall enough to scroll)
11. Verify spacing feels premium and breathable, not data-dense
  </how-to-verify>
  <resume-signal>Type "approved" or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
1. TypeScript compiles clean: `npx tsc --noEmit`
2. Route `/trending` resolves within the `(app)` route group
3. Sidebar shows "Trending" with TrendingUp icon
4. Three tabs render with coral accent on active
5. Tab switching: URL updates, content filters, skeleton flash ~250ms
6. Browser back/forward syncs tab state
7. Stats bar visible at all times with category counts
8. Requirements covered: PAGE-01, PAGE-02, PAGE-03, PAGE-04, FILT-01, FILT-02, FILT-03, FILT-04
</verification>

<success_criteria>
- /trending page accessible via sidebar nav and direct URL
- Typography Heading renders "Trending"
- CategoryTabs with 3 categories, coral accent on active tab
- Tab state synced to URL search params (shareable, back/forward works)
- Stats bar with category counts and aggregate metrics
- Skeleton flash on tab switch (~200-300ms)
- All 8 PAGE/FILT requirements satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/50-data-layer-page-shell/50-02-SUMMARY.md`
</output>
