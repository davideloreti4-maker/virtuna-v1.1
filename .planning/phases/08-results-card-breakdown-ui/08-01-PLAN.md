---
phase: 08-results-card-breakdown-ui
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/simulation/impact-score.tsx
  - src/components/app/simulation/attention-breakdown.tsx
autonomous: true

must_haves:
  truths:
    - "Big hero score number (0-100) with confidence badge visible at top of results"
    - "5 TikTok factors listed with horizontal progress bars and score numbers"
    - "Clicking a factor row reveals its actionable tip and rationale with smooth height animation"
  artifacts:
    - path: "src/components/app/simulation/impact-score.tsx"
      provides: "Hero score display with confidence badge"
      contains: "confidence_label"
    - path: "src/components/app/simulation/attention-breakdown.tsx"
      provides: "5-factor breakdown with expand-on-click"
      contains: "improvement_tip"
  key_links:
    - from: "src/components/app/simulation/impact-score.tsx"
      to: "PredictionResult"
      via: "overall_score + confidence_label props"
      pattern: "overall_score.*confidence_label"
    - from: "src/components/app/simulation/attention-breakdown.tsx"
      to: "Factor[]"
      via: "factors prop from PredictionResult"
      pattern: "Factor.*score.*improvement_tip"
---

<objective>
Rewrite the hero score display (ImpactScore) and factor breakdown (AttentionBreakdown) for v2 results.

Purpose: Replace v1 attention percentage bars with v2 TikTok factor breakdown showing the 5 factors (Scroll-Stop Power, Completion Pull, Rewatch Potential, Share Trigger, Emotional Charge) with Raycast-style horizontal progress bars and expand-on-click detail.

Output: Two rewritten components that accept v2 PredictionResult data directly (no TestResult mapping needed).
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-results-card-breakdown-ui/08-CONTEXT.md
@src/lib/engine/types.ts
@src/components/app/simulation/impact-score.tsx
@src/components/app/simulation/attention-breakdown.tsx
@src/components/primitives/GlassProgress.tsx
@src/components/ui/card.tsx
@src/components/ui/badge.tsx
@src/components/ui/typography.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Rewrite ImpactScore to v2 hero score with confidence badge</name>
  <files>src/components/app/simulation/impact-score.tsx</files>
  <action>
Rewrite ImpactScore to accept v2 props directly instead of the v1 ImpactLabel:

Props interface:
```typescript
interface ImpactScoreProps {
  overall_score: number;       // 0-100
  confidence_label: ConfidenceLevel; // "HIGH" | "MEDIUM" | "LOW"
}
```

Layout (per LOCKED decision: "Big hero score number at top"):
1. Section header row: "Impact Score" label on left, confidence badge on right
2. Confidence badge: use `<Badge>` component with variant mapped from confidence_label:
   - HIGH → variant="success"
   - MEDIUM → variant="warning"
   - LOW → variant="error"
   - Display text: "High confidence" / "Medium confidence" / "Low confidence"
   - Size "sm" — subtle per LOCKED decision
3. Large score number: `text-6xl font-bold text-accent` with `/100` suffix in muted
4. Below the score: text label derived from score range using existing getImpactLabel logic inline:
   - >= 85: "Excellent"
   - >= 70: "Good"
   - >= 55: "Average"
   - >= 40: "Below Average"
   - < 40: "Poor"
   - Shown as `text-sm font-medium text-accent`

Keep using GlassCard wrapper with padding="md" and blur="none". Remove the v1 `label: ImpactLabel` prop. Import `ConfidenceLevel` from `@/lib/engine/types`. Import `Badge` from `@/components/ui/badge`.
  </action>
  <verify>Run `npx tsc --noEmit --pretty src/components/app/simulation/impact-score.tsx 2>&1 | head -20` — should show no errors in this file (ignore errors from other files that still consume old interface)</verify>
  <done>ImpactScore renders hero score with /100 suffix and confidence badge using v2 PredictionResult fields</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite AttentionBreakdown to v2 FactorBreakdown with expand-on-click</name>
  <files>src/components/app/simulation/attention-breakdown.tsx</files>
  <action>
Rewrite AttentionBreakdown completely. Rename the exported component to `FactorBreakdown` (keep the file name `attention-breakdown.tsx` to minimize import changes in Plan 3).

Props interface:
```typescript
interface FactorBreakdownProps {
  factors: Factor[];  // from @/lib/engine/types
}
```

Layout (per LOCKED decisions):
1. Section header: "Factor Breakdown" with Info icon
2. Fixed display order for consistency (Claude's discretion: fixed order reads better than worst-first for muscle memory):
   - Scroll-Stop Power, Completion Pull, Rewatch Potential, Share Trigger, Emotional Charge
   - If factor names don't match exactly, render in the order received from API
3. Each factor row (inside a div with cursor-pointer and onClick toggle):
   - Left: factor name (Text size="sm" font-medium)
   - Right: score number (Text size="sm" font-bold) like "7.2 / 10"
   - Below name+score row: horizontal GlassProgress bar
     - `value={factor.score * 10}` (convert 0-10 to 0-100 for GlassProgress)
     - Color logic per LOCKED decision (score range -> color):
       - score >= 7: color="coral" (good scores use coral accent)
       - score >= 4: color="default" (mid-range muted)
       - score < 4: color="purple" (low scores visually distinct)
4. Expand-on-click detail (per LOCKED decision):
   - Track expanded factor ID in local state: `const [expandedId, setExpandedId] = useState<string | null>(null)`
   - On click, toggle expandedId
   - When expanded, show below the progress bar:
     - `improvement_tip` as Text size="sm" muted with a subtle left border (border-l-2 border-accent/30 pl-3)
   - Use smooth height animation: wrap in a div with `overflow-hidden transition-all duration-200` and conditional `max-h-0`/`max-h-24` (CSS transition for expand, no layout shift per LOCKED decision)
5. Wrap entire list in GlassCard padding="md" blur="none"

Import `Factor` from `@/lib/engine/types`, `GlassProgress` from `@/components/primitives`, `GlassCard` from `@/components/ui/card`, `Text` from `@/components/ui/typography`.
  </action>
  <verify>Run `npx tsc --noEmit --pretty src/components/app/simulation/attention-breakdown.tsx 2>&1 | head -20` — should show no errors in this file</verify>
  <done>FactorBreakdown renders 5 TikTok factors with progress bars, scores, and expand-on-click tips using v2 Factor[] data</done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` on both modified files compiles without errors
- ImpactScore accepts `overall_score: number` and `confidence_label: ConfidenceLevel`
- FactorBreakdown accepts `factors: Factor[]` and renders progress bars with expand detail
- No v1 types imported (no ImpactLabel, no attention breakdown interface)
</verification>

<success_criteria>
1. ImpactScore shows big hero number with /100 and confidence badge
2. FactorBreakdown shows 5 factors with horizontal progress bars and score numbers
3. Clicking a factor reveals its improvement tip with smooth animation
4. Both components use v2 PredictionResult data shapes directly
</success_criteria>

<output>
After completion, create `.planning/phases/08-results-card-breakdown-ui/08-01-SUMMARY.md`
</output>
