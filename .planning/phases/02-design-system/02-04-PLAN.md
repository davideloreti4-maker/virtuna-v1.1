---
phase: 02-design-system
plan: 04
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/components/motion/fade-in.tsx
  - src/components/motion/slide-up.tsx
  - src/components/motion/frozen-router.tsx
  - src/components/motion/page-transition.tsx
  - src/components/motion/index.ts
autonomous: true

must_haves:
  truths:
    - "FadeIn animates children with opacity and Y translation"
    - "SlideUp animates children sliding from below"
    - "PageTransition wraps children for route change animations"
    - "Animations respect prefers-reduced-motion"
  artifacts:
    - path: "src/components/motion/fade-in.tsx"
      provides: "FadeIn animation wrapper"
      exports: ["FadeIn"]
    - path: "src/components/motion/slide-up.tsx"
      provides: "SlideUp animation wrapper"
      exports: ["SlideUp"]
    - path: "src/components/motion/frozen-router.tsx"
      provides: "FrozenRouter for AnimatePresence"
      exports: ["FrozenRouter"]
    - path: "src/components/motion/page-transition.tsx"
      provides: "PageTransition wrapper"
      exports: ["PageTransition"]
    - path: "src/components/motion/index.ts"
      provides: "Barrel exports"
      exports: ["FadeIn", "SlideUp", "PageTransition", "FrozenRouter"]
  key_links:
    - from: "src/components/motion/*.tsx"
      to: "motion/react"
      via: "motion import"
      pattern: "from \"motion/react\""
    - from: "src/components/motion/page-transition.tsx"
      to: "src/components/motion/frozen-router.tsx"
      via: "FrozenRouter import"
      pattern: "import.*FrozenRouter"
---

<objective>
Create animation components for page transitions and element animations.

Purpose: Animations add polish and match the societies.io experience. FadeIn and SlideUp are used for scroll reveals, PageTransition for route changes.
Output: Four animation components that work with Motion library and respect accessibility preferences.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/02-design-system/02-RESEARCH.md
@.planning/phases/02-design-system/02-01-SUMMARY.md
@.reference/design-tokens.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FadeIn and SlideUp components</name>
  <files>
    src/components/motion/fade-in.tsx
    src/components/motion/slide-up.tsx
  </files>
  <action>
1. Create FadeIn component (src/components/motion/fade-in.tsx):
   "use client" directive required

   Import from "motion/react": motion, type Variants, useReducedMotion

   Define fadeInVariants:
   - hidden: { opacity: 0, y: 20 }
   - visible: { opacity: 1, y: 0, transition: { duration: 0.5, ease: [0.215, 0.61, 0.355, 1] } }

   Props:
   - children: React.ReactNode
   - className?: string
   - delay?: number (default: 0)
   - duration?: number (default: 0.5)
   - once?: boolean (default: true) - animate only once when in view

   Implementation:
   - Use motion.div with initial="hidden" and whileInView="visible" (for scroll trigger)
   - Or use animate="visible" if once={false}
   - Apply delay via transition prop
   - Use useReducedMotion() hook - if true, skip animation (set initial to visible state)

2. Create SlideUp component (src/components/motion/slide-up.tsx):
   "use client" directive required

   Similar to FadeIn but with more pronounced Y movement:
   - hidden: { opacity: 0, y: 60 }
   - visible: { opacity: 1, y: 0, transition: { duration: 0.6, ease: [0.165, 0.84, 0.44, 1] } }

   Props (same as FadeIn):
   - children: React.ReactNode
   - className?: string
   - delay?: number (default: 0)
   - duration?: number (default: 0.6)
   - once?: boolean (default: true)

   Implementation mirrors FadeIn with different variants

Both components should:
- Accept className for styling
- Forward viewport options (viewport={{ once: true, margin: "-100px" }})
- Respect prefers-reduced-motion via useReducedMotion hook
  </action>
  <verify>
    - Components compile without TypeScript errors
    - FadeIn animates opacity 0->1 and y 20->0
    - SlideUp animates opacity 0->1 and y 60->0
    - delay prop affects animation start time
  </verify>
  <done>
    - FadeIn component with scroll-triggered fade + translate animation
    - SlideUp component with scroll-triggered slide animation
    - Both respect prefers-reduced-motion
    - Both accept delay and duration customization
  </done>
</task>

<task type="auto">
  <name>Task 2: Create FrozenRouter and PageTransition components</name>
  <files>
    src/components/motion/frozen-router.tsx
    src/components/motion/page-transition.tsx
    src/components/motion/index.ts
  </files>
  <action>
1. Create FrozenRouter component (src/components/motion/frozen-router.tsx):
   "use client" directive required

   This is a workaround for AnimatePresence in Next.js App Router.
   Exact implementation from research:

   ```typescript
   "use client";

   import { useContext, useRef, useEffect } from "react";
   import { LayoutRouterContext } from "next/dist/shared/lib/app-router-context.shared-runtime";
   import { useSelectedLayoutSegment } from "next/navigation";

   function usePreviousValue<T>(value: T): T | null {
     const prevValue = useRef<T | null>(null);

     useEffect(() => {
       prevValue.current = value;
       return () => {
         prevValue.current = null;
       };
     });

     return prevValue.current;
   }

   export function FrozenRouter({ children }: { children: React.ReactNode }) {
     const context = useContext(LayoutRouterContext);
     const prevContext = usePreviousValue(context);

     const segment = useSelectedLayoutSegment();
     const prevSegment = usePreviousValue(segment);

     const changed = segment !== prevSegment &&
       segment !== undefined &&
       prevSegment !== undefined;

     return (
       <LayoutRouterContext.Provider value={changed ? prevContext : context}>
         {children}
       </LayoutRouterContext.Provider>
     );
   }
   ```

2. Create PageTransition component (src/components/motion/page-transition.tsx):
   "use client" directive required

   Import:
   - motion, AnimatePresence from "motion/react"
   - useSelectedLayoutSegment from "next/navigation"
   - FrozenRouter from "./frozen-router"
   - useReducedMotion from "motion/react"

   Props:
   - children: React.ReactNode

   Implementation:
   - Use AnimatePresence with mode="wait"
   - Wrap children in motion.div with key={segment}
   - Animations:
     - initial: { opacity: 0 }
     - animate: { opacity: 1 }
     - exit: { opacity: 0 }
     - transition: { duration: 0.3, ease: [0.215, 0.61, 0.355, 1] }
   - Wrap in FrozenRouter to preserve context during exit
   - Respect reduced motion: if true, use duration: 0

3. Create barrel export (src/components/motion/index.ts):
   - export { FadeIn } from "./fade-in"
   - export { SlideUp } from "./slide-up"
   - export { FrozenRouter } from "./frozen-router"
   - export { PageTransition } from "./page-transition"
  </action>
  <verify>
    - npm run build passes
    - FrozenRouter compiles without errors (uses Next.js internal import)
    - PageTransition uses correct motion imports
    - All exports work from @/components/motion
  </verify>
  <done>
    - FrozenRouter handles AnimatePresence context preservation
    - PageTransition provides fade transitions between routes
    - All 4 motion components exported from barrel
    - Build passes
  </done>
</task>

</tasks>

<verification>
1. `npm run build` passes
2. Import works: `import { FadeIn, SlideUp, PageTransition } from "@/components/motion"`
3. FadeIn triggers animation when element scrolls into view
4. PageTransition can wrap page content in layout
5. No console errors related to AnimatePresence
</verification>

<success_criteria>
- 4 animation components created
- FadeIn and SlideUp use whileInView for scroll triggers
- PageTransition uses FrozenRouter for exit animations
- All respect prefers-reduced-motion
- Build passes
</success_criteria>

<output>
After completion, create `.planning/phases/02-design-system/02-04-SUMMARY.md`
</output>
