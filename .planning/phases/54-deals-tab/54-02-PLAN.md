---
phase: 54-deals-tab
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/brand-deals/deal-filter-bar.tsx
  - src/components/app/brand-deals/deals-empty-state.tsx
  - src/hooks/use-debounce.ts

autonomous: true

must_haves:
  truths:
    - "Filter pills show 'All' plus one pill per category present in mock data, derived from BrandDealCategory type"
    - "Clicking a category pill filters deals; clicking 'All' clears the filter; active pill has visual distinction"
    - "Search input filters deals by brand name with debounced input (300ms delay)"
    - "Empty state displays when no deals match filters, with illustration, message, and 'Clear filters' CTA button"
    - "Clicking 'Clear filters' resets both category filter to 'All' and search query to empty"
  artifacts:
    - path: "src/components/app/brand-deals/deal-filter-bar.tsx"
      provides: "DealFilterBar with category pills and search input"
      exports: ["DealFilterBar"]
      min_lines: 50
    - path: "src/components/app/brand-deals/deals-empty-state.tsx"
      provides: "DealsEmptyState placeholder with clear-filters CTA"
      exports: ["DealsEmptyState"]
      min_lines: 20
    - path: "src/hooks/use-debounce.ts"
      provides: "Reusable debounce hook"
      exports: ["useDebouncedCallback"]
      min_lines: 10
  key_links:
    - from: "src/components/app/brand-deals/deal-filter-bar.tsx"
      to: "src/hooks/use-debounce.ts"
      via: "useDebouncedCallback for search input"
      pattern: "useDebouncedCallback"
    - from: "src/components/app/brand-deals/deal-filter-bar.tsx"
      to: "src/components/primitives/GlassPill.tsx"
      via: "GlassPill for category filter pills"
      pattern: "GlassPill"
    - from: "src/components/app/brand-deals/deals-empty-state.tsx"
      to: "src/components/ui/button.tsx"
      via: "Button for clear-filters CTA"
      pattern: "Button.*Clear"
---

<objective>
Build the DealFilterBar (category pills + search input) and DealsEmptyState components, plus a reusable debounce hook.

Purpose: Provide the filtering and search UI that the DealsTab container will wire to filter state. The debounce hook prevents expensive re-renders on every keystroke. The empty state provides graceful UX when filters yield no results.

Output: Three files -- DealFilterBar component, DealsEmptyState component, and useDebouncedCallback hook.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/54-deals-tab/54-CONTEXT.md
@.planning/phases/54-deals-tab/54-RESEARCH.md

@src/types/brand-deals.ts
@src/lib/mock-brand-deals.ts
@src/components/primitives/GlassPill.tsx
@src/components/ui/input.tsx
@src/components/ui/button.tsx
@src/components/ui/badge.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useDebouncedCallback hook</name>
  <files>src/hooks/use-debounce.ts</files>
  <action>
Create `src/hooks/use-debounce.ts` exporting a reusable debounce hook.

```typescript
"use client";

import { useRef, useCallback } from "react";

/**
 * Returns a debounced version of the provided callback.
 * Delays invocation until `delay` ms after the last call.
 */
export function useDebouncedCallback(
  callback: (value: string) => void,
  delay: number
): (value: string) => void {
  const timeoutRef = useRef<ReturnType<typeof setTimeout> | null>(null);

  return useCallback(
    (value: string) => {
      if (timeoutRef.current) clearTimeout(timeoutRef.current);
      timeoutRef.current = setTimeout(() => callback(value), delay);
    },
    [callback, delay]
  );
}
```

Use `ReturnType<typeof setTimeout>` instead of `NodeJS.Timeout` for better cross-environment compatibility.

Check if `src/hooks/` directory exists first. If not, create it. If it exists, check if there's an index.ts to add the export to.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors.
  </verify>
  <done>
useDebouncedCallback hook exported from src/hooks/use-debounce.ts. Takes a callback and delay, returns a debounced function using useRef + setTimeout. No external dependencies.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DealFilterBar with category pills and debounced search</name>
  <files>src/components/app/brand-deals/deal-filter-bar.tsx</files>
  <action>
Create `src/components/app/brand-deals/deal-filter-bar.tsx` as a "use client" component.

**DealFilterBarProps interface:**
```typescript
interface DealFilterBarProps {
  activeCategory: BrandDealCategory | "all";
  onCategoryChange: (category: BrandDealCategory | "all") => void;
  searchQuery: string;
  onSearchChange: (query: string) => void;
}
```

**Layout:**

1. **Container:** Flex column with gap-4, or flex row on larger screens wrapping search and pills.

2. **Search input row:**
   - Use `Input` component from `@/components/ui/input` with `type="search"` and `placeholder="Search by brand name..."`.
   - Add MagnifyingGlass icon from `@phosphor-icons/react` as a visual prefix (position it absolutely inside a wrapper, or use a wrapping div with the icon and input side by side).
   - The `Input` value is `searchQuery` (controlled by parent). `onChange` calls `onSearchChange` directly -- the parent (DealsTab) will handle debouncing the actual filter update.

3. **Category filter pills row:**
   - Horizontal flex row with `flex-wrap gap-2`.
   - First pill: "All" -- always present. Use `GlassPill` with `color="neutral"`, `active={activeCategory === "all"}`, `onClick={() => onCategoryChange("all")}`.
   - Remaining pills: Derive from `BrandDealCategory` type. Map over the categories that exist in mock data. For each category:
     - Use `GlassPill` with `color={CATEGORY_COLORS[category]}` from deal-utils
     - `active={activeCategory === category}`
     - `onClick={() => onCategoryChange(category)}`
     - `size="sm"`
     - Capitalize the category text for display

   The category list should be derived from the `BrandDealCategory` type union. Since TypeScript can't iterate type unions at runtime, define a constant array:
   ```typescript
   const FILTER_CATEGORIES: BrandDealCategory[] = [
     "tech", "fashion", "gaming", "fitness", "beauty", "food", "travel", "finance"
   ];
   ```
   Import CATEGORY_COLORS from `@/lib/deal-utils`.

**Imports:**
- `Input` from `@/components/ui/input`
- `GlassPill` from `@/components/primitives/GlassPill`
- `CATEGORY_COLORS` from `@/lib/deal-utils`
- `MagnifyingGlass` from `@phosphor-icons/react`
- `BrandDealCategory` from `@/types/brand-deals`
- `cn` from `@/lib/utils`
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors.
  </verify>
  <done>
DealFilterBar renders search input with MagnifyingGlass icon and category filter pills. "All" pill is first. Category pills use GlassPill with CATEGORY_COLORS semantic mapping. Active pill has visual distinction via GlassPill active prop. All interactions controlled by parent via props.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create DealsEmptyState component</name>
  <files>src/components/app/brand-deals/deals-empty-state.tsx</files>
  <action>
Create `src/components/app/brand-deals/deals-empty-state.tsx` as a presentational component.

**DealsEmptyStateProps interface:**
```typescript
interface DealsEmptyStateProps {
  onClearFilters: () => void;
}
```

**Layout:**
- Centered flex column container with min-height (~300px), rounded border, padding
- MagnifyingGlass icon from `@phosphor-icons/react` (large, ~40px, muted color) as illustration
- "No deals found" heading in `text-lg font-medium text-foreground`
- "Try adjusting your filters or search query" subtext in `text-sm text-foreground-muted`
- `Button` (variant="secondary", size="sm") with text "Clear filters" that calls `onClearFilters`

**Styling:**
```
className="flex min-h-[300px] flex-col items-center justify-center rounded-xl border border-border-subtle p-8"
```

**Imports:**
- `Button` from `@/components/ui/button`
- `MagnifyingGlass` from `@phosphor-icons/react`
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors.
  </verify>
  <done>
DealsEmptyState renders a centered empty state with MagnifyingGlass icon, "No deals found" message, helpful subtext, and a "Clear filters" secondary button. Calls onClearFilters when button is clicked.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. useDebouncedCallback hook exists in src/hooks/use-debounce.ts and exports correctly
3. DealFilterBar renders "All" pill + category pills using GlassPill with color semantics
4. DealFilterBar has search input with MagnifyingGlass icon
5. DealsEmptyState shows message + "Clear filters" Button
6. No file overlap with Plan 01 (deal-card.tsx, new-this-week-row.tsx, deal-utils.ts are Plan 01's files)
</verification>

<success_criteria>
- Three new files created and type-check clean
- Filter pills derive categories from BrandDealCategory constant array (not hardcoded subset)
- Search input is a controlled component (parent manages debounce state)
- Empty state has clear-filters CTA that calls onClearFilters callback
- useDebouncedCallback is reusable (not coupled to deal-specific logic)
</success_criteria>

<output>
After completion, create `.planning/phases/54-deals-tab/54-02-SUMMARY.md`
</output>
