---
phase: 54-deals-tab
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/app/brand-deals/deal-card.tsx
  - src/components/app/brand-deals/new-this-week-row.tsx
  - src/lib/deal-utils.ts

autonomous: true

must_haves:
  truths:
    - "Each deal card displays brand logo, brand name, description (3-line clamped), payout (green, top-right), category tag, and status badge"
    - "Deal cards use solid bg-surface-elevated backgrounds with no backdrop-filter blur"
    - "Hover state on deal cards shows subtle border change and elevation shift"
    - "New This Week section renders as a horizontal scroll row with snap-to-card behavior and info badge count"
    - "Color semantics: orange for creative categories (fashion, beauty, food), green for payout values, blue for tech/analytics categories"
    - "Featured (isNew) cards in the row show accent indicator (colored top border), not GradientGlow"
    - "Edge case: deal-010 with zero commission/fee shows payoutRange 'Revenue share TBD' instead of $0"
    - "Edge case: very long brand name truncates gracefully, Clearbit logo failure shows fallback initials"
  artifacts:
    - path: "src/components/app/brand-deals/deal-card.tsx"
      provides: "DealCard presentational component"
      exports: ["DealCard"]
      min_lines: 60
    - path: "src/components/app/brand-deals/new-this-week-row.tsx"
      provides: "NewThisWeekRow horizontal scroll section"
      exports: ["NewThisWeekRow"]
      min_lines: 30
    - path: "src/lib/deal-utils.ts"
      provides: "Payout formatting, category color mapping, status badge mapping"
      exports: ["formatPayout", "getCategoryColor", "getStatusBadgeVariant", "CATEGORY_COLORS"]
      min_lines: 40
  key_links:
    - from: "src/components/app/brand-deals/deal-card.tsx"
      to: "src/lib/deal-utils.ts"
      via: "imports formatPayout, getCategoryColor, getStatusBadgeVariant"
      pattern: "import.*deal-utils"
    - from: "src/components/app/brand-deals/deal-card.tsx"
      to: "src/components/ui/avatar.tsx"
      via: "Avatar component for brand logo with fallback"
      pattern: "Avatar.*src.*fallback"
    - from: "src/components/app/brand-deals/new-this-week-row.tsx"
      to: "src/components/app/brand-deals/deal-card.tsx"
      via: "Renders DealCard components in horizontal scroll"
      pattern: "DealCard"
---

<objective>
Build the DealCard presentational component and NewThisWeekRow horizontal scroll section with color semantics and payout formatting utilities.

Purpose: Establish the core visual building blocks (deal card + featured row) that the DealsTab container will compose. This plan also establishes the color semantic pattern (orange/green/blue) used across all subsequent tabs.

Output: Three files -- DealCard component, NewThisWeekRow component, and deal-utils.ts with formatting/mapping utilities.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/54-deals-tab/54-CONTEXT.md
@.planning/phases/54-deals-tab/54-RESEARCH.md

@src/types/brand-deals.ts
@src/lib/mock-brand-deals.ts
@src/components/ui/badge.tsx
@src/components/ui/button.tsx
@src/components/ui/avatar.tsx
@src/components/primitives/GlassPill.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create deal-utils.ts with payout formatting, category colors, and status badge mapping</name>
  <files>src/lib/deal-utils.ts</files>
  <action>
Create `src/lib/deal-utils.ts` with these exports:

**formatPayout(deal: BrandDeal): string**
- If `deal.payoutRange` exists and is non-empty, return it as-is (e.g., "$50 - $500 per post", "Revenue share TBD")
- If `fixedFee > 0` AND `commission > 0`, return `$${fixedFee} + ${commission}%`
- If only `fixedFee > 0`, return `$${fixedFee}`
- If only `commission > 0`, return `${commission}% commission`
- Fallback: return "TBD"

**CATEGORY_COLORS: Record<BrandDealCategory, GlassPill color>**
Map each BrandDealCategory to a GlassPill color prop value for Brand Bible semantics:
- Orange family (creative): fashion -> "orange", beauty -> "orange", food -> "orange"
- Blue family (tech/analytics): tech -> "blue", gaming -> "blue", finance -> "blue"
- Green family: fitness -> "green"
- Cyan: travel -> "cyan"

**getStatusBadgeVariant(status: BrandDeal["status"]): Badge variant**
- "active" -> "success"
- "pending" -> "warning"
- "expired" -> "error"
- "applied" -> "info"
- default -> "default"

**getStatusLabel(status: BrandDeal["status"]): string**
- "active" -> "Active"
- "pending" -> "Pending"
- "expired" -> "Expired"
- "applied" -> "Applied"

Import `BrandDeal` and `BrandDealCategory` types from `@/types/brand-deals`.

Explicit return types on all functions. No `any` types.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors in the new file.
  </verify>
  <done>
deal-utils.ts exports formatPayout, CATEGORY_COLORS, getStatusBadgeVariant, and getStatusLabel. formatPayout handles all edge cases (zero values, payoutRange precedence, combined fee+commission). CATEGORY_COLORS maps all 8 BrandDealCategory values to semantic colors.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create DealCard component with solid background and color semantics</name>
  <files>src/components/app/brand-deals/deal-card.tsx</files>
  <action>
Create `src/components/app/brand-deals/deal-card.tsx` as a "use client" presentational component.

**DealCardProps interface:**
```typescript
interface DealCardProps {
  deal: BrandDeal;
  isApplied: boolean;
  onApply: (deal: BrandDeal) => void;
}
```

**Card layout (top to bottom):**

1. **Container:** `div` with `rounded-xl border border-border bg-surface-elevated p-5 transition-all duration-200 hover:border-border-hover hover:-translate-y-px hover:shadow-md`. NOT GlassCard, NOT backdrop-filter. When `isApplied`, add `opacity-60` for muted treatment.

2. **Payout (top-right, absolute):** `absolute right-5 top-5`. Use `formatPayout(deal)` from deal-utils. Style with `text-lg font-bold text-green-400` (green = earnings per Brand Bible). Use `pr-20` or similar on the card title row to prevent overlap.

3. **Brand logo + name row:** Flex row with `Avatar` component (`size="xs"`, `src={deal.brandLogo}`, `fallback={deal.brandName.slice(0, 2).toUpperCase()}`). Brand name in `text-sm font-medium text-foreground-secondary truncate`. Add `max-w-[60%]` to the brand name wrapper to prevent overlap with payout.

4. **Description:** `p` with `text-sm text-foreground-secondary line-clamp-3 mb-4`. Shows `deal.description`.

5. **Bottom row (category + action):** Flex row with `justify-between items-center`.
   - Left: `GlassPill` component with `color={CATEGORY_COLORS[deal.category]}` and `size="sm"`. Capitalize category text.
   - Between category and action: Status badge using `Badge` with `variant={getStatusBadgeVariant(deal.status)}` showing `getStatusLabel(deal.status)`.
   - Right: If `isApplied`, show `<Badge variant="success">Applied</Badge>`. If NOT applied AND deal.status is not "expired", show `<Button size="sm" variant="primary" onClick={() => onApply(deal)}>Apply</Button>`. If expired, show nothing or just the expired badge.

6. **Featured accent (isNew):** If `deal.isNew`, add a colored top border: `border-t-2 border-t-accent` (or orange-400) on the container div. This replaces GradientGlow per CONTEXT.md override.

Import from:
- `@/components/ui/avatar` (Avatar)
- `@/components/ui/badge` (Badge)
- `@/components/ui/button` (Button)
- `@/components/primitives/GlassPill` (GlassPill)
- `@/lib/deal-utils` (formatPayout, CATEGORY_COLORS, getStatusBadgeVariant, getStatusLabel)
- `@/types/brand-deals` (BrandDeal)
- `@/lib/utils` (cn)
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors. Visually confirm the component accepts the correct props by checking the interface.
  </verify>
  <done>
DealCard renders with solid bg-surface-elevated background, green payout top-right, brand logo via Avatar with fallback, 3-line clamped description, colored category GlassPill, status Badge, and Apply/Applied button/badge. Hover state changes border and adds subtle elevation. Applied cards show 60% opacity. isNew cards have colored top border accent.
  </done>
</task>

<task type="auto">
  <name>Task 3: Create NewThisWeekRow horizontal scroll section</name>
  <files>src/components/app/brand-deals/new-this-week-row.tsx</files>
  <action>
Create `src/components/app/brand-deals/new-this-week-row.tsx` as a "use client" component.

**NewThisWeekRowProps interface:**
```typescript
interface NewThisWeekRowProps {
  deals: BrandDeal[];
  appliedDeals: Set<string>;
  onApply: (deal: BrandDeal) => void;
}
```

**Layout:**

1. **Section wrapper:** `<section className="mb-6">` -- only renders if `deals.length > 0`.

2. **Header row:** Flex row with:
   - `<h2 className="text-lg font-semibold text-foreground">New This Week</h2>`
   - `<Badge variant="info" size="sm">{deals.length}</Badge>` showing count

3. **Horizontal scroll container:**
   ```
   <div className="flex gap-4 overflow-x-auto pb-2" style={{ scrollSnapType: "x mandatory", scrollbarWidth: "none" }}>
   ```
   Use inline styles for `scrollSnapType` and `scrollbarWidth: "none"` (scrollbar-none may not exist as utility in Tailwind v4). Add a style tag or inline `-webkit-scrollbar: display none` if needed -- simplest approach is inline `scrollbarWidth: "none"` which works in Firefox + Chrome, and add a wrapping `<style>` or className approach for WebKit.

   Actually, the simplest approach: add a CSS class. But since this is a component, use inline style `scrollbarWidth: "none"` and add `className` with a `[&::-webkit-scrollbar]:hidden` arbitrary variant if Tailwind v4 supports it. Alternatively, just use the `scrollbar-none` class that's already used in category-tabs.tsx (it works in the codebase already).

4. **Scroll items:** Map over `deals`, each wrapped in:
   ```
   <div className="min-w-[300px] flex-shrink-0" style={{ scrollSnapAlign: "start" }}>
     <DealCard deal={deal} isApplied={appliedDeals.has(deal.id)} onApply={onApply} />
   </div>
   ```

Import DealCard from `./deal-card`.

**Key details:**
- Scroll snap for clean card alignment on swipe
- min-w-[300px] ensures cards don't collapse
- flex-shrink-0 prevents cards from shrinking in flex container
- Only renders when there are new deals (guard with early return or conditional)
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors.
  </verify>
  <done>
NewThisWeekRow renders a horizontal scrollable row of DealCards for deals with isNew flag. Has "New This Week" heading with info Badge count. Scroll snaps to card boundaries. Hidden scrollbar. Only renders when deals array is non-empty.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. deal-utils.ts exports: formatPayout, CATEGORY_COLORS, getStatusBadgeVariant, getStatusLabel
3. DealCard accepts { deal, isApplied, onApply } props and renders with bg-surface-elevated (no backdrop-filter)
4. NewThisWeekRow accepts { deals, appliedDeals, onApply } and renders horizontal scroll with snap
5. Color semantics verified: orange for fashion/beauty/food, blue for tech/gaming/finance, green for fitness, cyan for travel
6. Payout formatting handles: payoutRange priority, combined fee+commission, zero values edge case
</verification>

<success_criteria>
- Three new files created and type-check clean
- DealCard uses solid surface background, not glass
- Color semantics follow Brand Bible (orange creative, green earnings, blue analytics)
- NewThisWeekRow is a scrollable horizontal row, not a grid
- Edge cases handled: long brand names truncate, zero payout shows "Revenue share TBD", Clearbit failures show Avatar fallback initials
</success_criteria>

<output>
After completion, create `.planning/phases/54-deals-tab/54-01-SUMMARY.md`
</output>
