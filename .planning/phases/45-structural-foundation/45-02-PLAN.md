---
phase: 45-structural-foundation
plan: 02
type: execute
wave: 2
depends_on: ["45-01"]
files_modified:
  - src/components/app/sidebar.tsx
  - src/components/app/sidebar-nav-item.tsx
  - src/components/app/test-history-list.tsx
  - src/components/app/test-history-item.tsx
autonomous: true

must_haves:
  truths:
    - "Sidebar renders as a floating glassmorphic panel inset from viewport edges"
    - "Nav items display with icon-left label-right layout using Button ghost and Icon"
    - "Content Intelligence, Trending Feed, and Brand Deals appear as nav items"
    - "SocietySelector and ViewSelector are removed from the sidebar"
    - "Test history items use Typography components (Text, Caption)"
    - "Active nav item has filled background highlight"
    - "Collapse button inside sidebar triggers hide via sidebar store"
  artifacts:
    - path: "src/components/app/sidebar.tsx"
      provides: "Rebuilt floating glassmorphic sidebar"
      exports: ["Sidebar"]
    - path: "src/components/app/sidebar-nav-item.tsx"
      provides: "Nav item using Button ghost + Icon + Text"
      exports: ["SidebarNavItem"]
    - path: "src/components/app/test-history-list.tsx"
      provides: "Test history list using Typography"
      exports: ["TestHistoryList"]
    - path: "src/components/app/test-history-item.tsx"
      provides: "Test history item using Text and Caption"
      exports: ["TestHistoryItem"]
  key_links:
    - from: "src/components/app/sidebar.tsx"
      to: "src/stores/sidebar-store.ts"
      via: "useSidebarStore hook"
      pattern: "useSidebarStore"
    - from: "src/components/app/sidebar.tsx"
      to: "src/components/primitives/GlassPanel.tsx"
      via: "GlassPanel as=aside"
      pattern: 'GlassPanel.*as="aside"'
    - from: "src/components/app/sidebar-nav-item.tsx"
      to: "src/components/ui/button.tsx"
      via: "Button variant=ghost"
      pattern: 'variant="ghost"'
---

<objective>
Rebuild the sidebar as a floating GlassPanel with new navigation structure, design system primitives, and Zustand store integration.

Purpose: Transform the existing 240px hardcoded sidebar into a 300px floating glassmorphic panel using GlassPanel, Button ghost, Icon, and Typography primitives. Remove SocietySelector and ViewSelector. Add new nav items.
Output: Rebuilt `sidebar.tsx`, updated `sidebar-nav-item.tsx`, updated `test-history-list.tsx` and `test-history-item.tsx`.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/45-structural-foundation/45-RESEARCH.md
@.planning/phases/45-structural-foundation/45-01-SUMMARY.md

@src/components/app/sidebar.tsx
@src/components/app/sidebar-nav-item.tsx
@src/components/app/test-history-list.tsx
@src/components/app/test-history-item.tsx
@src/components/primitives/GlassPanel.tsx
@src/components/ui/button.tsx
@src/components/ui/icon.tsx
@src/components/ui/typography.tsx
@src/stores/sidebar-store.ts
</context>

## v0 Design Output

### Design 1: Complete Floating Glassmorphic Sidebar

```tsx
// v0-generated sidebar (v0-1.5-lg)
// Key output to adapt to existing primitives

"use client";

import { useState } from "react";
import {
  PanelLeftClose,
  BrainCircuit,
  TrendingUp,
  Handshake,
  Plus,
  MoreHorizontal,
  SlidersHorizontal,
  MessageSquare,
  Book,
  LogOut,
} from "lucide-react";

const navItems = [
  { label: "Content Intelligence", icon: BrainCircuit, id: "content-intelligence" },
  { label: "Trending Feed", icon: TrendingUp, id: "trending-feed" },
  { label: "Brand Deals", icon: Handshake, id: "brand-deals" },
];

const recentTests = [
  { id: "test-1", title: "Q4 Marketing Campaign Analysis" },
  { id: "test-2", title: "New Feature A/B Test Results" },
  { id: "test-3", title: "Landing Page Conversion Rate" },
  { id: "test-4", title: "User Onboarding Flow Optimization" },
  { id: "test-5", title: "Pricing Strategy Evaluation" },
  { id: "test-6", title: "Competitor Social Media Benchmark" },
];

const bottomNavItems = [
  { label: "Manage Plan", icon: SlidersHorizontal, id: "manage-plan" },
  { label: "Leave Feedback", icon: MessageSquare, id: "leave-feedback" },
  { label: "Product Guide", icon: Book, id: "product-guide" },
  { label: "Log Out", icon: LogOut, id: "log-out" },
];

// Nav item with ghost button, icon-left label-right, 36px height
const NavItem = ({ item, isActive, onClick }: any) => {
  const Icon = item.icon;
  return (
    <button
      onClick={() => onClick(item.id)}
      className={`flex h-[36px] w-full items-center gap-3 rounded-md px-3 text-sm font-medium transition-colors ${
        isActive
          ? "bg-white/10 text-[#f8f8f8]"
          : "text-[#9c9c9d] hover:bg-white/5"
      }`}
    >
      <Icon className="h-5 w-5" fill={isActive ? "currentColor" : "none"} strokeWidth={1.5} />
      <span>{item.label}</span>
    </button>
  );
};

// Test history item with truncated title, active indicator bar
const TestHistoryItem = ({ item, isActive, onClick }: any) => (
  <button
    onClick={() => onClick(item.id)}
    className={`group relative w-full rounded-lg px-3 py-2.5 text-left transition-colors ${
      isActive ? "bg-white/10 text-white" : "text-[#9c9c9d] hover:bg-white/5"
    }`}
  >
    {isActive && (
      <div className="absolute left-0 top-1/2 h-5 w-0.5 -translate-y-1/2 rounded-r-full bg-[#FF7F50]" />
    )}
    <p className="truncate text-sm">{item.title}</p>
    <MoreHorizontal className="absolute right-2 top-1/2 h-4 w-4 -translate-y-1/2 text-[#848586] opacity-0 transition-opacity group-hover:opacity-100" />
  </button>
);

// Full sidebar as floating glass panel
export default function Sidebar() {
  const [activeNav, setActiveNav] = useState("content-intelligence");
  const [activeTest, setActiveTest] = useState("test-2");

  return (
    <aside className="fixed inset-y-3 left-3 flex w-[300px] flex-col rounded-xl border border-white/[.08] bg-[#18191c]/60 shadow-[0_8px_32px_rgba(0,0,0,0.2),inset_0_1px_0_rgba(255,255,255,0.1)] backdrop-blur-[20px]">
      {/* Header: Logo + Collapse */}
      <div className="flex items-center justify-between px-4 pt-4 pb-1">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" className="text-white">
          <path d="M6.5 3L12 12L17.5 3H22L12 21L2 3H6.5Z" fill="currentColor" />
        </svg>
        <button className="text-[#848586] hover:text-white">
          <PanelLeftClose className="h-5 w-5" />
        </button>
      </div>

      <hr className="mx-4 my-2 border-t border-white/[.06]" />

      {/* Nav items */}
      <nav className="flex flex-col gap-0.5 px-2">
        {navItems.map((item) => (
          <NavItem key={item.id} item={item} isActive={activeNav === item.id} onClick={setActiveNav} />
        ))}
      </nav>

      <hr className="mx-4 my-2 border-t border-white/[.06]" />

      {/* Create test button */}
      <div className="px-3">
        <button className="flex w-full items-center justify-between text-sm text-[#9c9c9d] hover:text-white">
          <span>Create a new test</span>
          <Plus className="h-4 w-4" />
        </button>
      </div>

      {/* Test history */}
      <div className="flex-1 overflow-y-auto p-2">
        <h3 className="mb-2 px-2 text-xs font-semibold uppercase tracking-wider text-[#848586]">
          Recent Tests
        </h3>
        <div className="flex flex-col gap-0.5">
          {recentTests.map((item) => (
            <TestHistoryItem key={item.id} item={item} isActive={activeTest === item.id} onClick={setActiveTest} />
          ))}
        </div>
      </div>

      {/* Bottom nav */}
      <hr className="mx-4 border-t border-white/[.06]" />
      <nav className="flex flex-col gap-0.5 p-2">
        {bottomNavItems.map((item) => (
          <NavItem key={item.id} item={item} isActive={false} onClick={() => {}} />
        ))}
      </nav>
      <p className="pb-3 text-center text-xs text-[#58595a]">Version 2.1</p>
    </aside>
  );
}
```

<tasks>

<task type="auto">
  <name>Task 1: Rebuild sidebar as floating GlassPanel with new nav structure</name>
  <files>src/components/app/sidebar.tsx, src/components/app/sidebar-nav-item.tsx</files>
  <action>
**Part A: Rebuild SidebarNavItem to use design system primitives**

Rewrite `src/components/app/sidebar-nav-item.tsx` to match the v0 design (icon-left, label-right) using design system components:

- Change the props interface: Accept a Phosphor icon type (from `@phosphor-icons/react`) instead of `LucideIcon`. Add `isActive?: boolean` prop.
- Replace the custom `<button>` with `<Button variant="ghost" size="sm">` from `@/components/ui/button`
- Use `<Icon>` from `@/components/ui/icon` for the icon (size=20, weight="fill" when active, "regular" when not)
- Use `<Text as="span" size="sm">` from `@/components/ui/typography` for the label
- Layout: `w-full justify-start gap-3` on the Button (icon left, label right — Raycast style, OPPOSITE of current label-left icon-right)
- Active state: add `bg-active text-foreground` class when `isActive` is true
- Remove the current `justify-between` layout (which puts label left, icon right)

Props interface:
```typescript
import type { Icon as PhosphorIcon } from "@phosphor-icons/react";

interface SidebarNavItemProps {
  icon: PhosphorIcon;
  label: string;
  isActive?: boolean;
  onClick?: () => void;
  className?: string;
}
```

**Part B: Rebuild Sidebar as floating GlassPanel**

Rewrite `src/components/app/sidebar.tsx` to use `<GlassPanel as="aside">` instead of the raw `<aside>` with inline styles. Key changes:

1. **Remove imports**: Remove `SocietySelector`, `ViewSelector`, `useSocietyStore`, and all Lucide icon imports
2. **Add imports**: Import `GlassPanel` from `@/components/primitives`, `Button` from `@/components/ui/button`, `Icon` from `@/components/ui/icon`, `Text` and `Caption` from `@/components/ui/typography`, `useSidebarStore` from `@/stores/sidebar-store`, and Phosphor icons (`Lightbulb`, `TrendUp`, `Briefcase`, `Plus`, `SlidersHorizontal`, `ChatCircleDots`, `BookOpen`, `SignOut`, `SidebarSimple` from `@phosphor-icons/react`)
3. **Remove props**: Remove `mobileOpen`, `onMobileOpenChange` props entirely. The sidebar now reads state from `useSidebarStore` instead.
4. **GlassPanel container**: Replace the raw `<aside>` with:
   ```tsx
   <GlassPanel
     as="aside"
     blur="lg"
     opacity={0.7}
     borderGlow
     tint="neutral"
     className={cn(
       "fixed top-3 left-3 bottom-3 z-[var(--z-sidebar)] w-[300px]",
       "flex flex-col overflow-hidden",
       "transition-transform duration-300 ease-[var(--ease-out-cubic)]",
       isOpen ? "translate-x-0" : "-translate-x-[calc(100%+12px)]",
     )}
   >
   ```
5. **Header row**: Logo SVG on left (keep existing SVG), collapse button on right using `<Button variant="ghost" size="sm">` with `<Icon icon={SidebarSimple} size={20} />`, onClick calls `close()` from sidebar store
6. **Separator**: Use `<div className="mx-4 my-2 border-t border-border-glass" />`
7. **Nav items section**: Render 3 `SidebarNavItem` components:
   - "Content Intelligence" with `Lightbulb` icon (active by default — determine active from route or hardcode for now)
   - "Trending Feed" with `TrendUp` icon
   - "Brand Deals" with `Briefcase` icon
8. **Remove**: SocietySelector section, ViewSelector section, and their labels entirely (SIDE-04, SIDE-05 satisfied by removal)
9. **Create test button**: Keep the existing handler logic (`reset()` + `setStatus("selecting-type")`), but wrap in a row with `<Text as="span" size="sm">` for the label and `<Icon icon={Plus} size={16} />` for the icon
10. **Test history**: Keep `<TestHistoryList>` component, wrap in `flex-1 overflow-y-auto px-2` container
11. **Bottom nav**: Migrate to Phosphor icons via `SidebarNavItem`:
    - "Manage Plan" with `SlidersHorizontal` → Phosphor equivalent
    - "Leave Feedback" with `ChatCircleDots`
    - "Product Guide" with `BookOpen`
    - "Log Out" with `SignOut`
12. **Version text**: Use `<Caption className="mt-2 text-center">Version 2.1</Caption>`
13. **Mobile overlay**: Keep the existing mobile overlay div but update it:
    - z-index: `z-[calc(var(--z-sidebar)-1)]` (49, below sidebar)
    - NO backdrop-filter (just `bg-black/50`)
    - Show when `isOpen` on mobile: wrap in conditional `{isOpen && <div className="fixed inset-0 ... md:hidden" onClick={close} />}`
14. **LeaveFeedbackModal**: Keep the sibling modal pattern, it still works

The sidebar should NOT manage its own open/close state — it reads `isOpen` from `useSidebarStore` and calls `close()` via the collapse button.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify compilation. Verify that `SocietySelector` and `ViewSelector` are NOT imported in the new sidebar. Verify `GlassPanel` is used with `as="aside"`. Verify `useSidebarStore` is imported and used.
  </verify>
  <done>
Sidebar renders as a floating GlassPanel with 300px width, inset 12px from top/left/bottom, with glassmorphic blur and border. Nav items use Button ghost + Icon (icon-left, label-right). SocietySelector and ViewSelector are removed. Collapse button calls `useSidebarStore.close()`. Mobile overlay uses bg-black/50 without backdrop-filter. Active nav item has filled background.
  </done>
</task>

<task type="auto">
  <name>Task 2: Migrate test history components to Typography primitives</name>
  <files>src/components/app/test-history-list.tsx, src/components/app/test-history-item.tsx</files>
  <action>
Update both test history components to use design system Typography components, matching the v0 design output.

**test-history-list.tsx:**
- Add `<Caption>` import from `@/components/ui/typography`
- Replace the "Loading history..." and "No tests yet" messages with `<Caption>` components instead of raw `<div className="text-xs text-zinc-600">`
- Add a section header above the list: `<Caption className="px-2 mb-2 uppercase tracking-wider">Recent Tests</Caption>` (matching v0 design)
- Keep all existing logic (hydration guard, delete modal, test selection) unchanged

**test-history-item.tsx:**
- Add `<Text>` and `<Caption>` imports from `@/components/ui/typography`
- Replace the truncated title `<span>` with `<Text as="span" size="sm" className="flex-1 truncate">`
- The active indicator bar color changes from `bg-yellow-500` to `bg-accent` (coral #FF7F50, matching v0 design and brand)
- Update hardcoded color classes: Replace `bg-[rgba(40,40,40,0.5)]` with `bg-active` and `bg-[rgba(40,40,40,0.3)]` with `hover:bg-hover` to use design tokens
- Replace `text-[rgb(184,184,184)]` with `text-foreground-secondary` and `text-white` with `text-foreground`
- Keep the DropdownMenu (three-dot menu) logic unchanged — it works correctly

These changes satisfy SIDE-06 (test history uses Typography).
  </action>
  <verify>
Run `npx tsc --noEmit` to verify compilation. Grep for `Typography` or `Caption` or `Text` imports in both files. Verify `bg-yellow-500` is replaced with `bg-accent`. Verify hardcoded color values are replaced with design tokens.
  </verify>
  <done>
Test history list shows "Recent Tests" caption header. Empty/loading states use Caption component. Test history items use Text for titles and design tokens for colors. Active indicator uses coral accent color. No hardcoded color values remain.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with no errors
2. `grep -r "SocietySelector\|ViewSelector" src/components/app/sidebar.tsx` returns nothing (removed)
3. `grep -r "GlassPanel" src/components/app/sidebar.tsx` confirms GlassPanel usage
4. `grep -r "useSidebarStore" src/components/app/sidebar.tsx` confirms store wiring
5. `grep -r "variant=\"ghost\"" src/components/app/sidebar-nav-item.tsx` confirms Button ghost usage
6. `grep -r "Caption\|Text" src/components/app/test-history` confirms Typography usage
7. Visual: Sidebar appears as a floating panel with visible gap from viewport edges
</verification>

<success_criteria>
- Sidebar renders as GlassPanel with blur="lg", 300px wide, inset 12px from edges
- SocietySelector and ViewSelector completely removed
- Nav items use Button ghost + Icon (Phosphor) with icon-left layout
- 3 nav items: Content Intelligence, Trending Feed, Brand Deals
- Test history uses Text + Caption from Typography
- Active indicator uses coral accent color
- Collapse button inside sidebar calls `useSidebarStore.close()`
- Mobile overlay uses bg-black/50 without backdrop-filter
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/45-structural-foundation/45-02-SUMMARY.md`
</output>
