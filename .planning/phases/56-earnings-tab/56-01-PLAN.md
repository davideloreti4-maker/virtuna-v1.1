---
phase: 56-earnings-tab
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/hooks/useCountUp.ts
  - src/components/app/brand-deals/earnings-stat-cards.tsx
autonomous: true

must_haves:
  truths:
    - "Four stat cards render in a 2x2 grid showing Total Earned, Pending, Paid Out, and This Month"
    - "Stat card values animate from 0 to target with a smooth 2-second count-up on mount"
    - "Each stat card shows a green or red percentage change indicator"
    - "Count-up animation is skipped (static values shown) when prefers-reduced-motion is enabled"
  artifacts:
    - path: "src/hooks/useCountUp.ts"
      provides: "Reusable count-up animation hook using motion MotionValue"
      exports: ["useCountUp"]
    - path: "src/components/app/brand-deals/earnings-stat-cards.tsx"
      provides: "EarningsStatCards component with 2x2 grid of animated stat cards"
      exports: ["EarningsStatCards"]
  key_links:
    - from: "src/hooks/useCountUp.ts"
      to: "src/hooks/usePrefersReducedMotion.ts"
      via: "import usePrefersReducedMotion"
      pattern: "usePrefersReducedMotion"
    - from: "src/components/app/brand-deals/earnings-stat-cards.tsx"
      to: "src/hooks/useCountUp.ts"
      via: "import useCountUp"
      pattern: "useCountUp"
    - from: "src/components/app/brand-deals/earnings-stat-cards.tsx"
      to: "src/lib/affiliate-utils.ts"
      via: "import formatCurrency"
      pattern: "formatCurrency"
---

<objective>
Build the useCountUp hook and EarningsStatCards component -- the 2x2 grid of animated stat cards showing Total Earned, Pending, Paid Out, and This Month with count-up animation and percentage change indicators.

Purpose: Delivers EARN-01 (stat card layout), EARN-02 (count-up animation), EARN-03 (percentage change indicators) as presentational components ready for the EarningsTab container.
Output: Two files -- a reusable hook and a presentational stat cards component.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/56-earnings-tab/56-RESEARCH.md

@src/hooks/usePrefersReducedMotion.ts
@src/lib/affiliate-utils.ts
@src/types/brand-deals.ts
@src/components/app/brand-deals/affiliate-link-card.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useCountUp hook</name>
  <files>src/hooks/useCountUp.ts</files>
  <action>
Create a reusable count-up animation hook at `src/hooks/useCountUp.ts`.

The hook accepts:
- `to: number` -- target value
- `duration?: number` -- animation duration (default 2 seconds)
- `format?: (value: number) => string` -- optional formatting function

Implementation:
1. `"use client"` directive at top
2. Import `useEffect` from react, `useMotionValue`, `useTransform`, `animate` from `motion/react`, and `usePrefersReducedMotion` from `@/hooks/usePrefersReducedMotion`
3. Create `UseCountUpOptions` interface with the three params above
4. Inside the hook:
   - `const prefersReducedMotion = usePrefersReducedMotion()`
   - `const count = useMotionValue(0)`
   - `const display = useTransform(count, (latest) => { const val = Math.round(latest); return format ? format(val) : val.toString(); })`
   - `useEffect` that:
     - If `prefersReducedMotion`, calls `count.jump(to)` and returns
     - Otherwise, calls `const animation = animate(count, to, { duration, ease: "easeOut" })`
     - Returns cleanup: `() => animation.stop()`
   - Dependencies: `[to, duration, prefersReducedMotion, count]`
5. Returns `display` (a `MotionValue<string>`)

Export the hook as a named export. Export the `UseCountUpOptions` interface.

IMPORTANT: The returned value is a MotionValue -- consumers MUST render it inside a `<motion.span>` element (not a regular `<span>`). Add a JSDoc comment noting this.
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors. Check that the file exports `useCountUp` and `UseCountUpOptions`.
  </verify>
  <done>
`useCountUp` hook exists at `src/hooks/useCountUp.ts`, accepts `to`/`duration`/`format` options, uses `useMotionValue` + `useTransform` + `animate`, respects `usePrefersReducedMotion` by calling `count.jump(to)` when reduced motion is preferred, and returns a `MotionValue<string>`.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create EarningsStatCards component</name>
  <files>src/components/app/brand-deals/earnings-stat-cards.tsx</files>
  <action>
Create the EarningsStatCards presentational component at `src/components/app/brand-deals/earnings-stat-cards.tsx`.

**Props interface:**
```typescript
interface EarningsStatCardsProps {
  stats: {
    totalEarned: number;
    pending: number;
    paidOut: number;
    thisMonth: number;
  };
}
```

**StatCard internal component (not exported):**

Props: `{ icon: React.ReactNode; label: string; value: number; change: number; isCurrency?: boolean }`

1. Uses `useCountUp` hook with `to: value` and `format: isCurrency ? formatCurrency : (v) => formatNumber(v)`
2. Renders a card with:
   - `rounded-xl border border-border bg-surface-elevated p-5` (solid card, same pattern as deal cards)
   - Top row: icon + uppercase label (text-xs font-medium uppercase tracking-wider text-foreground-muted)
   - Middle: `<motion.span className="text-2xl font-bold text-foreground">{display}</motion.span>` -- MUST use motion.span for MotionValue rendering
   - Bottom: percentage change indicator -- `text-xs font-medium` with `text-green-400` for positive, `text-red-400` for negative. Format: `+12.5%` or `-3.2%`. Use ArrowUp/ArrowDown icons from Phosphor (size 12) inline.
3. `isCurrency` defaults to `true`

**EarningsStatCards component:**

Renders a `grid grid-cols-2 gap-4` (2x2 grid) with four StatCard instances:

| Card | Icon | Label | Value Key | Change | isCurrency |
|------|------|-------|-----------|--------|------------|
| Total Earned | CurrencyDollar (weight="fill") | "Total Earned" | stats.totalEarned | +12.5 | true |
| Pending | Wallet (weight="fill") | "Pending" | stats.pending | -3.2 | true |
| Paid Out | ArrowCircleUp (weight="fill") | "Paid Out" | stats.paidOut | +8.7 | true |
| This Month | CalendarBlank (weight="fill") | "This Month" | stats.thisMonth | +24.1 | true |

Notes:
- Percentage change values are hardcoded alongside the cards (mock data doesn't include them -- see RESEARCH.md Open Questions)
- Icons from `@phosphor-icons/react` at size 18
- ArrowUp/ArrowDown in the change indicator are separate from the card icon -- they are tiny directional arrows (size 12)
- Import `formatCurrency` and `formatNumber` from `@/lib/affiliate-utils`
- File must have `"use client"` directive
  </action>
  <verify>
Run `npx tsc --noEmit` to verify no type errors. Verify the component exports `EarningsStatCards` and the props interface `EarningsStatCardsProps`.
  </verify>
  <done>
`EarningsStatCards` component renders a 2x2 grid of four stat cards (Total Earned, Pending, Paid Out, This Month) with count-up animation via `useCountUp`, green/red percentage change indicators with directional arrows, and proper dark-themed Raycast-style card styling. Values are formatted with `formatCurrency` via `Intl.NumberFormat`.
  </done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes with zero errors
2. `EarningsStatCards` renders 4 cards in a 2x2 grid layout
3. Each card has: Phosphor icon, uppercase label, animated currency value, green/red percentage change
4. `useCountUp` hook properly respects `usePrefersReducedMotion`
5. All monetary values formatted via `formatCurrency` (Intl.NumberFormat USD)
</verification>

<success_criteria>
- Four stat cards display Total Earned, Pending, Paid Out, and This Month in a 2x2 grid
- Values animate from 0 to target over ~2 seconds using motion's useMotionValue + animate
- Each card shows a green (+) or red (-) percentage change indicator with directional arrow
- Animation is skipped (static values shown immediately) when prefers-reduced-motion is enabled
- No TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/56-earnings-tab/56-01-SUMMARY.md`
</output>
