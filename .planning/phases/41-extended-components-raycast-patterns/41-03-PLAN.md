---
phase: 41-extended-components-raycast-patterns
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/select.tsx
autonomous: true

must_haves:
  truths:
    - "Select dropdown opens on click and closes on ESC or click-outside"
    - "Arrow keys navigate options, Enter/Space selects, Home/End jump to first/last"
    - "Searchable variant filters options as user types"
    - "Selected option displays in the trigger with check mark in dropdown"
    - "Option groups with labels render correctly"
  artifacts:
    - path: "src/components/ui/select.tsx"
      provides: "Select and SearchableSelect with keyboard navigation, groups, CVA sizing"
      exports: ["Select", "SearchableSelect", "SelectProps", "SearchableSelectProps"]
  key_links:
    - from: "src/components/ui/select.tsx"
      to: "src/components/primitives/GlassSelect.tsx"
      via: "Refactored from primitive, same keyboard nav logic"
      pattern: "handleKeyDown"
---

<objective>
Build the Select/Dropdown component by refactoring the existing 700-line GlassSelect primitive into the canonical ui/ pattern.

Purpose: Deliver accessible Select (CMX-01) with keyboard navigation, searchable variant, and option groups — all using semantic tokens and CVA variants.

Output: `select.tsx` in `src/components/ui/`
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/41-extended-components-raycast-patterns/41-RESEARCH.md

# Source primitive (preserve keyboard nav logic, refactor styling)
@src/components/primitives/GlassSelect.tsx

# Established pattern
@src/components/ui/button.tsx
@src/components/ui/input.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Select component with keyboard navigation and CVA variants</name>
  <files>src/components/ui/select.tsx</files>
  <action>
Create `src/components/ui/select.tsx` by refactoring GlassSelect.tsx to follow the ui/ component pattern.

**Core interfaces:**
```typescript
interface SelectOption {
  value: string;
  label: string;
  disabled?: boolean;
}

interface SelectGroup {
  label: string;
  options: SelectOption[];
}

interface SelectProps {
  options: (SelectOption | SelectGroup)[];
  value?: string;
  defaultValue?: string;
  onChange?: (value: string) => void;
  placeholder?: string;
  disabled?: boolean;
  size?: "sm" | "md" | "lg";
  error?: boolean;
  className?: string;
}

interface SearchableSelectProps extends SelectProps {
  searchPlaceholder?: string;
  noResultsText?: string;
}
```

**Select trigger (CVA):**
```
cva("w-full rounded-lg flex items-center justify-between border transition-all cursor-pointer", {
  variants: {
    size: {
      sm: "h-8 px-3 text-sm gap-2",
      md: "h-10 px-4 text-base gap-2",
      lg: "h-12 px-5 text-lg gap-3",
    }
  },
  defaultVariants: { size: "md" }
})
```
- Default state: `bg-surface border-border-glass text-foreground`
- Open state: `border-accent/50 ring-2 ring-accent/20`
- Error state: `border-error/50`
- Disabled: `opacity-50 cursor-not-allowed`
- Chevron icon: CaretDown from Phosphor, rotates 180deg when open

**Dropdown panel:**
- Position: absolute, full-width, below trigger with 4px gap
- Z-index: `z-[var(--z-dropdown)]` (100)
- Styling: `bg-surface-elevated border border-border-glass rounded-lg shadow-xl overflow-hidden`
- Glass effect: inline `backdropFilter: blur(12px)` + `WebkitBackdropFilter: blur(12px)`
- Max height: `max-h-60 overflow-y-auto` with scrollbar styling

**Option items:**
- Base: `flex items-center gap-2 px-4 py-2 text-sm cursor-pointer transition-colors`
- Highlighted (keyboard/hover): `bg-white/5 text-foreground`
- Selected: check mark icon (Check from Phosphor) on the right
- Disabled: `opacity-50 cursor-not-allowed`
- Group label: `px-4 py-1.5 text-xs font-medium text-foreground-tertiary uppercase tracking-wider`

**Keyboard navigation (preserve from GlassSelect):**
- ArrowDown/ArrowUp: move highlight (skip disabled, wrap around)
- Home/End: jump to first/last
- Enter/Space: select highlighted option, close dropdown
- Escape: close dropdown without selecting
- Tab: close dropdown (move focus naturally)
- Type-ahead: when NOT searchable, typing characters jumps to matching option

**Click-outside:** Use `useEffect` with `mousedown` event listener to close when clicking outside the component ref.

**Scroll into view:** When keyboard-navigating, scroll the highlighted option into view using `scrollIntoView({ block: "nearest" })`.

**SearchableSelect:**
- Same as Select but adds a search input at the top of the dropdown panel
- Input styled like the existing `Input` component (use same tokens)
- Filters options by label (case-insensitive `.includes()`)
- Empty state: `<div className="px-4 py-8 text-center text-sm text-foreground-tertiary">No results found</div>`
- Search input auto-focuses when dropdown opens
- Arrow keys still navigate filtered results

**Key refactoring from GlassSelect:**
- Replace all `var(--color-*)` with Tailwind semantic classes (bg-surface, text-foreground, border-border-glass, etc.)
- Replace hardcoded z-50 with `z-[var(--z-dropdown)]`
- Add CVA size variants
- Add forwardRef to the outer container
- Add JSDoc examples
- Use "use client" directive
- Include both `backdropFilter` and `WebkitBackdropFilter`

**Do NOT:**
- Install @radix-ui/react-select (keep custom implementation per research recommendation)
- Use portal rendering (absolute positioning within parent is sufficient)
- Break the existing keyboard navigation logic from GlassSelect
  </action>
  <verify>
`npx tsc --noEmit` — no type errors. Verify keyboard navigation: ArrowDown, ArrowUp, Enter, Escape, Home, End handlers exist in the code. Verify no `var(--color-` references remain (should all be Tailwind classes). Verify `z-[var(--z-dropdown)]` is used instead of hardcoded z-index.
  </verify>
  <done>
Select component compiles with TypeScript, has 3 sizes via CVA, full keyboard navigation, option groups with labels, searchable variant with type-to-filter, uses semantic tokens, proper z-index token for dropdown layer. Both Select and SearchableSelect exported.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes
- No `var(--color-` CSS variable references in the file (all converted to Tailwind semantics)
- `z-[var(--z-dropdown)]` present (not z-50 or z-[9999])
- `WebkitBackdropFilter` present alongside `backdropFilter`
- Keyboard handlers for ArrowUp, ArrowDown, Enter, Escape, Home, End all present
- Both `Select` and `SearchableSelect` are exported
</verification>

<success_criteria>
- Select opens dropdown on click, navigates with keyboard, selects with Enter
- SearchableSelect filters options as user types
- Groups render with label separators
- Glass styling with proper z-index layering
- No hardcoded color values — all semantic tokens
</success_criteria>

<output>
After completion, create `.planning/phases/41-extended-components-raycast-patterns/41-03-SUMMARY.md`
</output>
