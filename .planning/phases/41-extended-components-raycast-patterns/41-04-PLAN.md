---
phase: 41-extended-components-raycast-patterns
plan: 04
type: execute
wave: 1
depends_on: []
files_modified:
  - src/components/ui/toast.tsx
  - src/components/ui/kbd.tsx
  - src/components/ui/shortcut-badge.tsx
autonomous: true

must_haves:
  truths:
    - "Toast notifications appear in top-right corner and auto-dismiss after configurable duration"
    - "Toast renders success, error, warning, info variants with appropriate icons and colors"
    - "Kbd renders a 3D keycap with exact Raycast 4-layer box shadow"
    - "ShortcutBadge displays modifier+key combinations like Cmd+K with proper symbols"
  artifacts:
    - path: "src/components/ui/toast.tsx"
      provides: "Toast system with ToastProvider, useToast hook, 4 variants"
      exports: ["ToastProvider", "useToast", "Toast"]
    - path: "src/components/ui/kbd.tsx"
      provides: "Keyboard key cap visualization with Raycast 3D shadow"
      exports: ["Kbd", "KbdProps"]
    - path: "src/components/ui/shortcut-badge.tsx"
      provides: "Shortcut badge composing Kbd components for modifier+key displays"
      exports: ["ShortcutBadge", "ShortcutBadgeProps"]
  key_links:
    - from: "src/components/ui/shortcut-badge.tsx"
      to: "src/components/ui/kbd.tsx"
      via: "import Kbd"
      pattern: "import.*Kbd.*from.*kbd"
    - from: "src/components/ui/toast.tsx"
      to: "React.createContext"
      via: "ToastContext for global state"
      pattern: "createContext"
---

<objective>
Build Toast notification system, Kbd keycap visualization, and ShortcutBadge component.

Purpose: Deliver Toast (CMX-03) for user feedback, Kbd (RAY-01) for iconic Raycast keycap rendering, and ShortcutBadge (RAY-02) for keyboard shortcut displays. Kbd's 4-layer shadow is the pixel-critical Raycast element.

Output: `toast.tsx`, `kbd.tsx`, `shortcut-badge.tsx` in `src/components/ui/`
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/41-extended-components-raycast-patterns/41-RESEARCH.md

# Reference primitives
@src/components/primitives/GlassToast.tsx
@src/components/primitives/GlassAlert.tsx
@src/components/primitives/Kbd.tsx

# Established pattern
@src/components/ui/button.tsx
@src/app/globals.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Toast notification system with provider and hook</name>
  <files>src/components/ui/toast.tsx</files>
  <action>
Create `src/components/ui/toast.tsx` refactoring GlassToast + GlassAlert into a unified toast system.

**Architecture:**
- `ToastProvider` — React context provider, manages toast state array, renders toast container
- `useToast()` — hook returning `{ toast, dismiss, dismissAll }` functions
- `Toast` — individual toast component (internal, rendered by provider)

**Toast interface:**
```typescript
type ToastVariant = "default" | "success" | "error" | "warning" | "info";

interface ToastData {
  id: string;
  variant: ToastVariant;
  title: string;
  description?: string;
  duration?: number;      // ms, default 5000
  action?: {
    label: string;
    onClick: () => void;
  };
}

// Hook API
interface UseToast {
  toast: (options: Omit<ToastData, "id">) => string;  // returns id
  dismiss: (id: string) => void;
  dismissAll: () => void;
}
```

**Toast container:**
- Position: `fixed top-4 right-4 z-[var(--z-toast)]` (z-index 500)
- Layout: `flex flex-col gap-3 w-[380px] max-w-[calc(100vw-2rem)]`
- Max toasts visible: 5 (oldest auto-removed when exceeded)

**Individual toast styling:**
- Base: `rounded-lg border p-4 shadow-lg` with glass effect (`backdropFilter: blur(12px)`, `WebkitBackdropFilter: blur(12px)`)
- Variant colors:
  - default: `bg-surface-elevated border-border-glass`
  - success: `bg-success/10 border-success/20`
  - error: `bg-error/10 border-error/20`
  - warning: `bg-warning/10 border-warning/20`
  - info: `bg-info/10 border-info/20`
- Icons (Phosphor): CheckCircle (success), XCircle (error), Warning (warning), Info (info)
- Icon color matches variant: `text-success`, `text-error`, `text-warning`, `text-info`
- Title: `text-sm font-medium text-foreground`
- Description: `text-xs text-foreground-secondary mt-1`
- Close button: X icon, top-right, `text-foreground-tertiary hover:text-foreground`

**Auto-dismiss:**
- Default duration: 5000ms
- Progress bar at bottom: thin line (2px height) that shrinks from 100% to 0% width over duration
- Progress bar color matches variant
- On hover: pause timer (clear interval), resume on mouse leave
- `duration: 0` means persistent (no auto-dismiss)

**Enter/exit animation (CSS):**
- Enter: slide in from right + fade in (`@keyframes slide-in-right { from { transform: translateX(100%); opacity: 0 } to { transform: translateX(0); opacity: 1 } }`)
- Exit: slide out to right + fade out
- Duration: 200ms ease-out enter, 150ms ease-in exit
- Use `motion-reduce:` to disable slide, keep instant appear/disappear

**Action button:**
- If `action` provided, render small button: `text-xs font-medium px-2 py-1 rounded bg-white/5 hover:bg-white/10 text-foreground`

**Important:**
- Single ToastProvider for the entire app — document in JSDoc that it goes in layout.tsx
- Generate unique IDs with `crypto.randomUUID()` or counter
- Do NOT create duplicate provider if primitives/ already has one — this replaces it
  </action>
  <verify>
`npx tsc --noEmit` — no type errors. Verify: ToastProvider, useToast, and Toast are exported. Verify z-[var(--z-toast)] is used.
  </verify>
  <done>
Toast system compiles with provider + hook pattern, 5 variants with matching icons and colors, auto-dismiss with progress bar and hover-pause, action button support, glass styling with proper z-index.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create Kbd and ShortcutBadge components</name>
  <files>src/components/ui/kbd.tsx, src/components/ui/shortcut-badge.tsx</files>
  <action>
**Kbd component (`kbd.tsx`):**

Create `src/components/ui/kbd.tsx` promoting the existing Kbd.tsx primitive with exact Raycast shadow values preserved.

Interface:
```typescript
interface KbdProps extends React.HTMLAttributes<HTMLElement> {
  size?: "sm" | "md" | "lg";
  highlighted?: boolean;
}
```

**Critical: Preserve exact 4-layer shadow from extraction:**
```typescript
const KEYCAP_SHADOW = [
  "rgba(0, 0, 0, 0.4) 0px 1.5px 0.5px 2.5px",     // outer depth
  "rgb(0, 0, 0) 0px 0px 0.5px 1px",                 // border shadow
  "rgba(0, 0, 0, 0.25) 0px 2px 1px 1px inset",      // bottom 3D recess
  "rgba(255, 255, 255, 0.2) 0px 1px 1px 1px inset",  // top highlight
].join(", ");
```

Highlighted variant adds coral glow: `", 0 0 8px oklch(0.72 0.16 40 / 0.3)"`

CVA size variants:
- sm: `min-w-[20px] h-5 px-1 text-[10px]`
- md: `min-w-[24px] h-6 px-1.5 text-xs`
- lg: `min-w-[28px] h-7 px-2 text-sm`

Base styling:
- `inline-flex items-center justify-center rounded-md font-medium font-mono`
- `border border-white/10`
- Background gradient: `linear-gradient(180deg, rgb(18, 18, 18), rgb(13, 13, 13))` (via inline style)
- `text-foreground-secondary`
- `select-none` (not selectable)

Render as `<kbd>` element for semantic HTML.

**ShortcutBadge component (`shortcut-badge.tsx`):**

Create `src/components/ui/shortcut-badge.tsx` composing Kbd components.

Interface:
```typescript
interface ShortcutBadgeProps {
  keys: string[];              // e.g., ["cmd", "K"] or ["shift", "alt", "P"]
  separator?: "plus" | "none"; // "plus" shows + between keys, "none" shows gap only
  size?: "sm" | "md" | "lg";
  highlighted?: boolean;
  className?: string;
}
```

**Modifier key mapping (symbols):**
```typescript
const MODIFIER_SYMBOLS: Record<string, string> = {
  cmd: "⌘",
  command: "⌘",
  shift: "⇧",
  alt: "⌥",
  option: "⌥",
  ctrl: "⌃",
  control: "⌃",
  enter: "↵",
  return: "↵",
  backspace: "⌫",
  delete: "⌦",
  tab: "⇥",
  escape: "Esc",
  space: "Space",
  up: "↑",
  down: "↓",
  left: "←",
  right: "→",
};
```

For non-modifier keys (single letters, numbers), render uppercase: `"k"` -> `"K"`.

Rendering:
- `inline-flex items-center gap-1`
- For each key in `keys`: render `<Kbd size={size} highlighted={highlighted}>{resolvedKey}</Kbd>`
- If separator is "plus": render `<span className="text-foreground-tertiary text-xs mx-0.5">+</span>` between keys
- Default separator: "none" (just gap)

JSDoc example:
```tsx
// Renders: [⌘] [K]
<ShortcutBadge keys={["cmd", "K"]} />

// Renders: [⇧] + [⌥] + [P]
<ShortcutBadge keys={["shift", "alt", "P"]} separator="plus" />
```
  </action>
  <verify>
`npx tsc --noEmit` — no type errors. Verify the exact 4-layer KEYCAP_SHADOW string exists in kbd.tsx. Verify ShortcutBadge imports Kbd from "./kbd".
  </verify>
  <done>
Kbd renders 3D keycap with exact Raycast 4-layer shadow (not approximated), 3 sizes, highlighted variant with coral glow. ShortcutBadge composes Kbd components with modifier symbol mapping, optional separator.
  </done>
</task>

</tasks>

<verification>
- `npx tsc --noEmit` passes for all three files
- toast.tsx uses `z-[var(--z-toast)]` (not hardcoded)
- toast.tsx includes `WebkitBackdropFilter` alongside `backdropFilter`
- kbd.tsx contains exact 4-layer shadow string from Raycast extraction
- shortcut-badge.tsx imports from "./kbd"
- Toast has `motion-reduce:` consideration
- All files follow button.tsx pattern: "use client" where needed, forwardRef, cn(), displayName
</verification>

<success_criteria>
- Toast appears top-right, auto-dismisses with progress bar, pauses on hover
- Kbd looks like a physical key with 3D depth (4-layer shadow)
- ShortcutBadge renders Cmd+K style shortcuts with proper modifier symbols
- All use semantic tokens, no hardcoded colors
</success_criteria>

<output>
After completion, create `.planning/phases/41-extended-components-raycast-patterns/41-04-SUMMARY.md`
</output>
