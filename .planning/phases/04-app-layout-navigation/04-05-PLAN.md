---
phase: 04-app-layout-navigation
plan: 05
type: execute
wave: 4
depends_on: ["04-02", "04-03", "04-04"]
files_modified:
  - src/components/app/sidebar.tsx
  - src/components/app/mobile-nav.tsx
  - src/components/app/auth-guard.tsx
  - src/app/(app)/layout.tsx
  - src/components/app/index.ts
autonomous: true

must_haves:
  truths:
    - "On mobile (<768px), sidebar is hidden by default"
    - "Hamburger button appears on mobile to open sidebar drawer"
    - "Sidebar slides in as drawer on mobile"
    - "Brief skeleton loading state shows before dashboard content"
    - "Auth guard wraps app layout children"
  artifacts:
    - path: "src/components/app/mobile-nav.tsx"
      provides: "Mobile hamburger trigger"
      min_lines: 20
    - path: "src/components/app/auth-guard.tsx"
      provides: "Mock auth guard with skeleton"
      contains: "isLoading"
  key_links:
    - from: "src/app/(app)/layout.tsx"
      to: "src/components/app/auth-guard.tsx"
      via: "wraps children"
      pattern: "AuthGuard"
---

<objective>
Add mobile drawer navigation and mock auth guard with skeleton loading.

Purpose: Complete the responsive experience for mobile users and add polish with a brief loading state that simulates auth checking. This prepares the app shell for real auth integration later.

Output: Mobile-responsive sidebar drawer and auth guard wrapper with skeleton.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/STATE.md
@.planning/phases/04-app-layout-navigation/04-RESEARCH.md
@.planning/phases/04-app-layout-navigation/04-CONTEXT.md
@src/components/app/sidebar.tsx
@src/app/(app)/layout.tsx
@src/components/ui/skeleton.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add mobile drawer behavior to Sidebar</name>
  <files>
    src/components/app/sidebar.tsx
    src/components/app/mobile-nav.tsx
  </files>
  <action>
Update Sidebar to support mobile drawer pattern and create MobileNav trigger.

**Update Sidebar component:**

Add state for mobile open:
```typescript
const [mobileOpen, setMobileOpen] = useState(false);
```

Update sidebar aside element classes:
```typescript
<aside
  className={cn(
    "fixed left-0 top-0 z-50 h-screen w-[248px] flex-col border-r border-zinc-800 bg-[#0A0A0A] p-4 transition-transform duration-200",
    // Desktop: always visible, static positioning
    "md:static md:translate-x-0 md:flex",
    // Mobile: hidden by default, slides in when open
    mobileOpen ? "flex translate-x-0" : "hidden -translate-x-full"
  )}
>
```

Add mobile close button inside sidebar (top right, md:hidden):
```typescript
<button
  className="absolute right-4 top-4 p-2 text-zinc-400 hover:text-white md:hidden"
  onClick={() => setMobileOpen(false)}
  aria-label="Close menu"
>
  <X className="h-5 w-5" />
</button>
```

Add overlay when mobile menu open:
```typescript
{mobileOpen && (
  <div
    className="fixed inset-0 z-40 bg-black/50 md:hidden"
    onClick={() => setMobileOpen(false)}
    aria-hidden="true"
  />
)}
```

Export setMobileOpen or use context (simplest: add onMobileOpen prop or export a hook).

**For simplicity, use a prop pattern:**
- Sidebar accepts `mobileOpen` and `onMobileOpenChange` props
- Parent (layout) manages the state
- This avoids needing context

**Create MobileNav component:**
```typescript
// src/components/app/mobile-nav.tsx
"use client";

import { Menu } from "lucide-react";

interface MobileNavProps {
  onMenuClick: () => void;
}

export function MobileNav({ onMenuClick }: MobileNavProps) {
  return (
    <button
      className="fixed left-4 top-4 z-50 rounded-lg bg-zinc-900/80 p-2 backdrop-blur-sm md:hidden"
      onClick={onMenuClick}
      aria-label="Open menu"
    >
      <Menu className="h-6 w-6 text-white" />
    </button>
  );
}
```

Note: The button appears fixed on mobile only (md:hidden).
  </action>
  <verify>
1. Resize browser to mobile width (<768px)
2. Sidebar should be hidden
3. Hamburger button visible at top-left
4. Click hamburger - sidebar slides in from left
5. Click X or overlay - sidebar slides out
6. Resize to desktop - sidebar always visible
  </verify>
  <done>
- Sidebar hidden by default on mobile
- Hamburger button triggers drawer
- Drawer slides in with animation
- Overlay closes drawer on tap
  </done>
</task>

<task type="auto">
  <name>Task 2: Create AuthGuard with skeleton loading</name>
  <files>src/components/app/auth-guard.tsx</files>
  <action>
Create mock auth guard that shows skeleton then renders children.

**Component structure:**
```typescript
"use client";

import { useEffect, useState } from "react";
import { Skeleton } from "@/components/ui/skeleton";

interface AuthGuardProps {
  children: React.ReactNode;
}

export function AuthGuard({ children }: AuthGuardProps) {
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    // Mock auth check - always resolves to "logged in" after delay
    const timer = setTimeout(() => {
      setIsLoading(false);
    }, 350); // Brief delay for polish

    return () => clearTimeout(timer);
  }, []);

  if (isLoading) {
    return <AppShellSkeleton />;
  }

  return <>{children}</>;
}
```

**AppShellSkeleton component (inside same file or separate):**
```typescript
function AppShellSkeleton() {
  return (
    <div className="flex h-screen bg-[#0A0A0A]">
      {/* Sidebar skeleton */}
      <div className="hidden w-[248px] flex-col border-r border-zinc-800 p-4 md:flex">
        <Skeleton className="mb-6 h-8 w-24" />
        <div className="space-y-2">
          <Skeleton className="h-3 w-20" />
          <Skeleton className="h-10 w-full" />
        </div>
        <div className="mt-4 space-y-2">
          <Skeleton className="h-3 w-20" />
          <Skeleton className="h-10 w-full" />
        </div>
        <div className="mt-4">
          <Skeleton className="h-10 w-full" />
        </div>
        <div className="mt-auto space-y-2">
          <Skeleton className="h-8 w-full" />
          <Skeleton className="h-8 w-full" />
          <Skeleton className="h-8 w-full" />
          <Skeleton className="h-8 w-full" />
        </div>
      </div>
      {/* Main content skeleton */}
      <div className="flex-1 p-6">
        <div className="flex items-center justify-between">
          <Skeleton className="h-8 w-32" />
          <div className="flex gap-2">
            <Skeleton className="h-8 w-28 rounded-full" />
            <Skeleton className="h-8 w-28 rounded-full" />
          </div>
        </div>
        <Skeleton className="mt-4 h-full w-full rounded-lg" />
      </div>
    </div>
  );
}
```

**Key details:**
- 350ms delay feels snappy but noticeable
- Skeleton mimics the actual layout structure
- Dark background matches app theme
- Hidden sidebar skeleton on mobile (md:flex)
  </action>
  <verify>
1. Refresh /dashboard page
2. Brief skeleton appears for ~350ms
3. Then full dashboard renders
4. No flash of unstyled content
  </verify>
  <done>
- AuthGuard shows skeleton for 350ms
- Then renders children
- Skeleton matches app shell structure
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate mobile nav and auth guard into app layout</name>
  <files>
    src/app/(app)/layout.tsx
    src/components/app/index.ts
  </files>
  <action>
Update app layout to use AuthGuard and mobile navigation state.

**Update app layout:**
```typescript
"use client";

import { useState } from "react";
import { Sidebar, MobileNav, AuthGuard } from "@/components/app";

export default function AppLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);

  return (
    <AuthGuard>
      <div className="flex h-screen bg-[#0A0A0A]">
        <MobileNav onMenuClick={() => setMobileMenuOpen(true)} />
        <Sidebar
          mobileOpen={mobileMenuOpen}
          onMobileOpenChange={setMobileMenuOpen}
        />
        <main className="flex-1 overflow-auto">
          {children}
        </main>
      </div>
    </AuthGuard>
  );
}
```

**Update Sidebar props interface:**
```typescript
interface SidebarProps {
  mobileOpen?: boolean;
  onMobileOpenChange?: (open: boolean) => void;
}
```

**Update barrel exports:**
```typescript
export { AuthGuard } from "./auth-guard";
export { MobileNav } from "./mobile-nav";
```

**Note about "use client":**
Since we're using useState for mobile menu, the layout needs to be a client component. This is acceptable for the app layout since it manages interactive state.

If metadata is needed, extract it to a separate config or use generateMetadata in page.tsx.
  </action>
  <verify>
1. Run `npm run dev`
2. Visit /dashboard - skeleton shows briefly, then dashboard loads
3. Desktop: sidebar visible, hamburger hidden
4. Mobile: hamburger visible, sidebar hidden until triggered
5. Mobile drawer opens/closes correctly
6. Run `npm run build` - passes
  </verify>
  <done>
- App layout uses AuthGuard wrapper
- Mobile navigation integrated
- Sidebar accepts mobile props
- Build passes
  </done>
</task>

</tasks>

<verification>
1. Visit /dashboard - brief skeleton, then content
2. Desktop (>768px): sidebar always visible
3. Mobile (<768px): hamburger visible, sidebar as drawer
4. Drawer opens on hamburger click
5. Drawer closes on X, overlay tap, or navigation
6. Build passes
7. No hydration warnings
</verification>

<success_criteria>
- AuthGuard shows skeleton for ~350ms before content
- Mobile navigation works with slide-out drawer
- Hamburger button appears on mobile only
- Overlay and close button dismiss drawer
- Desktop sidebar unaffected
- No hydration mismatches (CSS-only responsive)
</success_criteria>

<output>
After completion, create `.planning/phases/04-app-layout-navigation/04-05-SUMMARY.md`
</output>
