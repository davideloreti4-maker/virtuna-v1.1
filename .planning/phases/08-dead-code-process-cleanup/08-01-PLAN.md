---
phase: 08-dead-code-process-cleanup
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/api/auth/callback/route.ts
  - src/app/api/referral/generate/route.ts
  - src/app/api/referral/stats/route.ts
  - src/lib/whop/config.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Orphaned /api/auth/callback route no longer exists (real callback is /auth/callback)"
    - "Unused /api/referral/generate and /api/referral/stats routes no longer exist (referrals page queries Supabase directly)"
    - "getTierFromPlanId export removed from whop config (no consumers exist)"
    - "Build succeeds with zero TypeScript errors after deletions"
  artifacts:
    - path: "src/lib/whop/config.ts"
      provides: "Whop tier config without dead getTierFromPlanId export"
      exports: ["VirtunaTier", "SubscriptionStatus", "TIER_HIERARCHY", "WHOP_PRODUCT_IDS", "mapWhopProductToTier", "hasAccessToTier"]
  key_links: []
---

<objective>
Delete orphaned API routes and remove unused exports identified by the v1.0 milestone audit.

Purpose: Close 3 integration gaps — orphaned /api/auth/callback (duplicate of /auth/callback), unused /api/referral/generate and /api/referral/stats (referrals page does direct Supabase queries), and unconsumed getTierFromPlanId export.

Output: Cleaner codebase with no dead API routes and no unused exports.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete orphaned API routes</name>
  <files>
    src/app/api/auth/callback/route.ts
    src/app/api/referral/generate/route.ts
    src/app/api/referral/stats/route.ts
  </files>
  <action>
Delete 3 orphaned API route files and their parent directories:

1. `rm -rf src/app/api/auth/callback/` — This is an orphaned duplicate. The real auth callback lives at `src/app/auth/callback/route.ts` (referenced by login-form.tsx and signup-form.tsx via `${origin}/auth/callback`). The `/api/auth/callback` version is never referenced.

2. `rm -rf src/app/api/referral/generate/` — The referrals page (`src/app/(app)/referrals/page.tsx`) queries Supabase directly for referral code generation. This API route duplicates that logic and is never called from any client code.

3. `rm -rf src/app/api/referral/stats/` — Same as above. The referrals page queries referral_clicks and referral_conversions tables directly. This API route is never called.

After deletion, check if `src/app/api/referral/` directory is empty and remove it if so. Also check if `src/app/api/auth/` is empty and remove it if so (the auth directory may contain other routes — only remove if completely empty).

Verify no imports reference these deleted paths:
- `grep -r "api/auth/callback" src/` should only match middleware PUBLIC_PATHS entry (which is the path matcher, not an import)
- `grep -r "api/referral" src/` should return zero results
  </action>
  <verify>
Run `npx tsc --noEmit` — must pass with zero errors.
Run `grep -r "api/referral/generate\|api/referral/stats" src/` — must return zero results.
Confirm `src/app/api/auth/callback/` directory no longer exists.
Confirm `src/app/api/referral/generate/` directory no longer exists.
Confirm `src/app/api/referral/stats/` directory no longer exists.
  </verify>
  <done>All 3 orphaned API routes deleted. No remaining imports or references. TypeScript compilation passes.</done>
</task>

<task type="auto">
  <name>Task 2: Remove unused getTierFromPlanId export</name>
  <files>src/lib/whop/config.ts</files>
  <action>
Remove the `getTierFromPlanId` function (lines 26-28) from `src/lib/whop/config.ts`.

This function is exported but never imported anywhere in the codebase (confirmed via grep — only match is the definition itself). It maps a plan ID string to a Whop product ID, but all tier resolution goes through `mapWhopProductToTier` instead.

Keep all other exports intact:
- `VirtunaTier` type
- `SubscriptionStatus` type
- `TIER_HIERARCHY` const
- `WHOP_PRODUCT_IDS` const
- `mapWhopProductToTier` function
- `hasAccessToTier` function
  </action>
  <verify>
Run `npx tsc --noEmit` — must pass.
Run `grep -r "getTierFromPlanId" src/` — must return zero results.
Read `src/lib/whop/config.ts` and confirm function is gone, other exports remain.
  </verify>
  <done>getTierFromPlanId export removed. File retains all other exports. TypeScript compilation passes with zero errors.</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` passes — no broken imports from deleted files
2. `npm run build` succeeds — no build errors
3. `find src/app/api/auth/callback -type f 2>/dev/null` returns nothing
4. `find src/app/api/referral -type f 2>/dev/null` returns nothing
5. `grep -r "getTierFromPlanId" src/` returns nothing
</verification>

<success_criteria>
- 3 orphaned API routes deleted (auth/callback, referral/generate, referral/stats)
- getTierFromPlanId export removed from whop config
- Zero TypeScript errors
- Zero broken imports
- Build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/08-dead-code-process-cleanup/08-01-SUMMARY.md`
</output>
