---
phase: 20-visualization-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/components/app/progressive-visualization.tsx
  - src/components/app/visualization-reset-button.tsx
autonomous: true

must_haves:
  truths:
    - "Pan/zoom works with mouse drag and scroll wheel on desktop"
    - "Pan/zoom works with pinch and drag gestures on touch devices"
    - "Reset button appears after user moves view and resets to initial state"
    - "Orb is centered in the canvas on initial load"
  artifacts:
    - path: "src/components/app/progressive-visualization.tsx"
      provides: "ProgressiveVisualization component with pan/zoom wrapper"
      exports: ["ProgressiveVisualization"]
    - path: "src/components/app/visualization-reset-button.tsx"
      provides: "Reset button component for pan/zoom"
      exports: ["VisualizationResetButton"]
  key_links:
    - from: "src/components/app/progressive-visualization.tsx"
      to: "react-zoom-pan-pinch"
      via: "TransformWrapper, TransformComponent imports"
      pattern: "TransformWrapper"
---

<objective>
Set up the ProgressiveVisualization component with pan/zoom infrastructure using react-zoom-pan-pinch.

Purpose: Establish the canvas wrapper and interaction foundation that all subsequent visualization work builds on. Pan/zoom is a core feature for Phase 20 (per CONTEXT.md).

Output: ProgressiveVisualization component with working pan/zoom (desktop + touch), reset button, and centered placeholder for orb.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/20-visualization-foundation/20-CONTEXT.md
@.planning/phases/20-visualization-foundation/20-RESEARCH.md
@src/components/app/network-visualization.tsx (reference for canvas patterns)
@src/app/globals.css (design tokens)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install react-zoom-pan-pinch dependency</name>
  <files>package.json</files>
  <action>
Install react-zoom-pan-pinch for pan/zoom functionality:

```bash
pnpm add react-zoom-pan-pinch
```

This is the industry standard for declarative pan/zoom with touch support per RESEARCH.md.
  </action>
  <verify>Run `pnpm list react-zoom-pan-pinch` to confirm installation. Run `pnpm build` to ensure no type conflicts.</verify>
  <done>react-zoom-pan-pinch appears in package.json dependencies and project builds successfully.</done>
</task>

<task type="auto">
  <name>Task 2: Create VisualizationResetButton component</name>
  <files>src/components/app/visualization-reset-button.tsx</files>
  <action>
Create a reset button component that uses react-zoom-pan-pinch's useControls hook:

```typescript
"use client";

import { useControls } from "react-zoom-pan-pinch";
import { RotateCcw } from "lucide-react";

interface VisualizationResetButtonProps {
  visible: boolean;
}

export function VisualizationResetButton({ visible }: VisualizationResetButtonProps) {
  const { resetTransform } = useControls();

  if (!visible) return null;

  return (
    <button
      onClick={() => resetTransform()}
      className="absolute top-4 right-4 z-10 p-2 rounded-lg glass-base glass-blur-sm opacity-80 hover:opacity-100 transition-opacity"
      aria-label="Reset view"
    >
      <RotateCcw className="w-4 h-4 text-text-secondary" />
    </button>
  );
}
```

Key details:
- Uses lucide-react RotateCcw icon (already in project)
- Uses existing glass-base and glass-blur-sm classes from globals.css
- Only renders when visible prop is true
- Accessible with aria-label
  </action>
  <verify>File exists and TypeScript compiles without errors.</verify>
  <done>VisualizationResetButton component created with useControls integration and glass styling.</done>
</task>

<task type="auto">
  <name>Task 3: Create ProgressiveVisualization component with pan/zoom</name>
  <files>src/components/app/progressive-visualization.tsx</files>
  <action>
Create the main visualization component with TransformWrapper for pan/zoom:

```typescript
"use client";

import { useRef, useState, useCallback } from "react";
import { TransformWrapper, TransformComponent } from "react-zoom-pan-pinch";
import { cn } from "@/lib/utils";
import { VisualizationResetButton } from "./visualization-reset-button";

interface ProgressiveVisualizationProps {
  className?: string;
}

/**
 * ProgressiveVisualization - Canvas-based visualization with pan/zoom support
 *
 * Phase 20: Foundation component with orb placeholder
 * - Pan/zoom via react-zoom-pan-pinch (desktop drag + wheel, touch pinch + drag)
 * - Reset button appears after user moves view
 * - No momentum (direct control per CONTEXT.md)
 * - Min/max zoom limits: 0.5x to 3x (sensible defaults per RESEARCH.md)
 */
export function ProgressiveVisualization({ className }: ProgressiveVisualizationProps) {
  const containerRef = useRef<HTMLDivElement>(null);
  const [hasTransformed, setHasTransformed] = useState(false);

  // Track when user has moved the view
  const handleTransform = useCallback(() => {
    if (!hasTransformed) {
      setHasTransformed(true);
    }
  }, [hasTransformed]);

  // Hide reset button when view is reset
  const handleReset = useCallback(() => {
    setHasTransformed(false);
  }, []);

  return (
    <div ref={containerRef} className={cn("absolute inset-0 overflow-hidden", className)}>
      <TransformWrapper
        initialScale={1}
        minScale={0.5}
        maxScale={3}
        centerOnInit={true}
        wheel={{ smoothStep: 0.05 }}
        panning={{ velocityDisabled: true }} // No momentum per CONTEXT.md
        pinch={{ disabled: false }}
        doubleClick={{ disabled: true }}
        onTransformed={handleTransform}
        onInit={handleReset}
      >
        {() => (
          <>
            <VisualizationResetButton visible={hasTransformed} />
            <TransformComponent
              wrapperClass="!w-full !h-full"
              contentClass="!w-full !h-full flex items-center justify-center"
            >
              {/* Placeholder for orb - will be replaced in 20-02 */}
              <div
                className="w-32 h-32 rounded-full bg-surface-elevated border border-border-glass"
                aria-label="Visualization orb placeholder"
              />
            </TransformComponent>
          </>
        )}
      </TransformWrapper>
    </div>
  );
}
```

Key implementation details per CONTEXT.md and RESEARCH.md:
- `velocityDisabled: true` - No momentum, stops immediately when finger lifts
- `minScale: 0.5, maxScale: 3` - Sensible defaults per RESEARCH.md
- `centerOnInit: true` - Orb centered on load
- `doubleClick: { disabled: true }` - Prevent accidental zoom
- `smoothStep: 0.05` - Smooth wheel zoom per research
- Reset button tracks transform state
- Uses design tokens from globals.css
  </action>
  <verify>
1. Run `pnpm build` to ensure component compiles
2. Run `pnpm dev` and navigate to a test page to verify pan/zoom works
  </verify>
  <done>ProgressiveVisualization component renders with working pan/zoom, reset button appears after user interaction, placeholder orb is centered.</done>
</task>

</tasks>

<verification>
1. `pnpm build` completes without errors
2. `pnpm list react-zoom-pan-pinch` shows package installed
3. Files exist:
   - src/components/app/progressive-visualization.tsx
   - src/components/app/visualization-reset-button.tsx
4. TypeScript types are correct (no any types)
</verification>

<success_criteria>
- react-zoom-pan-pinch is installed and project builds
- ProgressiveVisualization component renders with TransformWrapper
- Pan/zoom works with mouse/wheel and touch gestures
- Reset button appears after user transforms view
- Placeholder orb is centered on initial load
- No momentum on pan (direct control)
</success_criteria>

<output>
After completion, create `.planning/phases/20-visualization-foundation/20-01-SUMMARY.md`
</output>
