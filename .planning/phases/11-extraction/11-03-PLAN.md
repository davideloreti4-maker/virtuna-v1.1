---
phase: 11-extraction
plan: 03
type: execute
wave: 2
depends_on: ["11-01"]
files_modified:
  - extraction/scripts/capture-selectors.ts
  - extraction/scripts/capture-forms.ts
autonomous: true

must_haves:
  truths:
    - "Society selector captured in closed, open, and hover states"
    - "View selector captured in closed and open states with each dropdown option"
    - "Test type selector captured with all 11 types visible"
    - "Content forms captured empty, filled, and with validation errors"
    - "Survey form captured with options and validation"
  artifacts:
    - path: "extraction/screenshots/desktop/selectors/society-selector-closed.png"
      provides: "Society selector in closed state"
    - path: "extraction/screenshots/desktop/selectors/society-selector-open.png"
      provides: "Society selector modal open"
    - path: "extraction/screenshots/desktop/forms/content-form-empty.png"
      provides: "Content form empty state"
    - path: "extraction/screenshots/desktop/forms/content-form-filled.png"
      provides: "Content form with data"
    - path: "extraction/scripts/capture-selectors.ts"
      provides: "Selectors capture script"
    - path: "extraction/scripts/capture-forms.ts"
      provides: "Forms capture script"
  key_links:
    - from: "extraction/scripts/capture-forms.ts"
      to: "extraction/scripts/utils.ts"
      via: "import"
      pattern: "from.*utils"
---

<objective>
Extract forms, selectors, and interactive elements from app.societies.io at desktop and mobile viewports.

Purpose: Capture all interactive states — dropdowns, selectors, forms in various fill states — for detailed Phase 12 comparison of form styling and interaction patterns.
Output: Comprehensive screenshot coverage of society selector, view selector, test type selector, and all form states.
</objective>

<execution_context>
@/Users/davideloreti/.claude/get-shit-done/workflows/execute-plan.md
@/Users/davideloreti/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/11-extraction/11-CONTEXT.md
@.planning/phases/11-extraction/11-RESEARCH.md
@.planning/phases/11-extraction/11-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create selectors capture script</name>
  <files>
    - extraction/scripts/capture-selectors.ts
  </files>
  <action>
Create extraction/scripts/capture-selectors.ts that captures:

**1. Society Selector (EXT-02)**:
- Closed state: `selectors/society-selector-closed.png`
- Open state (modal/dropdown): `selectors/society-selector-open.png`
- Hover on society item: `selectors/society-selector-hover-item.png`
- Create society modal open: `selectors/society-create-modal.png`

**2. View Selector (EXT-03)**:
- Closed state: `selectors/view-selector-closed.png`
- Open state: `selectors/view-selector-open.png`
- Each dropdown option expanded (Country, City, Generation, Role Level):
  - `selectors/view-selector-country.png`
  - `selectors/view-selector-city.png`
  - `selectors/view-selector-generation.png`
  - `selectors/view-selector-role.png`

**3. Test Type Selector (EXT-04)**:
- Closed/trigger state: `selectors/test-type-closed.png`
- Open with all 11 types visible: `selectors/test-type-open.png`
- Hover on each type (capture 2-3 examples):
  - `selectors/test-type-hover-tiktok.png`
  - `selectors/test-type-hover-instagram.png`

Script structure:
```typescript
import { chromium } from 'playwright';
import { VIEWPORTS, ViewportName, captureScreen, createAuthContext, ensureDir } from './utils';
import * as path from 'path';

async function captureSelectors() {
  const browser = await chromium.launch();

  for (const viewport of ['desktop', 'mobile'] as ViewportName[]) {
    const context = await createAuthContext(browser, viewport);
    const page = await context.newPage();

    await page.goto('https://app.societies.io/dashboard');
    await page.waitForLoadState('networkidle');

    const outputDir = `./extraction/screenshots/${viewport}/selectors`;
    ensureDir(outputDir);

    // ===== SOCIETY SELECTOR =====
    // Find society selector trigger (button/dropdown in sidebar)
    const societyTrigger = page.locator('[data-testid="society-selector"], .society-selector, [class*="society"]').first();

    if (await societyTrigger.isVisible()) {
      // Closed state
      await page.screenshot({ path: `${outputDir}/society-selector-closed.png`, fullPage: true });

      // Click to open
      await societyTrigger.click();
      await page.waitForTimeout(300);
      await page.screenshot({ path: `${outputDir}/society-selector-open.png`, fullPage: true });

      // Look for create button inside modal
      const createBtn = page.locator('button:has-text("Create"), button:has-text("Add"), [data-testid*="create"]');
      if (await createBtn.isVisible()) {
        await createBtn.click();
        await page.waitForTimeout(300);
        await page.screenshot({ path: `${outputDir}/society-create-modal.png`, fullPage: true });
        // Close create modal
        await page.keyboard.press('Escape');
        await page.waitForTimeout(200);
      }

      // Close society selector
      await page.keyboard.press('Escape');
      await page.waitForTimeout(200);
    }

    // ===== VIEW SELECTOR =====
    const viewTrigger = page.locator('[data-testid="view-selector"], .view-selector, [class*="view-select"]').first();

    if (await viewTrigger.isVisible()) {
      await page.screenshot({ path: `${outputDir}/view-selector-closed.png`, fullPage: true });

      await viewTrigger.click();
      await page.waitForTimeout(300);
      await page.screenshot({ path: `${outputDir}/view-selector-open.png`, fullPage: true });

      // Try to capture each dropdown option
      const dropdownOptions = ['country', 'city', 'generation', 'role'];
      for (const option of dropdownOptions) {
        const optionTrigger = page.locator(`[data-testid*="${option}"], button:has-text("${option}"), [class*="${option}"]`).first();
        if (await optionTrigger.isVisible()) {
          await optionTrigger.click();
          await page.waitForTimeout(200);
          await page.screenshot({ path: `${outputDir}/view-selector-${option}.png`, fullPage: true });
        }
      }

      await page.keyboard.press('Escape');
    }

    // ===== TEST TYPE SELECTOR =====
    // This is usually triggered by a "New Test" or "Create Test" button
    const testTrigger = page.locator('[data-testid="new-test"], button:has-text("New Test"), button:has-text("Create Test")').first();

    if (await testTrigger.isVisible()) {
      await page.screenshot({ path: `${outputDir}/test-type-closed.png`, fullPage: true });

      await testTrigger.click();
      await page.waitForTimeout(300);
      await page.screenshot({ path: `${outputDir}/test-type-open.png`, fullPage: true });

      // Hover on test types
      const testTypes = ['tiktok', 'instagram', 'youtube'];
      for (const type of testTypes) {
        const typeOption = page.locator(`[data-testid*="${type}"], button:has-text("${type}"), [class*="${type}"]`).first();
        if (await typeOption.isVisible()) {
          await typeOption.hover();
          await page.screenshot({ path: `${outputDir}/test-type-hover-${type}.png`, fullPage: true });
        }
      }

      await page.keyboard.press('Escape');
    }

    await context.close();
  }

  await browser.close();
  console.log('Selectors capture complete!');
}

captureSelectors().catch(console.error);
```

NOTE: Actual selectors may vary — the script should adapt to the real DOM structure found on app.societies.io. The patterns above are starting points.

  </action>
  <verify>
Run script: `npx ts-node extraction/scripts/capture-selectors.ts`
Check that screenshots exist in:
- extraction/screenshots/desktop/selectors/
- extraction/screenshots/mobile/selectors/
  </verify>
  <done>
- Society selector captured in closed, open, hover, and create modal states
- View selector captured with all dropdown options
- Test type selector captured with hover states on types
- Both viewports covered
  </done>
</task>

<task type="auto">
  <name>Task 2: Create forms capture script</name>
  <files>
    - extraction/scripts/capture-forms.ts
  </files>
  <action>
Create extraction/scripts/capture-forms.ts that captures:

**1. Content Forms (EXT-05)** — for TikTok, Instagram, etc.:
- Empty state: `forms/content-form-empty.png`
- Filled state: `forms/content-form-filled.png`
- Validation error state: `forms/content-form-validation.png`

**2. Survey Form (EXT-06)**:
- Empty state: `forms/survey-form-empty.png`
- With options added: `forms/survey-form-options.png`
- Validation state: `forms/survey-form-validation.png`

**3. Multiple form types** — capture at least 3 different test type forms:
- TikTok form: `forms/tiktok-form-{state}.png`
- Instagram form: `forms/instagram-form-{state}.png`
- YouTube form: `forms/youtube-form-{state}.png`

Script structure:
```typescript
import { chromium } from 'playwright';
import { VIEWPORTS, ViewportName, createAuthContext, ensureDir, scrollToBottom } from './utils';

async function captureForms() {
  const browser = await chromium.launch();

  for (const viewport of ['desktop', 'mobile'] as ViewportName[]) {
    const context = await createAuthContext(browser, viewport);
    const page = await context.newPage();

    await page.goto('https://app.societies.io/dashboard');
    await page.waitForLoadState('networkidle');

    const outputDir = `./extraction/screenshots/${viewport}/forms`;
    ensureDir(outputDir);

    // Navigate to test creation
    const newTestBtn = page.locator('[data-testid="new-test"], button:has-text("New Test")').first();

    if (await newTestBtn.isVisible()) {
      await newTestBtn.click();
      await page.waitForTimeout(300);

      // ===== TIKTOK FORM =====
      const tiktokOption = page.locator('[data-testid*="tiktok"], button:has-text("TikTok")').first();
      if (await tiktokOption.isVisible()) {
        await tiktokOption.click();
        await page.waitForTimeout(300);

        // Empty state
        await scrollToBottom(page);
        await page.screenshot({ path: `${outputDir}/tiktok-form-empty.png`, fullPage: true });

        // Fill form
        const textarea = page.locator('textarea').first();
        if (await textarea.isVisible()) {
          await textarea.fill('Sample TikTok content for testing. This is a demonstration of the content form filled state.');
          await scrollToBottom(page);
          await page.screenshot({ path: `${outputDir}/tiktok-form-filled.png`, fullPage: true });
        }

        // Try to trigger validation (submit empty or invalid)
        const submitBtn = page.locator('button:has-text("Simulate"), button:has-text("Submit"), button[type="submit"]').first();
        if (await submitBtn.isVisible()) {
          // Clear form to trigger validation
          await textarea.clear();
          await submitBtn.click();
          await page.waitForTimeout(300);
          await page.screenshot({ path: `${outputDir}/tiktok-form-validation.png`, fullPage: true });
        }

        // Go back to test type selection
        await page.keyboard.press('Escape');
        await page.waitForTimeout(200);
      }

      // ===== INSTAGRAM FORM =====
      await newTestBtn.click();
      await page.waitForTimeout(300);

      const instagramOption = page.locator('[data-testid*="instagram"], button:has-text("Instagram")').first();
      if (await instagramOption.isVisible()) {
        await instagramOption.click();
        await page.waitForTimeout(300);

        await scrollToBottom(page);
        await page.screenshot({ path: `${outputDir}/instagram-form-empty.png`, fullPage: true });

        const textarea = page.locator('textarea').first();
        if (await textarea.isVisible()) {
          await textarea.fill('Sample Instagram post content for visual testing purposes.');
          await scrollToBottom(page);
          await page.screenshot({ path: `${outputDir}/instagram-form-filled.png`, fullPage: true });
        }

        await page.keyboard.press('Escape');
      }

      // ===== SURVEY FORM =====
      await newTestBtn.click();
      await page.waitForTimeout(300);

      const surveyOption = page.locator('[data-testid*="survey"], button:has-text("Survey")').first();
      if (await surveyOption.isVisible()) {
        await surveyOption.click();
        await page.waitForTimeout(300);

        await scrollToBottom(page);
        await page.screenshot({ path: `${outputDir}/survey-form-empty.png`, fullPage: true });

        // Add survey options if there's an "Add Option" button
        const addOptionBtn = page.locator('button:has-text("Add"), button:has-text("Option")').first();
        if (await addOptionBtn.isVisible()) {
          await addOptionBtn.click();
          await page.waitForTimeout(200);
          await addOptionBtn.click();
          await page.waitForTimeout(200);
          await page.screenshot({ path: `${outputDir}/survey-form-options.png`, fullPage: true });
        }

        await page.keyboard.press('Escape');
      }
    }

    await context.close();
  }

  await browser.close();
  console.log('Forms capture complete!');
}

captureForms().catch(console.error);
```

  </action>
  <verify>
Run script: `npx ts-node extraction/scripts/capture-forms.ts`
Check that screenshots exist in:
- extraction/screenshots/desktop/forms/
- extraction/screenshots/mobile/forms/
  </verify>
  <done>
- Content forms captured empty, filled, and with validation errors
- Survey form captured with options
- Multiple test type forms (TikTok, Instagram, Survey) documented
- Both viewports covered
  </done>
</task>

</tasks>

<verification>
- [ ] `extraction/scripts/capture-selectors.ts` exists and runs
- [ ] `extraction/scripts/capture-forms.ts` exists and runs
- [ ] Society selector screenshots exist (closed, open, hover, create)
- [ ] View selector screenshots exist (closed, open, options)
- [ ] Test type selector screenshots exist
- [ ] Form screenshots exist (empty, filled, validation)
</verification>

<success_criteria>
- All selector types captured in all relevant states (EXT-02, EXT-03, EXT-04)
- All form types captured in empty, filled, and validation states (EXT-05, EXT-06)
- Interactive hover states captured
- Screenshots organized for Phase 12 comparison
</success_criteria>

<output>
After completion, create `.planning/phases/11-extraction/11-03-SUMMARY.md`
</output>
